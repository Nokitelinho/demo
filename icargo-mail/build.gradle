/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.7/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'
    id "org.sonarqube" version "2.6.2"
    id 'info.solidsoft.pitest' version '1.4.0'
}

sourceCompatibility = '1.8'
targetCompatibility = '1.8'

apply plugin: "eclipse"
apply plugin: "jacoco"

sourceSets {
	main {
        java {
            srcDirs = ['Java/src']
            excludes = [
            			'com/ibsplc/icargo/**/micro/**',
            			'com/ibsplc/icargo/presentation/mobility/**',
            			'com/ibsplc/icargo/services/**/webservices/**'
            		 	]
        }
    }
    test {
    	java {
    		srcDirs = ['Java/test']
    		excludes = [
            			'com/ibsplc/icargo/presentation/mobility/**'
            		 	]
    	}
    	
    }
}

compileJava { 
  options.encoding = "ISO-8859-1" 
}

build.finalizedBy jacocoTestReport

//check.dependsOn jacocoTestCoverageVerification

jacocoTestReport {
    group = "Reporting"
        reports {
            xml.enabled true
            csv.enabled false
            //to create coverage report in html
            html.destination file("${buildDir}/reports/coverage")
            //for XML
            xml.destination file("${buildDir}/reports/jacoco.xml")
        }
    afterEvaluate {
        classDirectories = files(classDirectories.files.collect {
            fileTree(dir: it, include: 'com/ibsplc/icargo/business/**')
        })
    }
}

jacocoTestCoverageVerification {
  violationRules {
    rule {
      element = 'CLASS'
      includes = ['com.ibsplc.icargo.business.**.feature.*']
        limit {
          counter = 'LINE'
          value = 'COVEREDRATIO'
          minimum = 0.9
      }
      
    }
  }
  
}

sonarqube { 
	properties { 
		property 'sonar.inclusions', "**src/com/ibsplc/icargo/business/**,**src/com/ibsplc/icargo/persistence/dao/**" 
	} 
}


test {
	jvmArgs = [
    					"-Dservice.properties=${projectDir}/junitconfig",
						"-DSprout_Config_Path=${projectDir}/junitconfig",
						"-Dicargo.configuration=xconfig.xml",
						"-DstartListeners=false",
						"-DIS_STAND_ALONE=TRUE",
						"-Xms1024m", 
						"-Xmx2048m",
						"-Dtimezone.impl=file"
    		 ]
    include '**/**Suite.class'
    
}
dependencies {
    // This dependency is found on compile classpath of this component and consumers.
    
    compile 'com.ibsplc.icargo:icargo-vo:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-BI:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-exceptions:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-types:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-converter:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-shared-delegate:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-model-common:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-sessions:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-common-forms:'+ICO_VERSION
    compile 'com.ibsplc.icargo:icargo-eai-framework:'+EAI_VERSION
	compile 'org.springframework:spring-context:4.1.9.RELEASE'
	compile 'javax.ejb:ejb-api:3.0'
	compile 'javax.servlet:servlet-api:2.5'	
	compile 'com.ibsplc.sprout:sprout-authentication:4.3.11'
	compile 'com.ibsplc.sprout:sprout-multitenant:4.3.11'
	compile 'com.ibsplc.sprout:sprout-jdbc:4.3.11'
	compile 'javax.enterprise.concurrent:javax.enterprise.concurrent-api:1.1'
	//compile files('libs/operations-flthandling-external-LHwebservices.jar')
     
	compile 'com.ibsplc.icargo:icargo-external-services-standard:'+ICO_VERSION
	compile 'com.ibsplc.icargo:icargo-external-services-LH:'+ICO_VERSION
	compile 'com.ibsplc.icargo:icargo-external-services-AA:'+ICO_VERSION
	compile 'com.ibsplc.icargo:icargo-external-services-TK:'+ICO_VERSION 
	compile 'com.ibsplc.icargo:icargo-external-services-KE:'+ICO_VERSION 
	compile 'com.ibsplc.icargo:icargo-external-services-DNAE:'+ICO_VERSION
	compile 'com.ibsplc.icargo:icargo-external-services-DNCH:'+ICO_VERSION

    // Use JUnit test framework
    testCompile 'com.ibsplc.icargo:icargo-codequalitygateway:'+TEST_VALIDATION_VERSION
    testCompile 'com.ibsplc.icargo:icargo-test-framework:'+TEST_FRWK_VERSION
    compile 'org.pitest:pitest-command-line:1.4.8'
    testImplementation 'org.hsqldb:hsqldb:2.4.0'
}
configurations.all {
    resolutionStrategy {
    	// forced due to xml-apis wrong version issue
        force 'xml-apis:xml-apis:1.4.01'
        // forced to handle future cases where framework is updated but the old framework getting downloaded from eai dependency. 
        force 'com.ibsplc.icargo:icargo-framework:'+FRWK_VERSION
        force 'com.ibsplc.icargo:xibase:'+XIBASE_VERSION
        cacheDynamicVersionsFor 0, 'seconds'
		cacheChangingModulesFor 0, 'seconds'
    }
   
}

configurations{
	implementation {
		//excludes javaee due to abstract implementation classes causing issues. The java/persistence files are present in hibernte-jpa.
		exclude group: 'javax', module: 'javaee-api'
	}
}

// In this section you declare where to find the dependencies of your project
repositories {
       
    maven {
    	credentials {
            username mavenUser
            password mavenPassword
        }
        url "http://10.246.13.144:8082/artifactory/libs-snapshot/"
        artifactUrls "http://10.246.13.144:8082/artifactory/libs-release/"
    }
    maven {
    	credentials {
            username mavenUser
            password mavenPassword
        }
        url "http://10.246.13.144:8082/artifactory/libs-release/"
        
    }
    maven {
        url "http://repo.ibsplc.com/artifactory/repo1/"
    }
   	maven {
    	url "http://repo.ibsplc.com/artifactory/libs-release/"
    }

}



pitest {
    targetClasses = ['com.ibsplc.icargo.business.**.feature.*']  //by default "${project.group}.*"
    targetTests = ['com.ibsplc.icargo.business.**.*Suite']
    threads = 1
    timestampedReports = false
    outputFormats = ['XML', 'HTML']
    useClasspathFile = true
    avoidCallsTo = ["com.ibsplc.xibase.util.log"]
    mainProcessJvmArgs = [
    					"-Dservice.properties=${projectDir}/junitconfig",
						"-DSprout_Config_Path=${projectDir}/junitconfig",
						"-Dicargo.configuration=xconfig.xml",
						"-DstartListeners=false",
						"-DIS_STAND_ALONE=TRUE",
						"-Xms1024m", 
						"-Xmx2048m",
						"-Dtimezone.impl=file"
						
    		 ]
	timeoutFactor = 10   
	timeoutConstInMillis = 30000	
	mutators = ["CONDITIONALS_BOUNDARY","INCREMENTS","INVERT_NEGS","MATH","NEGATE_CONDITIONALS","RETURN_VALS"]
    excludedTestClasses  = ['**.CheckinShipmentFeatureTest','**.ShipmentIncompatibleSCCValidatorTest','**.AWBExecutedFlagDateUserAirportEnricherTest','**.AllPartsReceivedEnricherTest','**.ShipmentIncompatibleSCCValidationErrorsEnricherTest','**.ShipmentPersistorTest']
}
