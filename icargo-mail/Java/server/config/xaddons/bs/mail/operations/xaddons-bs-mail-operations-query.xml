<?xml version="1.0"?>
<QRY:Definitions xmlns:QRY="http://www.ibsplc.com/xibase/persistence/queries" module="bsmail.operations">
 <QRY:Definition>
		<QRY:Id>1</QRY:Id>
		<QRY:Source Name="xaddons.bs.mail.operations.findmailbookingawbs" Type="NATIVE">
			<![CDATA[
		select BKGMST.CMPCOD,BKGMST.SHPPFX,
		BKGMST.DOCOWRIDR,BKGMST.DUPNUM,
BKGMST.MSTDOCNUM,
BKGMST.SEQNUM,
BKGMST.ORGCOD,
BKGMST.DSTCOD,
BKGFLTDTL.FLTCARCOD,
BKGFLTDTL.FLTCARIDR,
BKGFLTDTL.FLTSEQNUM,
BKGFLTDTL.FLTNUM,
BKGFLTDTL.FLTDAT,
BKGFLTDTL.FLTORG,
BKGFLTDTL.FLTDST,
BKGMST.AGTCOD,
BKGMST.SCCCOD,
BKGMST.SHPDAT,
BKGMST.TOTNUMPCS,
BKGMST.TOTWGT,
BKGMST.TOTVOL,
BKGMST.BKGSTA,
SHPMST.SHPSTA,
BKGMST.STNCOD,
BKGMST.BKGDAT,
BKGMST.SHPRMK,
SHPMST.STDPCS,
NVL(BKGMST.ISSSPLBKG,'N') SPLIND
from CAPBKGMST BKGMST 
 INNER JOIN OPRSHPMST SHPMST ON
 SHPMST.CMPCOD=BKGMST.CMPCOD AND
 SHPMST.UBRNUM=BKGMST.UBRNUM AND
 SHPMST.SHPPFX=BKGMST.SHPPFX AND
 SHPMST.MSTDOCNUM=BKGMST.MSTDOCNUM AND 
 PKG_FRMWRK.FUN_CHECK_STRING_COMMON(SHPMST.SCCCOD,BKGMST.SCCCOD,',') > 0
 LEFT OUTER JOIN CAPBKGFLTDTL BKGFLTDTL ON
 BKGFLTDTL.CMPCOD=SHPMST.CMPCOD AND
 BKGFLTDTL.UBRNUM=SHPMST.UBRNUM 
 
 where BKGMST.CMPCOD = ?
 
				]]>
		</QRY:Source>
	</QRY:Definition>
	
	<QRY:Definition>
		<QRY:Id>2</QRY:Id>
		<QRY:Source Name="xaddons.bs.mail.operations.fetchBookedFlightDetails" Type="NATIVE">
			<![CDATA[
		select BKGMST.SHPPFX,
		BKGMST.MSTDOCNUM,
		BKGFLTDTL.FLTORG,
		BKGFLTDTL.FLTDST,
		BKGFLTDTL.FLTCARCOD,
		BKGFLTDTL.FLTNUM,
		BKGFLTDTL.FLTDAT,
		BKGFLTDTL.NUMPCS,
		BKGFLTDTL.WGT,
		BKGFLTDTL.FLTCARIDR,
		BKGFLTDTL.FLTSEQNUM,
		BKGFLTDTL.FLTSEGNUM,
		BKGFLTDTL.SEGSERNUM
		from CAPBKGMST BKGMST INNER JOIN CAPBKGFLTDTL BKGFLTDTL ON
		 BKGMST.CMPCOD=BKGFLTDTL.CMPCOD AND
		 BKGMST.UBRNUM=BKGFLTDTL.UBRNUM 
		 
		 where bkgmst.bkgsta <>'X' and BKGMST.CMPCOD=?
		  AND BKGMST.SHPPFX= ?
		 AND BKGMST.MSTDOCNUM= ?
		 ORDER BY BKGFLTDTL.FLTSEGNUM
				]]>
		</QRY:Source>
	</QRY:Definition>			

					
<QRY:Definition>
		<QRY:Id>3</QRY:Id>
		<QRY:Source Name="xaddons.bs.mail.operations.fetchBookedFlightDetailsForMailbag" Type="NATIVE">
			<![CDATA[
		SELECT  FLTDTL.CMPCOD ,
FLTDTL.MALSEQNUM,
FLTDTL.SERNUM ,
FLTDTL.FLTCARIDR ,
FLTDTL.FLTNUM ,
FLTDTL.FLTSEQNUM ,
FLTDTL.SEGSERNUM ,
FLTDTL.BKGSTA 
from MALBKGFLTDTL FLTDTL
where FLTDTL.MALSEQNUM = ?
				]]>
		</QRY:Source>
	</QRY:Definition>		

<QRY:Definition>
		<QRY:Id>4</QRY:Id>
		<QRY:Source Name="xaddons.bs.mail.operations.findMaxSerialNumber" Type="NATIVE">
			<![CDATA[
SELECT MAX(
FLTDTL.SERNUM ) SERNUM
FROM MALBKGFLTDTL FLTDTL
WHERE FLTDTL.CMPCOD=?
AND FLTDTL.FLTNUM= ?
AND FLTDTL.FLTSEQNUM= ?
AND FLTDTL.FLTCARIDR = ?
AND FLTDTL.SEGSERNUM = ?
				]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>5</QRY:Id>
		<QRY:Source Name="xaddons.bs.mail.operations.findAttachedMailBagsCount" Type="NATIVE">
			<![CDATA[
SELECT COUNT(MALMST.MALSEQNUM) MALCOUNT
FROM MALMST MALMST INNER JOIN MALBKGFLTDTL FLTDTL 
ON MALMST.MALSEQNUM=FLTDTL.MALSEQNUM AND
MALMST.CMPCOD=FLTDTL.CMPCOD
WHERE MALMST.CMPCOD=? AND 
MALMST.SHPPFX= ? AND
MALMST.MSTDOCNUM=? AND 
FLTDTL.FLTNUM=? AND
FLTDTL.FLTSEQNUM=? AND
FLTDTL.FLTCARIDR = ? AND 
FLTDTL.SEGSERNUM = ?
				]]>
		</QRY:Source>
	</QRY:Definition>
	
	

</QRY:Definitions>