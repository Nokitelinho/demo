<?xml version="1.0"?>
<QRY:Definitions xmlns:QRY="http://www.ibsplc.com/xibase/persistence/queries" module="mail.mra.defaults">

	<QRY:Definition>
		<QRY:Id>1</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findratecarddetails" Type="NATIVE">
			<![CDATA[
					SELECT RATCRD.RATCRDCOD,
					   RATCRD.RATCRDDES,
					   RATCRD.RATCRDSTA,
					   RATCRD.VLDSTRDAT,
					   RATCRD.VLDENDDAT,
					   RATCRD.MALDISFCT,
					   RATCRD.CATONETKM,
					   RATCRD.CATTWOTKM,
					   RATCRD.CATTHRTKM, 

					   RATCRD.LSTUPDTIM,
					   RATCRD.LSTUPDUSR
					   FROM MALMRARATCRD RATCRD
					   WHERE RATCRD.CMPCOD=?
					   AND RATCRD.RATCRDCOD=?
			]]>
		</QRY:Source>
	</QRY:Definition>
     <!-- Added  for findratelinedetails -->
	<QRY:Definition>
			<QRY:Id>2</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findratelinedetails" Type="NATIVE">
				<![CDATA[
					SELECT 	   RATLIN.CMPCOD,
						   RATLIN.RATCRDCOD,
						   RATLIN.RATLINSEQNUM,
						   RATLIN.RATLINSTA,
						   RATLIN.ORGCOD,
						   RATLIN.DSTCOD,
						   RATLIN.IATKLM,
						   RATLIN.MALKLM,
						   RATLIN.CATONEXDRCURRAT,
						   RATLIN.CATTWOXDRCURRAT,
						   RATLIN.CATTHRXDRCURRAT,
						   RATLIN.CATONEBASCURRAT,
						   RATLIN.CATTWOBASCURRAT,
						   RATLIN.CATTHRBASCURRAT,
						   RATLIN.VLDSTRDAT,
						   RATLIN.VLDENDDAT,
						   RATLIN.ORGDSTLVL,
						   RATLIN.LSTUPDUSR,
						   RATLIN.LSTUPDTIM
						   FROM MALMRARATLIN RATLIN
					   WHERE RATLIN.CMPCOD=?



			]]>
			</QRY:Source>
	</QRY:Definition>

	<!-- Added by Kiran for findAllRateCards -->
	<!--Modified by A-5166 for ICRD-17262 on 11-Feb-2013 Starts-->
	<QRY:Definition>
		<QRY:Id>3</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findAllRateCards" Type="NATIVE">
		<![CDATA[
				SELECT
				RATMST.RATCRDCOD, RATMST.CMPCOD, RATMST.RATCRDSTA,
				RATMST.VLDSTRDAT, RATMST.VLDENDDAT,RATMST.RATCRDDES,
				RATMST.TOTRATLIN,RATMST.LSTUPDUSR,RATMST.LSTUPDTIM,
				RATMST.MALDISFCT,RATMST.CATONETKM,RATMST.CATTWOTKM,RATMST.CATTHRTKM
				FROM MALMRARATCRD RATMST
  				WHERE RATMST.CMPCOD = ?
			]]>
		</QRY:Source>
	</QRY:Definition>
	<!--Modified by A-5166 for ICRD-17262 on 11-Feb-2013 Ends-->

	<!-- Added by Sandeep for findoverlapping ratelines begins  -->
	    	 <QRY:Definition>
	            <QRY:Id>4</QRY:Id>
	            <QRY:Source Name="mail.mra.defaults.findoverlappingratelines" Type="NATIVE">
	                <![CDATA[
	                  SELECT LIN.CMPCOD,LIN.RATCRDCOD,LIN.RATLINSEQNUM,LIN.ORGCOD,LIN.DSTCOD,LIN.VLDSTRDAT,LIN.VLDENDDAT
			  	   FROM MALMRARATLIN LIN WHERE
			  	                    LIN.CMPCOD = ?
			         		AND LIN.RATLINSTA = ?

	               ]]>
	            </QRY:Source>
	    </QRY:Definition>
    <!-- Added by Sandeep  findoverlapping ratelines ends -->
	<!-- Added for RateCardLOV starts -->
	<QRY:Definition>
		            <QRY:Id>5</QRY:Id>
		            <QRY:Source Name="mail.mra.defaults.findratecardlov" Type="NATIVE">
		                <![CDATA[
		                 SELECT MST.CMPCOD,
				        MST.RATCRDCOD,
				        MST.RATCRDDES
				  FROM MALMRARATCRD MST
 				  WHERE MST.CMPCOD=?

		               ]]>
		            </QRY:Source>
	    </QRY:Definition>
	<!-- Added for RateCardLOV ends -->

	<!-- Added for findAllBillingMatrix starts -->
	<!-- Modified by A-4823 for bug fix ICRD-16185 -->
	<QRY:Definition>
		            <QRY:Id>6</QRY:Id>
		            <QRY:Source Name="mail.mra.defaults.findallbillingmarix" Type="NATIVE">
		                <![CDATA[
		             SELECT DISTINCT BLGMTX.BLGMTXCOD BLGMTXBLGMTXCOD,BLGMTX.CMPCOD BLGMTXCMPCOD,

						BLGMTX.BLGMTXDES BLGMTXBLGMTXDES,
						BLGMTX.BLGMTXSTA BLGMTXBLGMTXSTA,
						BLGMTX.TOTBLGLIN BLGMTXTOTBLGLIN,
						BLGMTX.VLDENDDAT BLGMTXVLDENDDAT,
						BLGMTX.VLDSTRDAT BLGMTXVLDSTRDAT,
						BLGMTX.POACOD BILPTYPOACOD,
						BLGMTX.ARLCOD BILPTYARLCOD
							FROM MALMRABLGMTX BLGMTX
							LEFT OUTER JOIN MALMRABLGMTXLIN BLGLIN
							ON BLGMTX.CMPCOD=BLGLIN.CMPCOD AND BLGMTX.BLGMTXCOD=BLGLIN.BLGMTXCOD

							WHERE BLGMTX.CMPCOD   = ?

		               ]]>
		            </QRY:Source>
	    </QRY:Definition>
	<!-- Added for findAllBillingMatrix ends -->
	<!-- Added for findBillingMatrixLov starts -->
		<QRY:Definition>
			    <QRY:Id>7</QRY:Id>
			    <QRY:Source Name="mail.mra.defaults.findbillingmatrixlov" Type="NATIVE">
				<![CDATA[
				    SELECT BLGMTX.CMPCOD,
					   BLGMTX.BLGMTXCOD,
					   BLGMTX.BLGMTXDES
				 FROM MALMRABLGMTX BLGMTX
				 WHERE BLGMTX.CMPCOD=?
			       ]]>
			    </QRY:Source>
		    </QRY:Definition>
	<!-- Added for findBillingMatrixLov ends -->
	<!-- Added by A-1872 -->
	<QRY:Definition>
	    <QRY:Id>8</QRY:Id>
	    <QRY:Source Name="mail.mra.defaults.findBillingLines.status" Type="NATIVE">
		<![CDATA[
		    SELECT LIN.CMPCOD CMPCODLIN, LIN.BLGMTXCOD BLGMTXCODLIN,
       			   LIN.BLGLINSEQNUM BLGLINSEQNUMLIN, LIN.BLGLINSTA BLGLINSTALIN,
       			   LIN.VLDSTRDAT VLDSTRDATLIN, LIN.VLDENDDAT VLDENDDATLIN, LIN.BLGBAS,
       			   LIN.REVEXPFLG REVEXPFLGLIN
 			  FROM MALMRABLGMTXLIN LIN
             WHERE LIN.CMPCOD = ?
	       ]]>
	    </QRY:Source>
    </QRY:Definition>

    




    <QRY:Definition>
		            <QRY:Id>10</QRY:Id>
		            <QRY:Source Name="mail.mra.defaults.findBillingLineDetails" Type="NATIVE">
		                <![CDATA[
			                 SELECT LIN.BLGLINSEQNUM,
							  LIN.CMPCOD            ,
							  LIN.BLGMTXCOD         ,
							  LIN.BLGLINSTA         ,
							  LIN.VLDSTRDAT         ,
							  LIN.VLDENDDAT         ,
							  LIN.CURCOD            ,
							  LIN.BILPTYARLIDR      ,
							  CASE WHEN LIN.BILTOOPTYTYP = 'A' THEN  LIN.BILTOOPTYCOD ELSE NULL END BILPTYARLCOD      ,
							  CASE WHEN LIN.BILTOOPTYTYP = 'G' THEN  LIN.BILTOOPTYCOD ELSE NULL END  BILPTYPOACOD      ,
							  LIN.APLRAT            ,
							  LIN.REVEXPFLG         ,
							  LIN.BILSEC            ,
							  LIN.BLGBAS            ,
							  PAR.PARCOD            ,
							  PAR.PARVAL            ,
							  PAR.EXCFLG            ,
							  LIN.LSTUPDUSR         ,
							  LIN.LSTUPDTIM ,
							  LIN.UNTCOD,
						  LIN.RATINCSRVTAXFLG,
						  LGLINRATBSS.CHGTYP,
						   LGLINRATBSS.RATBSS,
						   LGLINRATBSS.FRMWGT,
						   LGLINRATBSS.APPRAT
						FROM MALMRABLGMTXLIN LIN
						INNER JOIN MALMRABLGMTXLINPAR PAR
						ON PAR.CMPCOD        = LIN.CMPCOD
							AND PAR.BLGMTXCOD    = LIN.BLGMTXCOD
							AND PAR.BLGLINSEQNUM = LIN.BLGLINSEQNUM
						LEFT OUTER JOIN MALMRABLGMTXLINBSS LGLINRATBSS
						ON LIN.CMPCOD       =LGLINRATBSS.CMPCOD
						AND LIN.BLGMTXCOD   =LGLINRATBSS.BLGMTXCOD
						AND LIN.BLGLINSEQNUM=LGLINRATBSS.BLGLINSEQNUM
						WHERE  LIN.CMPCOD       = ?


			               ]]>
		            </QRY:Source>
	    </QRY:Definition>
		<QRY:Definition>
		            <QRY:Id>11</QRY:Id>
		            <QRY:Source Name="mail.mra.defaults.findparametersforbillinlines" Type="NATIVE">
		                <![CDATA[
			                SELECT PAR.CMPCOD, PAR.BLGMTXCOD, PAR. BLGLINSEQNUM, PAR.PARCOD, PAR.PARVAL, PAR.EXCFLG
			                FROM MALMRABLGMTXLINPAR PAR
					WHERE PAR.CMPCOD = ?


			               ]]>
		            </QRY:Source>
	    </QRY:Definition>

	<!--<QRY:Definition>
		            <QRY:Id>12</QRY:Id>
		            <QRY:Source Name="mailtracking.mra.defaults.findbillinglinesbyparameters" Type="NATIVE">
		                <![CDATA[
				                SELECT  LIN.CMPCOD CMPCODLIN, LIN.BLGMTXCOD BLGMTXCODLIN, LIN.BLGLINSEQNUM BLGLINSEQNUMLIN, LIN.BLGLINSTA BLGLINSTALIN,
						 	LIN.BILSEC BILSEC,LIN.BILPTYPOACOD BLGMTXPOACOD, LIN.BILPTYARLCOD BILPTYARLCOD, LIN.VLDSTRDAT VLDSTRDATLIN, LIN.VLDENDDAT VLDENDDATLIN,
 							LIN.REVEXPFLG REVEXPFLGLIN, LIN.APLRAT RATE,LIN.BLGBAS BLGBAS,LIN.CURCOD CURRENCY
 						FROM    MTKBLGLIN LIN


				               ]]>
		            </QRY:Source>
	    </QRY:Definition> -->
		<QRY:Definition>
		            <QRY:Id>12</QRY:Id>
		            <QRY:Source Name="mail.mra.defaults.findbillinglinesbyparameters" Type="NATIVE">
		                <![CDATA[
				               WITH bilpar AS
								  %s ,
								  MTX AS
								  (SELECT blg.CMPCOD CMPCODLIN,
									blg.BLGMTXCOD BLGMTXCODLIN,
									blg.BLGLINSEQNUM BLGLINSEQNUMLIN,
									blg.BLGLINSTA BLGLINSTALIN,
									blg.BILSEC BILSEC,
									 CASE WHEN BLG.BILTOOPTYTYP = 'G' THEN  BLG.BILTOOPTYCOD ELSE NULL END BLGMTXPOACOD,
									 CASE WHEN BLG.BILTOOPTYTYP = 'A' THEN  BLG.BILTOOPTYCOD ELSE NULL END  BILPTYARLCOD,
									blg.VLDSTRDAT VLDSTRDATLIN,
									blg.VLDENDDAT VLDENDDATLIN,
									blg.REVEXPFLG REVEXPFLGLIN,
									blg.APLRAT RATE,
									blg.BLGBAS BLGBAS,
									blg.CURCOD CURRENCY,
									blg.untcod untcod,
									par.PARCOD,
									PAR.PARVAL,
									PAR.EXCFLG
								  FROM MALMRABLGMTXLINPAR par
								  INNER JOIN MALMRAPARMST mst
								  ON mst.cmpcod  = par.cmpcod
								  AND mst.parcod = par.parcod
								  INNER JOIN MALMRABLGMTXLIN blg
								  ON blg.cmpcod        = par.cmpcod
								  AND blg.blgmtxcod    = par.blgmtxcod
								  AND blg.BLGLINSEQNUM = par.BLGLINSEQNUM
								  where par.cmpcod = ?
				               ]]>
		            </QRY:Source>
	    </QRY:Definition>

     	<!-- Added by Saravanan for Maintain Prorate Factors starts -->
    	    	<QRY:Definition>
    	    		<QRY:Id>13</QRY:Id>
    	    		<QRY:Source Name="mail.mra.defaults.findprorationfactors" Type="NATIVE">
    	    			<![CDATA[
    	    			SELECT
					PRO.CMPCOD , PRO.FCTSRC,
					PRO.FCTSTA, PRO.PROFCT, PRO.LSTUPDUSR, PRO.VLDFRM,
					PRO.SEQNUM, PRO.VLDTOO, MST.CTYNAM,
					PRO.LSTUPDTIM,PRO.LSTUPDUSR
					FROM CRAPROFCT PRO, SHRCTYMST MST 
				WHERE PRO.CMPCOD = ? 
    	    		]]>
    	    		</QRY:Source>
    	    	</QRY:Definition>
	<!-- Added by Saravanan for Maintain Prorate Factors ends -->

	 <!-- Added by Saravanan for Mail contract starts -->
		

		

		

		

		












	<!-- Added by Saravanan for Mail contract ends -->

	<!-- Added by Shivjith for Contract Lov starts -->

	 



	<!-- Added by Shivjith for Contract Lov ends -->

	<!-- Added by Shivjith for SLA Lov starts -->

	 



	<!-- Added by Shivjith for SLA Lov ends -->


	<!-- Added by Sreekanth for List Mail Contracts  starts -->



	<!-- Added by Sreekanth for List Mail Contracts ends -->

    <!-- Added by Sreekanth for List Mail Contracts WITH VESRION AS &quot;NOT NULL&quot; starts -->



    	<!-- Added by Sreekanth for List Mail Contracts &quot;NOT NULL&quot;  ends -->


    	<!-- Added by Sreekanth for List Mail Contracts WITH VESRION AS &quot;NULL&quot; starts -->



	<!-- Added by Sreekanth for List Mail Contracts &quot;NULL&quot;  ends -->


	<!-- Added by sanjay for Maintain Mail SLA Template starts -->
		


	       










	<!-- Added ny sanjay for Maintain Mail SLA Template ends -->

	<!-- Added by Saravanan for validating billing matrix code starts -->
		<QRY:Definition>
			<QRY:Id>26</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findbillingmatrixcodes" Type="NATIVE">
				<![CDATA[
				SELECT BLGMTXCOD FROM MALMRABLGMTX WHERE CMPCOD = ?
			]]>
			</QRY:Source>
	</QRY:Definition>
	<!-- Added by Saravanan for validating billing matrix code ends -->

	<!-- Added by Saravanan for validating SLA code starts -->
			
	<!-- Added by Saravanan for validating SLA code ends -->
	<!-- Added for Despatch LOV starts -->

	
	<!-- Added for Despatch LOV ends -->

	<!-- Added by Saravanan for validating reporting period starts -->
			<QRY:Definition>
				<QRY:Id>29</QRY:Id>
				<QRY:Source Name="mail.defaults.validatereportingperiod" Type="NATIVE">
				<![CDATA[
					SELECT   DTL.BLGFRQ AS BILFRQ
						FROM SHRBILPRDDTL RPTDTL,
						MALPOADTL DTL,
						MALPOAMST MST
						WHERE DTL.CMPCOD = RPTDTL.CMPCOD
						AND DTL.POACOD = MST.POACOD
						AND DTL.CMPCOD = MST.CMPCOD
						AND DTL.BLGFRQ = RPTDTL.BILPRDCOD
						AND DTL.CMPCOD = ?
						AND DTL.POACOD = ?
						AND DTL.PARCOD = ?
						AND DTL.VLDTOO >= ?
						AND DTL.BLGSRC = ?
						AND RPTDTL.BILFRMPRD =
						((   'D'
						|| TO_CHAR
						(TO_DATE
						(?,
						'dd-mm-yyyy'
						),
						'dd'
						)
						)
						)
						AND CASE RPTDTL.BILENDPRD
						WHEN 'EOM'
						THEN    'D'
						|| TO_CHAR
						(LAST_DAY
						(SYSDATE
						),
						'dd'
						)
						ELSE RPTDTL.BILENDPRD
						END =
						((   'D'
						|| TO_CHAR
						(TO_DATE
						(?,
						'dd-mm-yyyy'
						),
						'dd'
						)
						)
						)
					ORDER BY RPTDTL.SEQNUM


				]]>
				</QRY:Source>
			</QRY:Definition>
	<!-- Added by Saravanan for validating reporting period ends -->
	<!-- Added by Sandeep for ProcessManager Starts-->
		<QRY:Definition>
			<QRY:Id>9</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.importflownmails" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_IMPORTMAIL.SPR_MRA_IMPORT_MAILDATA(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
				)
				]]>
			</QRY:Source>
		</QRY:Definition>
	<!-- Added by Sandeep for ProcessManager ends-->

	<!-- Addded for DOT Rate starts -->
	

	<!-- Addded for DOT Rate ends -->
	<!-- Added by Sandeep for InvoicEnquiry Starts-->
				









	<!-- Added by Sandeep for InvoicEnquiry Ends-->

	<!-- Added by Sandeep for ClaimEnquiry starts-->

	<!-- Added by Sandeep for ClaimEnquiry Ends-->

<!-- Added for processmanager starts -->
			<QRY:Definition>
						<QRY:Id>34</QRY:Id>
						<QRY:Source Name="mail.mra.defaults.importtoreconcile" Type="PROCEDURE">
						<![CDATA[
							CALL Pkg_mal_Mra_Invoic_Reconcil.spr_trf_too_sec(
								?,
								?
							)
							]]>
						</QRY:Source>
					</QRY:Definition>
			<QRY:Definition>
						<QRY:Id>35</QRY:Id>
						<QRY:Source Name="mail.mra.defaults.reconcile" Type="PROCEDURE">
						<![CDATA[
							CALL Pkg_mal_Mra_Invoic_Reconcil.spr_inv_rcl(
								?,
								?
							)
							]]>
						</QRY:Source>
					</QRY:Definition>
<!-- Added for processmanager ends -->

<!-- Added by Saravanan for generating claim file starts -->
	


	<!-- Added by Saravanan for generating claim file ends -->
	<!-- Added for InvoicKey LOV starts -->


	<!-- Added for InvoicKey LOV ends -->
	
		






	<!-- Added by A-3434 for bug fix starts -->
	<QRY:Definition>
					<QRY:Id>10</QRY:Id>
					<QRY:Source Name="mail.mra.defaults.findbillingperiods" Type="NATIVE">
				<![CDATA[
			SELECT to_date(FRMDATE,'dd-mm-yyyy') FRMDATE , to_date(TODATE,'dd-mm-yyyy') TODATE, BILPRDCOD
					  FROM (SELECT BILPRDCOD,
									 TO_CHAR
										((   SUBSTR (BILFRMPRD, 2, 2)
										  || '-'
										  || (SELECT FLDDES
												FROM SHRONETIM SHR
											   WHERE SHR.CMPCOD = DTL.CMPCOD
												 AND SHR.FLDVAL = ?
												 AND FLDTYP =
															'shared.defaults.timezone.monthofyear')
										  || '-'
										  || YEAR
										 )
										) FRMDATE,
									 (   DECODE (SUBSTR (BILENDPRD, 2, 2),
												 'OM', TO_CHAR (LAST_DAY (?), 'DD'),
												 (SUBSTR (BILENDPRD, 2, 2)
												 )
												)
									  || '-'
									  || (SELECT FLDDES
											FROM SHRONETIM SHR
										   WHERE SHR.CMPCOD = DTL.CMPCOD
											 AND SHR.FLDVAL = ?
											 AND FLDTYP = 'shared.defaults.timezone.monthofyear')
									  || '-'
									  || YEAR
									 ) TODATE,
									 YEAR, MONTH, POAMST.POACOD, POAMST.CNTCOD
								FROM SHRBILPRDDTL DTL, MALPOADTL POADTL, MALPOAMST POAMST
							   WHERE MONTH = ?
								 AND DTL.CMPCOD = POADTL.CMPCOD
								 AND DTL.BILPRDCOD = POADTL.BLGFRQ
								 AND ? BETWEEN POADTL.VLDFRM AND POADTL.VLDTOO
								 AND POAMST.POACOD = POADTL.POACOD
								 AND POAMST.CMPCOD = POADTL.CMPCOD
								 AND BILPRDCOD <> 'MON-SUN'
								 AND POADTL.POACOD = ?
							UNION ALL
							SELECT   BILPRDCOD,
									 (   SUBSTR (BILFRMPRD, 2, 2)
									  || '-'
									  || (SELECT FLDDES
											FROM SHRONETIM SHR
										   WHERE SHR.CMPCOD = DTL.CMPCOD
											 AND SHR.FLDVAL = ?
											 AND FLDTYP = 'shared.defaults.timezone.monthofyear')
									  || '-'
									  || YEAR
									 ) FRMDATE,
									 (   DECODE (SUBSTR (BILENDPRD, 2, 2),
												 'OM', TO_CHAR (LAST_DAY (ADD_MONTHS (?, -1)),
																'DD'),
												 (SUBSTR (BILENDPRD, 2, 2))
												)
									  || '-'
									  || (SELECT FLDDES
											FROM SHRONETIM SHR
										   WHERE SHR.CMPCOD = DTL.CMPCOD
											 AND SHR.FLDVAL = ?
											 AND FLDTYP = 'shared.defaults.timezone.monthofyear')
									  || '-'
									  || YEAR
									 ) TODATE,
									 YEAR, MONTH, POAMST.POACOD, POAMST.CNTCOD
								FROM SHRBILPRDDTL DTL, MALPOADTL POADTL, MALPOAMST POAMST
							   WHERE MONTH = ?
								 AND DTL.CMPCOD = POADTL.CMPCOD
								 AND DTL.BILPRDCOD = POADTL.BLGFRQ
								 AND ? BETWEEN POADTL.VLDFRM AND POADTL.VLDTOO
								 AND POAMST.POACOD = POADTL.POACOD
								 AND POAMST.CMPCOD = POADTL.CMPCOD
								 AND BILPRDCOD <> 'MON-SUN'
								 AND POADTL.POACOD=? )
			 z ORDER BY to_DATE(z.FRMDATE, 'DD-MON-YYYY') desc

						]]>
			</QRY:Source>
	</QRY:Definition>
	<!-- Added by Sandeep for generate invoice begins -->
	<QRY:Definition>
		<QRY:Id>37</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.generateinvoice" Type="PROCEDURE">
			<![CDATA[
					CALL PKG_MAL_MRA_GPABILLING_NEW.spr_mra_generateinvoice
					(
						?,
						?,
						?,
						?,
						?,
						?,
						?,
						?,
						?,
						?,
						?,
						?,
						?
					)
				]]>
		</QRY:Source>

	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>38</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.finddespatchdls" Type="NATIVE">
			<![CDATA[
				SELECT MST.CSGDOCNUM,MST.ORGEXGOFC,MST.DSTEXGOFC,MST.MALCTGCOD,
				MST.MALSUBCLS,MST.TOTPCS,DTL.UPDGRSWGT,DTL.FLTDAT,MST.ROU
				FROM MALMRABLGDTL DTL,MALMRABLGMST MST WHERE
				MST.CMPCOD=DTL.CMPCOD AND
				MST.MALSEQNUM=DTL.MALSEQNUM  AND

				DTL.CMPCOD=? AND MST.MALIDR=? AND
				TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD'))=?

			]]>
			</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
	<!--Query MOdified by A-7794 as part of ICRD-252665-->
				<QRY:Id>39</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findgpablgdls" Type="NATIVE">
				<![CDATA[
					SELECT 0 INVSERNUM,
					  MST.DSN,
					  BLGDTL.BLGSTA,
					  BLGDTL.APLRAT,
					  BLGDTL.UPDWGTCHGCTR WGTCHG,
					  BLGDTL.UPDOTHCHGCTR OTHCHG,
					  MST.YER,
					  BLGDTL.RMK,
					  NULL CCAREFNUM,
					  NULL BLGPRDFRM,
					  NULL BLGPRDTOO,
					  NULL INVNUM,
					  NULL POANAM,
					  NULL BLDDAT,
					  NULL GPACOD,
					  BLGDTL.CTRCURCOD CURCOD,
					  NULL INVSTA,
					  BLGDTL.SRVTAX,
					  BLGDTL.NETAMT ,
					   MST.MALIDR BLGBAS
					FROM
					  MALMRAGPABLGDTL BLGDTL,
										       MALMRABLGMST MST
					WHERE
					  MST.MALSEQNUM           = BLGDTL.MALSEQNUM
										   	AND MST.CMPCOD = BLGDTL.CMPCOD


											AND BLGDTL.CMPCOD=?
											AND MST.MALIDR=?
											AND TRUNC(MST.RCVDAT)=?
											AND BLGDTL.BLGSTA = 'BB'
				AND NOT EXISTS(SELECT 1 FROM MALMRAMCA CCADTL WHERE
				CCADTL.CMPCOD=MST.CMPCOD
				AND CCADTL.MALSEQNUM=MST.MALSEQNUM
				)
				]]>
				</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
	<!--Query MOdified by A-4823 for BUG ICRD-18450-->
	<!--Modified for BUG ICRD-101113-->
					<QRY:Id>40</QRY:Id>
					<QRY:Source Name="mail.mra.defaults.finddsnselectlov" Type="NATIVE">
					<![CDATA[
						SELECT MST.CMPCOD, MST.MALIDR,MST.MALSEQNUM, MST.RCVDAT,
					       MST.DSN, MST.CSGDOCNUM, MST.CSGSEQNUM,MST.MRASTA,
					       MST.POACOD,MST.RSN,MST.HSN,MST.REGIND,
       						(SELECT COUNT ( *)
								  FROM MALMRABLGDTL DTL
								 WHERE DTL.CMPCOD = MST.CMPCOD
								   AND DTL.MALSEQNUM = MST.MALSEQNUM
								   ) DTLCOUNT,MST.MALSRC,MST.TRFCARCOD,MST.TRFPOACOD
					  FROM MALMRABLGMST MST
					 WHERE MST.CMPCOD = ?


					]]>
					</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
				<QRY:Id>41</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findrateauditdetails" Type="NATIVE">
				    <![CDATA[
			       SELECT MST.CMPCOD, MST.MALIDR, MST.CSGDOCNUM,
						   MST.CSGSEQNUM, MST.DSN, MST.RCVDAT DSNDAT,
						   MST.POACOD, MST.MALCTGCOD,
						   MST.MALSUBCLS MALCLS,
						   MST.MALSUBCLS MALSUBCLS, MST.ORGEXGOFC,
						   MST.DSTEXGOFC, MST.TOTPCS, MST.GRSWGT,
						   NULL, DTL.APPAUD, DTL.DISPCY,
						   DTL.FLTCARCOD, DTL.FLTNUM, DTL.FLTDAT,
						   DTL.APLRAT, DTL.WGTCHG, DTL.UPDWGTCHG,
						   DTL.UPDBILLTO, DTL.SERNUM, MST.LSTUPDTIM,
						   DTL.CTRCURCOD, DTL.GPAARLBLGFLG,DTL.FULCHG,DTL.RATIND
					  FROM MALMRABLGMST MST
					  left outer join
					  MALMRABLGDTL DTL
					  on
						  MST.CMPCOD = DTL.CMPCOD
					   AND MST.MALSEQNUM = DTL.MALSEQNUM
					   AND DTL.PAYFLG = 'R'

				   ]]>
				</QRY:Source>
    	</QRY:Definition>
    	<QRY:Definition>
				<QRY:Id>42</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findlistrateauditdtls" Type="NATIVE">
				<![CDATA[
					SELECT MST.MALIDR BLGBAS,MST.RCVDAT DSNDAT,NULL RATSTA,
	  					 MST.ORGEXGOFC ORGN,MST.DSTEXGOFC DEST,MST.POACOD GPACOD, MST.CSGDOCNUM CONDOCNUM,MST.ROU ROTE,
						   MST.TOTPCS NPCS,GPADTL.UPDGRSWGT GRWGT, MST.MALCTGCOD MALCATCOD,MST.MALSUBCLS MALSUBCLS,MST.ULDNUM ULDNUM,
						   GPADTL.FLTCARCOD CARCOD,DTL.FLTNUM FLTNUM,DTL.APLRAT RATE,GPADTL.WGTCHGBAS PRWTCHRG,GPADTL.UPDWGTCHGBAS
						   AUDWTCHRG,
               --DTL.DISPCY DISPCY,
               GPADTL.UPDBILTOOPOA BILLTO,DTL.PAYFLG PAYFLG,
               --DTL.APPAUD APPAUD,

						  	  -- GPADTL.SERNUM	SERNUM,a-8061
              DTL.SERNUM	SERNUM,DTL.MALSEQNUM,

						   MST.CSGSEQNUM CSGSEQNUM,MST.CMPCOD CMPCOD,DTL.SECFRM SECFRM,DTL.SECTOO SECTOO,

                -- DTL.GPAARLBLGFLG GPAARLBLGFLG,
                GPADTL.BLGSTA BLGSTA,DTL.FLTCARIDR FLTCARIDR,
                 --GPADTL.BLGRAT BLGRAT,
						   MST.LSTUPDTIM LSTUPDTIM,MST.LSTUPDUSR LSTUPDUSR,
					       GPADTL.UPDWGTCHGUSD WGTCHGUSD,GPADTL.UPDWGTCHGXDR WGTCHGSDR,GPADTL.WGTCHGBAS WGTCHGBAS,GPADTL.CTRCURCOD CTRCURCOD,
					       DTL.BILTOOARLIDR UPDBILTOOIDR,MST.DSN DSN,
                 --MST.BASTYP,
                 MST.YER,DTL.FLTDAT,DTL.FLTSEQNUM,DTL.PROTYP,
					       NULL,MST.HSN,MST.REGIND,MST.RSN,NULL,GPADTL.ACCTXNIDR,GPADTL.DUEPOA,DTL.PROPRC,DTL.PROVAL,DTL.REVFLG,GPADTL.RMK,
					       DTL.DUEARL,GPADTL.SEGSERNUM,MST.POAFLG,
                 DTL.SECSTA,
                 MST.TRFCARCOD,GPADTL.FULCHG
                 ,GPADTL.RATIND

					  FROM MALMRABLGMST MST, MALMRABLGDTL DTL,MALMRAGPABLGDTL GPADTL
					 WHERE MST.CMPCOD = DTL.CMPCOD
					   AND MST.MALSEQNUM = DTL.MALSEQNUM
             AND MST.CMPCOD = GPADTL.CMPCOD
					   AND MST.MALSEQNUM = GPADTL.MALSEQNUM
					   AND DTL.CMPCOD=? AND  MST.MALIDR=?
					   AND TRUNC(MST.RCVDAT) = ?

				]]>
				</QRY:Source>
	</QRY:Definition>
	<!-- Added by Muralee for MaintainCCA starts -->

	<QRY:Definition>
				<QRY:Id>43</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findccarefdtls" Type="NATIVE">
				<![CDATA[
                   SELECT RTG.FLTCARIDR                   ,
							  RTG.FLTCARCOD                         ,
							  RTG.FLTDAT                            ,
							  RTG.FLTNUM                            ,
							  RTG.POL                               ,
							  RTG.POU                               ,
							  RTG.RTGSERNUM                         ,
							  CCADTL.CMPCOD                         ,
							  BLGMST.MALIDR                         ,
							  BLGMST.MALSEQNUM                      ,
							  CCADTL.MCAREFNUM                      ,
							  CCADTL.GPACOD                         ,
							  CCADTL.GPANAM                         ,
							  CCADTL.MCASTA                         ,
							  BLGMST.ORGARPCOD                         ,
							  BLGMST.DSTARPCOD                         ,
							  BLGMST.CSGDOCNUM                      ,
							  BLGMST.CSGSEQNUM                      ,
							  BLGMST.POACOD                         ,
							  CCADTL.BLGSTA,
				        BLGMST.DSTARPCOD DSNDSTCOD,
				        BLGMST.ORGARPCOD DSNORGCOD,
                		 BLGMST.MALCTGCOD CATCOD,
						 BLGMST.MALSUBCLS SUBCLS,
							  CCADTL.ISSDAT                         ,
							  NULL ISSPARTY							,
							  CCADTL.MCATYP                         ,
							  NULL                      ,
							  CCADTL.BILPRDFRM                         ,
							  CCADTL.BILPRDTOO                         ,
							  BLGMST.RCVDAT DSNDAT                 ,
							  CCADTL.REVGRSWGT                      ,
							  CCADTL.REVCTRCURCOD                   ,
							  CCADTL.REVSRVTAX                      ,
							  CCADTL.REVWGTCHGCTR                      ,
							   CCADTL.REVOTHCHGCTR                      ,
							   CCADTL.REVNETAMT,
								CCADTL.REVTDS,
							  CCADTL.DUEARL                         ,
							  CCADTL.DUEPSTDBT                      ,
							  CCADTL.REVDUEARL                      ,
							  CCADTL.REVDUEPSTDBT                   ,
							  BLGMST.ORGARPCOD                     ,
							  BLGMST.DSTARPCOD                      ,
							  CCADTL.REVGPACOD                      ,
							  CCADTL.REVGPANAM                      ,
							  CCADTL.MCARMK                         ,
							  'G' GPAARLBLGFLG                    ,
							  NULL                      ,
							  CCADTL.GPACHGIND                      ,
							  CCADTL.GRSWGTIND                      ,
							  CCADTL.WGTCHGIND                      ,
							  NULL                      ,
							  CCADTL.CURCHGIND                      ,
							  CCADTL.GRSWGT GRSWGT                  ,
							  BLGMST.DSPWGT,
						      BLGMST.DSPWGTUNT,
							  CCADTL.WGTCHGCTR CHGWGT                  ,
							  CCADTL.OTHCHGCTR OTHCHG                  ,
							  CCADTL.SRVTAX,
							  CCADTL.NETAMT,
							  CCADTL.TDS,
							  CCADTL.MCAREFNUM                      ,
							  'G'                     ,
							  BLGMST.DSN                            ,
							  CCADTL.SECFRM SECFRM                  ,
							  CCADTL.SECTOO SECTOO                  ,
							  CCADTL.LSTUPDTIM LSTUPDTIM            ,
							  CCADTL.LSTUPDUSR                      ,
							  CCADTL.CTRCURCOD CTRCURCOD            ,
							  CCADTL.AUTMCA                         ,
                              CCADTL.RAT,
							  CCADTL.REVRAT,
							  NULL PAYFLAG                         ,
							  BLGDTL.BILTOOPOA                      ,
							  BLGDTL.UPDBILTOOPOA                      ,
							  BLGDTL.SERNUM                      ,
							  BLGDTL.UNTCOD,
							  NULL BILTOOARLIDR                   ,
							  NULL UPDBILTOOIDR                   ,
							  NULL ISSPARTY							,
							 -- POAMST.CNTCOD,
							  BLGDTL.VALCHGCTR            ,
							  CCADTL.MCARSNCOD,
							  BLGMST.ACTULDWGT, BLGMST.ACTULDWGTUNT ,BLGMST.poaflg,
							  CASE WHEN BLGMST.POAFLG='Y' AND( INSTR(PAR.PARVAL,BLGMST.POACOD)>0 OR PAR.PARVAL='ALL') THEN 'Y' ELSE 'N' END CNTRATENBPOA
					   FROM MALMRAMCA CCADTL
					 LEFT OUTER JOIN  MALMRABLGMST BLGMST ON
					  CCADTL.CMPCOD = BLGMST.CMPCOD
                        -- AND CCADTL.GPACOD = BLGMST.POACOD
                         AND CCADTL.MALSEQNUM = BLGMST.MALSEQNUM
					 LEFT OUTER JOIN  MALMRAGPABLGDTL BLGDTL     ON
					 CCADTL.CMPCOD     = BLGDTL.CMPCOD
                         AND CCADTL.MALSEQNUM = BLGDTL.MALSEQNUM
					  LEFT OUTER JOIN MALMRARTG RTG       ON
					   CCADTL.CMPCOD     = RTG.CMPCOD
                         AND CCADTL.MALSEQNUM = RTG.MALSEQNUM
						-- INNER JOIN MALPOAMST POAMST
						-- ON POAMST.CMPCOD = RTG.CMPCOD
						LEFT OUTER JOIN SHRSYSPAR PAR
						ON PAR.CMPCOD=BLGMST.CMPCOD
						AND PAR.PARCOD='mailtracking.mra.PAlisttoapplycontainerrate'
					  WHERE CCADTL.CMPCOD     = ?

				]]>
				</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>

				<QRY:Id>44</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findcca" Type="NATIVE">

				<![CDATA[
				     SELECT COALESCE (CCADTL.MCAREFNUM, CCADTL.MCAREFNUM ) CCANUM,
						  MCATYP                                                     ,
						  NULL ISSPARTY                                                 ,
						  ISSDAT                                                     ,
						  MCASTA                                                     ,
						  BILPRDFRM                                                  ,
						  BILPRDTOO                                                  ,
						 BLGMST.DSN                                                        ,
						  BLGMST.RCVDAT                                                  ,
						  NETAMT                                                     ,
						  REVWGTCHGCTR                                               ,
						  WGTCHGCTR,
						  OTHCHGCTR,
						  REVOTHCHGCTR,
						  SRVTAX,
						  REVSRVTAX,
						  BLGMST.MALIDR,
						  BLGMST.MALSEQNUM,
						  BLGSTA,
						  REVCTRCURCOD,
						  RAT,
						  REVRAT,
						  CCADTL.REVGPACOD,
						  CCADTL.GPACOD,
                          CCADTL.REVGRSWGT,
                          CCADTL.GRSWGT,
                          BLGMST.DSPWGT,
						  BLGMST.DSPWGTUNT

                     FROM MALMRAMCA CCADTL LEFT OUTER JOIN  MALMRABLGMST BLGMST ON
                     CCADTL.CMPCOD = BLGMST.CMPCOD
					  AND CCADTL.MALSEQNUM = BLGMST.MALSEQNUM
                     WHERE CCADTL.CMPCOD=?
				]]>
				</QRY:Source>
	</QRY:Definition>



	<!-- Added by Muralee for MaintainCCA ends -->
	<QRY:Definition>
			<QRY:Id>45</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listcca" Type="NATIVE">
			<![CDATA[
				 SELECT MALMRAMCA.CMPCOD,
						  MALMRABLGMST.MALIDR      ,
						  MALMRABLGMST.MALSEQNUM      ,
						  MALMRABLGMST.POACOD      ,
				       MALMRAMCA.CTRCURCOD,
				       MALMRABLGMST.CSGDOCNUM,
				       MALMRABLGMST.CSGSEQNUM,
						  MALMRAMCA.GPACOD      ,
						  MALMRABLGMST.DSN         ,
						  MALMRABLGMST.RCVDAT     ,
						  MALMRAMCA.REVGPACOD   ,
						  MALMRAMCA.GPANAM      ,
						  MALMRAMCA.REVGRSWGT ,
                          MALMRAMCA.REVCTRCURCOD,
						  MALMRAMCA.MCATYP      ,
						  NULL  ISSPARTY  ,
						  MALMRAMCA.ISSDAT      ,
						  MALMRAMCA.REVDUEARL   ,
						  MALMRAMCA.DUEARL      ,
						  MALMRAMCA.REVDUEPSTDBT,
						  MALMRAMCA.DUEPSTDBT   ,
				       MALMRAMCA.MCAREFNUM,
						  MALMRAMCA.MCASTA      ,
						  MALMRAMCA.MCARMK      ,
						  NULL      ,
						  MALPOAMST.POANAM         ,

				       MALMRAMCA.LSTUPDUSR,
						  MALMRAMCA.LSTUPDTIM,
						  MALMRAMCA.WGTCHGCTR,
						  MALMRAMCA.REVWGTCHGCTR,
						  MALMRAMCA.SRVTAX,
						  MALMRAMCA.REVSRVTAX,
						  MALMRABLGMST.ORGARPCOD,
						  MALMRABLGMST.DSTARPCOD,
						  MALMRABLGMST.ORGEXGOFC,
                           MALMRABLGMST.DSTEXGOFC,
							MALMRABLGMST.MALCTGCOD,
							MALMRABLGMST.MALSUBCLS,
							MALMRABLGMST.YER,
							MALMRABLGMST.RSN,
							MALMRABLGMST.HSN,
							MALMRABLGMST.REGIND,
							MALMRABLGMST.DSPWGTUNT,
							MALMRABLGMST.DSPWGT,
							MALMRAMCA.OTHCHGCTR,
							 MALMRAMCA.BLGSTA,
							MALMRAMCA.REVOTHCHGCTR,
							MALMRAMCA.AUTMCA,
							MALMRAMCA.MCARSNCOD,
							MALMRABLGMST.RCVDAT DSNDAT,
							 MALMRAGPABLGDTL.SERNUM
						   FROM MALMRAMCA left outer join MALMRABLGMST on (MALMRAMCA.CMPCOD        = MALMRABLGMST.CMPCOD
  AND MALMRAMCA.MALSEQNUM       = MALMRABLGMST.MALSEQNUM)
  left outer join MALMRAGPABLGDTL on (MALMRAMCA.CMPCOD          = MALMRAGPABLGDTL.CMPCOD
  AND MALMRAMCA.MALSEQNUM       = MALMRAGPABLGDTL.MALSEQNUM) left outer join 
    MALPOAMST on ( MALMRAGPABLGDTL.CMPCOD    = MALPOAMST.CMPCOD
  AND MALMRAGPABLGDTL.BILTOOPOA = MALPOAMST.POACOD)
    
    
  WHERE 
   MALMRAMCA.CMPCOD          = ?
  

			]]>
			</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>
			<QRY:Id>36</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listProrationDetails" Type="NATIVE">
			<![CDATA[
			SELECT
  MST.MALIDR,
  MST.MALSEQNUM,
  DTL.CMPCOD,
  MST.CSGDOCNUM,
  MST.CSGSEQNUM,
  DTL.SERNUM,
  DTL.FLTCARIDR,
  DTL.SECFRM,
  DTL.SECTOO,
  MST.TOTPCS,
  DTL.UPDGRSWGT,
  DTL.PROTYP,
  DTL.PROVAL,
  DTL.PROPRC,
  DTL.PAYFLG,
  DTL.WGTCHGCTR WGTCHG,
  DTL.WGTCHGUSD,
  DTL.WGTCHGXDR,
  DTL.WGTCHGBAS,
  DTL.OTHCHGCTR,
  GPADTL.UPDOTHCHGCTR,
  DTL.OTHCHGBAS,
  DTL.OTHCHGUSD,
  DTL.OTHCHGXDR,
  COALESCE(DTL.SECSTA,'N') SECTSTA,
  MST.ORGEXGOFC,
  MST.DSTEXGOFC,
  MST.MALIDR BLGBAS,
  MST.GRSWGT,
  MST.MALCTGCOD,
  MST.MALSUBCLS,
		        ARLMST.TWOAPHCOD,
  ARLMST.THRAPHCOD,
  ARLMST.APHCODUSE,
  ARLMST.BASCURCOD BASCUR,
  DTL.CTRCURCOD,
  POAMST.POANAM,
  NULL ,
  NULL,
  MST.RCVDAT,
  DTL.FLTDAT,
  DTL.FLTNUM,
  DTL.FLTCARCOD,
  'N' APPAUD,
  CASE DTL.BILTOOPTYTYP WHEN 'G' THEN
  GPADTL.UPDBILTOOPOA
  WHEN 'A' THEN
  NULL
  END POACOD,
  DTL.WGTCHGCTR,
  DTL.BLGSTA,
  NULL ACCSTA,
  DTL.ACCTXNIDR,
  DTL.DUEARL,
  DTL.NETAMT DUEPOA,
  DTL.REVFLG,
  DTL.SEGSERNUM,
  DTL.BILTOOPTYCOD,
  DTL.BILTOOPTYTYP,
  MST.RSN,
  MST.DSN,
  DTL.BSAREF,
  MST.DSPWGTUNT,
  DTL.CODSHRIND
FROM
  MALMRABLGMST MST INNER JOIN
  MALMRABLGDTL DTL ON MST.CMPCOD=DTL.CMPCOD
  AND MST.MALSEQNUM=DTL.MALSEQNUM
		  LEFT OUTER JOIN MALPOAMST POAMST
ON
   DTL.CMPCOD  =POAMST.CMPCOD
	AND DTL.BILTOOPTYCOD = POAMST.POACOD
		  LEFT OUTER JOIN SHRARLMST ARLMST
ON
  DTL.CMPCOD      = ARLMST.CMPCOD
		     AND DTL.FLTCARCOD = ARLMST.TWOAPHCOD
			 LEFT OUTER JOIN MALMRAGPABLGDTL GPADTL
  ON  GPADTL.CMPCOD     = DTL.CMPCOD
AND GPADTL.MALSEQNUM   = DTL.MALSEQNUM

WHERE
  DTL.CMPCOD     = MST.CMPCOD
AND DTL.MALSEQNUM   = MST.MALSEQNUM


			]]>
			</QRY:Source>
		</QRY:Definition>

		<!--

	<QRY:Definition>
				<QRY:Id>46</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findintrlinblgentriesinblgdtl" Type="NATIVE">
				<![CDATA[

				SELECT DISTINCT DTL.CMPCOD CMPCOD,DTL.CSGDOCNUM CSGDOCNUM,DTL.CSGSEQNUM 	CSGSEQNUM,DTL.BLGBAS BLGBAS,
											DTL.SERNUM SERNUM ,DTL.POACOD POACOD,DTL.CTRCURCOD CURCOD,MST.DSN DSN,MST.DSTEXGOFC DSTCOD,MST.ORGEXGOFC ORGCOD,
											MST.MALCTGCOD CTGCOD,MST.MALSUBCLS SUBCLS,DTL.FLTDAT DAT,MST.YER YEAR,DTL.UPDPCS PCS,DTL.BLGSTA STA,
											DTL.REVFLG REV,DTL.RMK RMK,DTL.SECFRM SECFRM,DTL.SECTOO SECTO,DTL.UPDWGT WGT,NULL INTBLGTYP,
											NULL INVNUM,DTL.APLRAT RAT,DTL.UPDWGTCHG AMT,
											 (SELECT DISTINCT (CCAREFNUM)
											                            FROM MTKMRACCADTL DTL1
											                           WHERE CMPCOD = DTL.CMPCOD
											                             AND BLGBAS = DTL.BLGBAS
											                             AND CSGDOCNUM = DTL.CSGDOCNUM
											                             AND CSGSEQNUM = DTL.CSGSEQNUM
											                             AND POACOD = DTL.POACOD
											                             AND ISSDAT =
											                                         (SELECT MAX(ISSDAT)
											                                            FROM MTKMRACCADTL
											                                           WHERE CMPCOD = DTL1.CMPCOD
											                                             AND BLGBAS = DTL1.BLGBAS
											                                             AND CSGDOCNUM = DTL1.CSGDOCNUM
											                                             AND CSGSEQNUM = DTL1.CSGSEQNUM
											                                             AND POACOD = DTL1.POACOD
											                                             AND PAYFLG = 'R'
											                                             AND CCATYP = 'A'
											                                             AND CCASTA IN('OB', 'IU')
											                                             AND ARLGPAIND = 'A')
											                             AND ARLGPAIND = 'A'
											                             AND PAYFLG = 'R'
											                             AND CCASTA IN('OB', 'IU')
                             									AND CCATYP = 'A') CCAREFNUM,
											NULL CCATYP,
											DTL.UPDBILLTO ARLCOD,NULL LSTUPDTIM
											FROM MTKMRABLGMST MST,MTKMRABLGDTL DTL,MTKMRACCADTL CCADTL
												WHERE MST.CMPCOD=DTL.CMPCOD
												AND MST.BLGBAS=DTL.BLGBAS
												AND MST.CSGDOCNUM=DTL.CSGDOCNUM
												AND MST.CSGSEQNUM=DTL.CSGSEQNUM
												AND MST.CMPCOD = CCADTL.CMPCOD(+)
											        AND MST.BLGBAS = CCADTL.BLGBAS(+)
											       AND MST.CSGDOCNUM = CCADTL.CSGDOCNUM(+)
											       AND MST.CSGSEQNUM = CCADTL.CSGSEQNUM(+)
											       AND MST.POACOD = CCADTL.POACOD(+)
												AND (DTL.BLGSTA='IU' OR DTL.BLGSTA='OB'OR DTL.BLGSTA='OH')
												AND DTL.GPAARLBLGFLG='A'
												AND DTL.PAYFLG<>'T'
												AND MST.CMPCOD=

				]]>
			</QRY:Source>


			</QRY:Definition>
							-->


<QRY:Definition>
<QRY:Id>46</QRY:Id>
<QRY:Source Name="mail.mra.defaults.findintrlinblgentriesinblgdtl" Type="NATIVE">
<![CDATA[

		(SELECT DTL.CMPCOD CMPCOD,
		        MST.CSGDOCNUM CSGDOCNUM,
		        MST.CSGSEQNUM CSGSEQNUM,
        MST.MALIDR BLGBAS,
		MST.MALSEQNUM MALSEQNUM,
        DTL.SERNUM SERNUM,
        MST.POACOD POACOD,
        DTL.CTRCURCOD CURCOD,
		DTL.RATCOD RATIDF,
		DTL.RATLINIDR,
        DTL.RATTYP,
        MST.DSN DSN,
        DSTEXG.CTYCOD DSTCOD,
		        ORGEXG.CTYCOD ORGCOD,
		        MST.MALCTGCOD CTGCOD,
        MST.MALSUBCLS SUBCLS,
        DTL.FLTDAT DAT,
        MST.YER YER,
        MST.ORGEXGOFC ORGEXGOFC,
        MST.DSTEXGOFC DSTEXGOFC,
        MST.RSN RSN,
        MST.HSN HSN,
        MST.REGIND REGIND,
        MST.TOTPCS PCS,
        DTL.BLGSTA STA,
        DTL.REVFLG REV,
        DTL.RMK RMK,
        DTL.SECFRM SECFRM,
        DTL.SECTOO SECTO,
        DTL.UPDGRSWGT WGT,
        0 REVGRSWGT,
        NULL INTBLGTYP,
        NULL INVNUM,
        DTL.APLRAT RAT,
        DTL.WGTCHGCTR AMT,
		        (SELECT DISTINCT (MCAREFNUM)
		                    FROM MALMRAMCA
        WHERE CMPCOD  = DTL.CMPCOD
		                     AND MALSEQNUM = DTL.MALSEQNUM
		                     AND ISSDAT =
          (SELECT MAX (ISSDAT )
          FROM MALMRAMCA
          WHERE CMPCOD  = DTL.CMPCOD
          AND MALSEQNUM    = DTL.MALSEQNUM
          AND MCATYP    = 'A'
          AND MCASTA    = 'OB'
		                                                 )
		                     AND MCASTA = 'OB'
        AND MCATYP = 'A'
        ) CCAREFNUM ,
        NULL CCATYP,
        ARL.TWOAPHCOD ARLCOD,
        NULL LSTUPDTIM,
        NULL MEMO,
        NULL OUTINVNUM,
        NULL INWINVNUM,
        0 ARLIDR,
        NULL MEMCOD
		   FROM MALMRABLGMST MST,
		        MALMRABLGDTL DTL,
		        MALEXGOFCMST ORGEXG,
		        MALEXGOFCMST DSTEXG,
SHRARLMST_VW ARL
		  WHERE MST.CMPCOD = DTL.CMPCOD
		    AND MST.MALSEQNUM = DTL.MALSEQNUM
		    AND ORGEXG.CMPCOD = MST.CMPCOD
		    AND ORGEXG.EXGOFCCOD = MST.ORGEXGOFC
		    AND DSTEXG.CMPCOD = MST.CMPCOD
		    AND DSTEXG.EXGOFCCOD = MST.DSTEXGOFC
			AND ARL.CMPCOD = DTL.CMPCOD
      AND ARL.ARLIDR = DTL.BILTOOARLIDR
		    AND (   DTL.BLGSTA = 'IU'
		         OR DTL.BLGSTA = 'OB'
      OR DTL.BLGSTA          = 'OH'

	  OR DTL.BLGSTA          = 'VD' 

		OR DTL.BLGSTA          = 'IB'	  )
		    AND DTL.PAYFLG <> 'T'
    		AND MST.CMPCOD =
]]>
</QRY:Source>


</QRY:Definition>



		<QRY:Definition>
		<QRY:Id>47</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findintrlinblgentriesinc66dtl" Type="NATIVE">
		<![CDATA[
		SELECT C66DTL.CMPCOD CMPCOD,
				MST.CSGDOCNUM CSGDOCNUM,
				MST.CSGSEQNUM CSGSEQNUM            ,
				MST.MALIDR BLGBAS      ,
				MST.MALSEQNUM MALSEQNUM ,
				C66DTL.SEQNUM SERNUM               ,
				MST.POACOD POACOD      ,
				C66DTL.LSTCURCOD CURCOD      ,
				NULL RATIDF,
                NULL RATLINIDR,
                NULL RATTYP,
				C66DTL.DSN DSN            ,
				C66DTL.DSTCOD DSTCOD      ,
				C66DTL.ORGCOD ORGCOD      ,
				C66DTL.MALCTGCOD CTGCOD   ,
				MST.MALSUBCLS SUBCLS   ,
				C66DTL.DSNDAT DAT         ,
        MST.YER YER,MST.ORGEXGOFC,MST.DSTEXGOFC,
        MST.RSN,MST.HSN,MST.REGIND,
        MST.TOTPCS PCS,


				C66DTL.MALSTA STA                  ,
				NULL REV                  ,
				NULL RMK                  ,
				C66DTL.CARFRM SECFRM      ,
				C66DTL.CARTOO SECTO       ,
				C66DTL.TOTWGT WGT         ,
				NULL REVGRSWGT			  ,
				C66DTL.INTBLGTYP INTBLGTYP,
				C66DTL.INVNUM INVNUM      ,
				C66DTL.APLRAT RAT         ,
				C66DTL.BLDAMTLSTUR AMT         ,
				C66DTL.CCAREFNUM CCAREFNUM,
				NULL CCATYP               ,
				C66DTL.CARCOD ARLCOD      ,
				C66DTL.LSTUPDTIM LSTUPDTIM,
				NULL MEMO                 ,
				NULL OUTINVNUM            ,
				NULL INWINVNUM            ,
				0 ARLIDR               ,
				NULL MEMCOD
				FROM MALMRAARLC66DTL C66DTL
      INNER JOIN MALMRABLGMST MST
      ON MST.CMPCOD    = C66DTL.CMPCOD
   --   AND MST.MALIDR   =C66DTL.BLGBAS
        AND MST.MALSEQNUM   =C66DTL.MALSEQNUM
     -- AND MST.CSGDOCNUM=C66DTL.CSGDOCNUM
     -- AND MST.CSGSEQNUM=C66DTL.CSGSEQNUM
		AND C66DTL.SEQNUM = (SELECT MAX(SEQNUM) FROM MALMRAARLC66DTL WHERE CMPCOD=MST.CMPCOD AND MALSEQNUM = MST.MALSEQNUM)
				WHERE COALESCE(C66DTL.MALSTA,'P') IN ('P','E','A','T','D')
				AND C66DTL.CMPCOD =


		]]>
		</QRY:Source>


		</QRY:Definition>


	    <QRY:Definition>
			<QRY:Id>48</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.viewflightsectorrevenue" Type="NATIVE">
			<![CDATA[
				SELECT DTL.CMPCOD, DTL.UPDGRSWGT, DTL.CTRCURCOD,
				       DTL.WGTCHGCTR, DTL.WGTCHGBAS, DTL.PAYFLG,
				       NULL, MST.DSN, DTL.FLTNUM,
				       DTL.SECFRM, DTL.SECTOO, DTL.FLTDAT,MST.MALIDR,MST.CSGDOCNUM,MST.CSGSEQNUM,MST.POACOD,'D' SRCFLG
				  FROM MALMRABLGMST MST LEFT OUTER JOIN MALMRABLGDTL DTL
				       ON MST.CMPCOD = DTL.CMPCOD
				     AND MST.MALSEQNUM = DTL.MALSEQNUM
				 WHERE MST.CMPCOD = ?
				   AND DTL.PAYFLG = ?
				   AND DTL.FLTCARCOD = ?
				   AND DTL.FLTNUM = ?
				   AND trunc(DTL.FLTDAT)= ?
				   AND DTL.SECFRM = ?
				   AND DTL.SECTOO = ?
				UNION ALL
				SELECT NULL,1, NULL, 0, 0, NULL, NULL, MST.DSN,
				       NULL, NULL, NULL, NULL,MST.MALIDR,MST.CSGDOCNUM,MST.CSGSEQNUM,MST.POACOD, 'M' SRCFLG
				  FROM MALMRARTG RTG, MALMRABLGMST MST LEFT OUTER JOIN MALMRABLGDTL DTL
				  ON MST.CMPCOD = DTL.CMPCOD
				     AND MST.MALSEQNUM = DTL.MALSEQNUM
					WHERE  NOT EXISTS
					 (SELECT 'X' FROM
						    MALMRABLGDTL
								 WHERE CMPCOD =  MST.CMPCOD
							     AND MALSEQNUM =    MST.MALSEQNUM
					 AND  MST.CMPCOD = RTG.CMPCOD
					 AND  MST.MALSEQNUM = RTG.MALSEQNUM
					 AND RTG.CMPCOD = ?
				    AND RTG.FLTCARCOD = ?
				    AND RTG.FLTNUM = ?
				    AND trunc(RTG.FLTDAT) = ?
				    AND RTG.POL = ?
    				AND RTG.POU = ?

			]]>
			</QRY:Source>
	</QRY:Definition>




	<QRY:Definition>
			<QRY:Id>50</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.outward.generateinvoice" Type="PROCEDURE">
				<![CDATA[
					CALL PKG_MAL_MRA_ARLBLG_NEW.SPR_GEN_MRA_OUTBLGINV(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
					)
			]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
				<QRY:Id>51</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findccadtls" Type="NATIVE">
				<![CDATA[
						 SELECT DISTINCT BLGMST.CMPCOD              ,
										  BLGMST.MALIDR                            ,
										  BLGMST.MALSEQNUM                            ,
										  BLGMST.CSGDOCNUM                         ,
										  BLGMST.CSGSEQNUM                         ,
										  BLGMST.POACOD                            ,
										  POAMST.POANAM GPANAM                     ,
										  POAMST.POACOD GPACOD                     ,
										  POAMST.CNTCOD,
							  BLGMST.ORGARPCOD DSNORGCOD,
							  BLGMST.DSTARPCOD DSNDSTCOD ,
							  BLGMST.malctgcod CATCOD               ,
							  BLGMST.malsubcls SUBCLS               ,
										  BLGMST.RCVDAT DSNDAT                     ,
										  BLGMST.ACTULDWGT ACTULDWGT, BLGMST.ACTULDWGTUNT ACTULDWGTUNT,BLGMST.POAFLG POAFLG ,
										  BLGDTL.BILTOOPOA                         ,
										  BLGDTL.UPDGRSWGT GRSWGT                     ,
										  BLGDTL.UPDWGTCHGCTR CHGWGT                  ,
										    BLGDTL.UPDOTHCHGCTR OTHCHG ,
										  BLGDTL.SRVTAX                            ,
							  BLGDTL.NETAMT,
							  BLGDTL.TDS,
										  BLGDTL.SERNUM,
										  BLGDTL.WGTCHGCTR                            ,
										  NULL PAYFLG                            ,
										RTG.FLTCARIDR                            ,
										  RTG.FLTCARCOD                            ,
										  RTG.FLTDAT                               ,
										  RTG.FLTNUM                               ,
										  RTG.POL                                  ,
										  RTG.POU                                  ,
										  RTG.RTGSERNUM                            ,
										  BLGDTL.NETAMT DUEARL                     ,
										  BLGDTL.DUEPOA DUEPSTDBT                  ,
										  BLGDTL.SECFRM SECFRM                     ,
										  BLGDTL.SECTOO SECTOO                     ,
										  BLGDTL.BLGSTA ,
										  BLGMST.LSTUPDTIM LSTUPDTIM               ,
										  BLGMST.LSTUPDUSR LSTUPDTIM               ,
										  BLGDTL.CTRCURCOD CTRCURCOD               ,
										  BLGDTL.UNTCOD   UNTCOD                          ,
										  BLGMST.DSN DSN                           ,
										  CCADTL.MCASTA                            ,
										  CCADTL.MCATYP                            ,
										  CCADTL.ISSDAT                            ,
										  BLGMST.RCVDAT                           ,
										  CCADTL.REVGPACOD                         ,
										  CCADTL.GPACOD                            ,
										  CCADTL.REVCTRCURCOD                      ,
										  CCADTL.CTRCURCOD                         ,
										  CCADTL.REVWGTCHGCTR                         ,
										  CCADTL.WGTCHGCTR CHGWGT   				,
										  CCADTL.REVGRSWGT                         ,
										  CCADTL.GRSWGT                            ,
										  BLGMST.DSPWGT,
                                          BLGMST.DSPWGTUNT,
										  CCADTL.REVSRVTAX                         ,
										    CCADTL.REVOTHCHGCTR ,
										    CCADTL.OTHCHGCTR ,
										  CCADTL.SRVTAX                            ,
										  CCADTL.GPACHGIND                         ,
										  CCADTL.WGTCHGIND                         ,
										  CCADTL.GRSWGTIND                         ,
										  CCADTL.CURCHGIND                         ,
										  CCADTL.MCARMK                            ,
										  CCADTL.AUTMCA                            ,
							  NULL BILTOOARLIDR,
							  C51SMY.BLGPRDFRM,
							  C51SMY.BLGPRDTOO,
							  BLGDTL.VALCHGCTR,
							  BLGDTL.SERNUM,
							  CCADTL.RAT,
							  CCADTL.REVRAT,
							  BLGDTL.APLRAT,
							   CASE WHEN BLGMST.POAFLG='Y' AND( INSTR(PAR.PARVAL,BLGMST.POACOD)>0 OR PAR.PARVAL='ALL') THEN 'Y' ELSE 'N' END CNTRATENBPOA
					  FROM MALMRABLGMST BLGMST
							left outer  JOIN MALMRAGPABLGDTL BLGDTL
											 ON BLGMST.CMPCOD = BLGDTL.CMPCOD
					       AND BLGMST.MALSEQNUM = BLGDTL.MALSEQNUM
							LEFT OUTER JOIN MALMRAGPAC66DTL C66DTL
								 ON C66DTL.CMPCOD=BLGDTL.CMPCOD
							AND C66DTL.MALSEQNUM=BLGDTL.MALSEQNUM
							LEFT OUTER JOIN MALMRAGPAC51SMY C51SMY
								 ON C51SMY.CMPCOD=C66DTL.CMPCOD
							AND C51SMY.GPACOD=C66DTL.GPACOD
							AND C51SMY.INVNUM=C66DTL.INVNUM
							inner JOIN MALMRARTG RTG
											 ON BLGMST.CMPCOD = RTG.CMPCOD
					       AND BLGMST.MALSEQNUM = RTG.MALSEQNUM
										LEFT OUTER JOIN MALMRAMCA CCADTL
											 ON CCADTL.CMPCOD=RTG.CMPCOD
										AND CCADTL.MALSEQNUM    =RTG.MALSEQNUM
										LEFT OUTER JOIN MALPOAMST POAMST
											 ON BLGDTL.CMPCOD = POAMST.CMPCOD
					   	   AND BLGDTL.UPDBILTOOPOA = POAMST.POACOD
						   LEFT OUTER JOIN SHRSYSPAR PAR
							ON PAR.CMPCOD=BLGMST.CMPCOD
							AND PAR.PARCOD='mailtracking.mra.PAlisttoapplycontainerrate'

							  WHERE BLGMST.CMPCOD =?
				]]>
				</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
			<QRY:Id>52</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.computetotforrateauditdetails" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_PRORAT.spr_cpt_tot(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
				    ?,
				    ?
				)
				]]>
			</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
		<QRY:Id>53</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findintrlinblgentriesinccadtl" Type="NATIVE">
		<![CDATA[
			SELECT CCADTL.CMPCOD CMPCOD,
									  MST.CSGDOCNUM CSGDOCNUM,
									  MST.CSGSEQNUM CSGSEQNUM,
									  MST.MALIDR BLGBAS      ,
									  MST.MALSEQNUM MALSEQNUM ,
									  NULL SERNUM               ,
									  MST.POACOD POACOD      ,
									  CCADTL.CTRCURCOD CURCOD   ,
									  NULL RATIDF,
									 NULL RATLINIDR,
									   NULL RATTYP,
									  MST.DSN DSN            ,
									  DSTEXG.CTYCOD DSTCOD      ,
									  ORGEXG.CTYCOD ORGCOD      ,
									  MST.MALCTGCOD CTGCOD      ,
									  MST.MALSUBCLS SUBCLS      ,
									  CCADTL.ISSDAT 	DAT,
									  MST.YER YER              ,
                                      MST.ORGEXGOFC,
                                      MST.DSTEXGOFC,
                                      MST.RSN,
                                      MST.HSN,
                                      MST.REGIND,
									  MST.TOTPCS PCS            ,
									  CCADTL.MCASTA STA         ,
									  NULL REV         ,
									  NULL RMK                  ,
									  CCADTL.SECFRM SECFRM      ,
									  CCADTL.SECTOO SECTO       ,
									  INNERCCADTL.WGT           ,
									  CCADTL.REVGRSWGT REVGRSWGT,
									  NULL INTBLGTYP            ,
									  NULL INVNUM               ,
									  0 RAT                  ,
									  INNERCCADTL. AMT          ,
									  INNERCCADTL.CCAREFNUM     ,
									  CCADTL.MCATYP CCATYP      ,
									  NULL ARLCOD   ,
									  CCADTL.LSTUPDTIM LSTUPDTIM,
									  NULL MEMO                 ,
									  NULL OUTINVNUM            ,
									  NULL INWINVNUM            ,
									  0 ARLIDR               ,
									  NULL MEMCOD
									FROM MALMRAMCA CCADTL
									INNER JOIN MALMRABLGMST MST
									ON MST.CMPCOD = CCADTL.CMPCOD
									AND MST.MALSEQNUM  = CCADTL.MALSEQNUM
									INNER JOIN MALEXGOFCMST ORGEXG
									ON ORGEXG.CMPCOD = MST.CMPCOD
						AND ORGEXG.EXGOFCCOD = MST.ORGEXGOFC
									INNER JOIN MALEXGOFCMST DSTEXG
									ON DSTEXG.CMPCOD = MST.CMPCOD
						AND DSTEXG.EXGOFCCOD = MST.DSTEXGOFC
									INNER JOIN
									  (SELECT CMPCOD               ,
									    MALSEQNUM                     ,
									    SUM(REVGRSWGT - GRSWGT) WGT,
          SUM(REVDUEARL -DUEARL)AMT ,
          MAX(MCAREFNUM) CCAREFNUM
									     FROM MALMRAMCA
									    WHERE CMPCOD = CMPCOD
									  AND MALSEQNUM     = MALSEQNUM
									 GROUP BY CMPCOD ,
									    MALSEQNUM
									  ) INNERCCADTL
									     ON INNERCCADTL.CMPCOD = CCADTL.CMPCOD
									AND INNERCCADTL.MALSEQNUM     = CCADTL.MALSEQNUM
									AND INNERCCADTL.CCAREFNUM  = CCADTL.MCAREFNUM
									WHERE CCADTL.MCASTA      = 'OB'
									AND CCADTL.MCATYP='A'
									AND CCADTL.CMPCOD=

		]]>

		</QRY:Source>


		</QRY:Definition>

	<!-- Added by a-2107 for UNACCOUNTED DISPATCHED ends -->
		<QRY:Definition>
			<QRY:Id>54</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listunaccounteddespatchesfrommraforR1" Type="NATIVE">
			<![CDATA[
				 SELECT   MST.CSGDOCNUM ,
  						  MST.CMPCOD CMPCOD   ,
						  ORGEXG.CTYCOD ORIGIN,
						  DSTEXG.CTYCOD DESTN ,
						  DTL.FLTCARCOD
						  ||' '
						  ||DTL.FLTNUM FLIGHTNO                   ,
						  TO_CHAR(DTL.FLTDAT,'DD-MON-YYYY')FLTDATE,
						  'PP' BILLTYPE                           ,
						  (CTRCURCOD)CURRENCY                     ,
						  DTL.APLRAT RATE                         ,
						  (SELECT WGTCHGCTR
							 FROM MALMRABLGDTL
							WHERE CMPCOD = DTL.CMPCOD
						  AND MALSEQNUM     = DTL.MALSEQNUM
						  AND PAYFLG     = 'R'
						  ) AMOUNT                         ,
						  MST.GRSWGT WGT                   ,
						  DTL.SECFRM                       ,
						  DTL.SECTOO SECTO                 ,
						  DTL.WGTCHGBAS PRORATEDAMOUNTINNZD,
						  'R1' REASONCODE                  ,
						  MST.MALIDR                       ,
						  MST.CSGSEQNUM                    ,
						  MST.POACOD                       ,
						  MST.DSN                          ,
						  MST.RCVDAT ACPDAT                ,
						  DTL.SERNUM                       ,
						  DTL.SEGSERNUM                    ,
						  DTL.FLTSEQNUM                    ,
						  MST.LSTUPDUSR                    ,
						  MST.LSTUPDTIM                    ,
						  DTL.WGTCHGCTR PRORATEDAMOUNTINCTR,
						  MST.MALCTGCOD MALCTGCOD          ,
						  MST.MALSUBCLS MALSUBCLS
						   FROM MALMRABLGMST MST
						INNER JOIN MALMRABLGDTL DTL
							 ON MST.MALSEQNUM = DTL.MALSEQNUM
						AND MST.CMPCOD     = DTL.CMPCOD
						AND DTL.PAYFLG     = 'T'
						INNER JOIN MALEXGOFCMST ORGEXG
							 ON ORGEXG.CMPCOD = MST.CMPCOD
						AND ORGEXG.EXGOFCCOD  = MST.ORGEXGOFC
						INNER JOIN SHRCTYMST ORGCTY
							 ON ORGCTY.CMPCOD = ORGEXG.CMPCOD
						AND ORGCTY.CTYCOD     = ORGEXG.CTYCOD
						INNER JOIN MALEXGOFCMST DSTEXG
							 ON DSTEXG.CMPCOD = MST.CMPCOD
						AND DSTEXG.EXGOFCCOD  = MST.DSTEXGOFC
						INNER JOIN SHRCTYMST DSTCTY
							 ON DSTCTY.CMPCOD = DSTEXG.CMPCOD
						AND DSTCTY.CTYCOD     = DSTEXG.CTYCOD
				WHERE TRUNC(DTL.FLTDAT) BETWEEN TO_DATE(?, 'DD-MON-YYYY') AND TO_DATE(?, 'DD-MON-YYYY')
			]]>
			</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
					<QRY:Id>65</QRY:Id>
					<QRY:Source Name="mail.mra.defaults.listunaccounteddespatchesfrommtkforR2" Type="NATIVE">
					<![CDATA[
						SELECT NULL CSGDOCNUM,
						  SEGFLT.CMPCOD CMPCOD,
						  ORGEXG.CTYCOD ORIGIN,
						  DSTEXG.CTYCOD DESTN ,
						  (FLT.FLTCARCOD
						  || ' '
						  || FLT.FLTNUM ) FLIGHTNO                    ,
						  TO_CHAR (FLT.FLTDAT, 'DD-MON-YYYY') FLTDATE ,
						  'PP' BILLTYPE                               ,
						  NULL CURRENCY                         ,
						  NULL RATE                             ,
						  0 AMOUNT ,
						  SUM(COALESCE(ULD.ACPWGT,0)) WGT                    ,
						  POL SECFRM                                  ,
						  POU SECTO                                   ,
						  0 PRORATEDAMOUNTINNZD                       ,
						  'R2' REASONCODE                             ,
						  '' BLGBAS                                   ,
						  0 CSGSEQNUM                                 ,
						  '' POACOD                                   ,
						  ULD.DSN DSN                                 ,
						  MAX(ULD.SCNDAT) ACPDAT               ,
						  0 SERNUM                ,
						  0 SEGSERNUM             ,
						  0 FLTSEQNUM             ,
						  '' LSTUPDUSR            ,
						  MAX(ULD.LSTUPDTIM) LSTUPDTIM ,
						  0 PRORATEDAMOUNTINCTR   ,
						  ULD.MALCTGCOD MALCTGCOD ,
						  ULD.MALSUBCLS MALSUBCLS
						   FROM MALULDSEGDTL ULD
						INNER JOIN MALFLT FLT
							 ON ULD.CMPCOD = FLT.CMPCOD
						AND ULD.FLTCARIDR  = FLT.FLTCARIDR
						AND ULD.FLTSEQNUM  = FLT.FLTSEQNUM
						AND ULD.FLTNUM     = FLT.FLTNUM
						INNER JOIN MALFLTSEG SEGFLT
							 ON SEGFLT.CMPCOD = FLT.CMPCOD
						AND SEGFLT.FLTCARIDR  = FLT.FLTCARIDR
						AND SEGFLT.FLTSEQNUM  = FLT.FLTSEQNUM
						AND SEGFLT.FLTNUM     = FLT.FLTNUM
						AND SEGFLT.POL        = FLT.ARPCOD
						AND SEGFLT.SEGSERNUM  = ULD.SEGSERNUM
						INNER JOIN MALEXGOFCMST ORGEXG
							 ON ORGEXG.CMPCOD = ULD.CMPCOD
						AND ORGEXG.EXGOFCCOD  = ULD.ORGEXGOFC
						INNER JOIN SHRCTYMST ORGCTY
							 ON ORGCTY.CMPCOD = ORGEXG.CMPCOD
						AND ORGCTY.CTYCOD     = ORGEXG.CTYCOD
						INNER JOIN MALEXGOFCMST DSTEXG
							 ON DSTEXG.CMPCOD = ULD.CMPCOD
						AND DSTEXG.EXGOFCCOD  = ULD.DSTEXGOFC
						INNER JOIN SHRCTYMST DSTCTY
							 ON DSTCTY.CMPCOD = DSTEXG.CMPCOD
						AND DSTCTY.CTYCOD     = DSTEXG.CTYCOD
						INNER JOIN MALMST MAL
						ON MAL.CMPCOD = ULD.CMPCOD
						AND MAL.MALSEQNUM = ULD.MALSEQNUM
						  WHERE ULD.ACPBAG    > 0
						AND ULD.RCVBAG        = 0
					    AND NOT EXISTS
  								(SELECT 1
									 FROM MALMRABLGMST MST
									WHERE MST.CMPCOD = MAL.CMPCOD
									AND MST.MALIDR = MAL.MALIDR
								    AND MST.ULDNUM = ULD.ULDNUM
								  )
						AND TRUNC(FLT.FLTDAT) BETWEEN TO_DATE (? ,'DD-MON-YYYY') AND TO_DATE (? ,'DD-MON-YYYY')
					]]>
					</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
				<QRY:Id>69</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.listfrommtkcon" Type="NATIVE">
				<![CDATA[
				SELECT  NULL CSGDOCNUM,SUBSTR(MAL.ORGEXGOFC,3,3)ORIGIN, SUBSTR(MAL.DSTEXGOFC,3,3)
					DESTN,(FLT.FLTCARCOD ||' '|| FLT.FLTNUM)FLIGHTNO,TO_CHAR(FLT.FLTDAT,'DD-MON-YYYY')FLTDATE,'PP' BILLTYPE,
					NULL CURRENCY,NULL RATE,0 AMOUNT,POL SECFRM, POU SECTOO ,0 PRORATEDAMOUNT,
					'R2'REASONCODE,''BLGBAS,0 CSGSEQNUM,'' POACOD,CON.DSN DSN FROM MALULDSEGDTL CON,MALMST MAL,
					MALFLT FLT,
					MALFLTSEG SEGFLT
					WHERE FLT.FLTDAT
					BETWEEN TO_DATE(?,'DD-MON-YYYY') AND TO_DATE(?,'DD-MON-YYYY')
					AND SEGFLT.CMPCOD = FLT.CMPCOD
					AND SEGFLT.FLTCARIDR = FLT.FLTCARIDR
					AND SEGFLT.FLTSEQNUM = FLT.FLTSEQNUM
					AND SEGFLT.FLTNUM = FLT.FLTNUM
					AND CON.CMPCOD = FLT.CMPCOD
					AND CON.FLTCARIDR = FLT.FLTCARIDR
					AND CON.FLTSEQNUM = FLT.FLTSEQNUM
					AND CON.FLTNUM = FLT.FLTNUM
					AND SEGFLT.SEGSERNUM = CON.SEGSERNUM
          AND MAL.CMPCOD = CON.CMPCOD
          AND MAL.MALSEQNUM = CON.MALSEQNUM
					AND ACPBAG > 0 AND SEGFLT.POL = FLT.ARPCOD
					and  (MAL.MALIDR)
					not in (SELECT MST.MALIDR FROM MALMRABLGMST MST, MALMRABLGDTL DTL,MALULDSEGDTL CON
					WHERE MST.CMPCOD = DTL.CMPCOD
          AND MST.MALSEQNUM = DTL.MALSEQNUM
					AND CON.CMPCOD = MST.CMPCOD
					and CON.ULDNUM = MST.ULDNUM
					AND TRUNC(DTL.FLTDAT)
					BETWEEN TO_DATE(?,'DD-MON-YYYY') AND TO_DATE(?,'DD-MON-YYYY') )
				]]>
				</QRY:Source>
		</QRY:Definition>

		  <QRY:Definition>
				<QRY:Id>66</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findunaccounteddipatchtotalforR1" Type="NATIVE">
				<![CDATA[
					SELECT    DISTINCT COUNT(DISTINCT MST.MALIDR)TOTALNOOFDESP       ,
  							  MST.CMPCOD CMPCOD                     ,
							  NULL WGT                              ,
							  NULL RAT                              ,
							  COALESCE(SUM(DTL.WGTCHGBAS),0) TOTALWGTCHG ,
							  NULL ACPDAT                           ,
							  DTL.CTRCURCOD CURRENCY                ,
							  'R1' REASONCODE
						FROM MALMRABLGMST MST
							INNER JOIN MALMRABLGDTL DTL
								 ON MST.MALSEQNUM = DTL.MALSEQNUM
								AND MST.CMPCOD     = DTL.CMPCOD
							INNER JOIN MALEXGOFCMST ORGEXG
								 ON ORGEXG.CMPCOD = MST.CMPCOD
								AND ORGEXG.EXGOFCCOD  = MST.ORGEXGOFC
							INNER JOIN SHRCTYMST ORGCTY
								 ON ORGCTY.CMPCOD = ORGEXG.CMPCOD
								AND ORGCTY.CTYCOD     = ORGEXG.CTYCOD
							INNER JOIN MALEXGOFCMST DSTEXG
								 ON DSTEXG.CMPCOD = MST.CMPCOD
								AND DSTEXG.EXGOFCCOD  = MST.DSTEXGOFC
							INNER JOIN SHRCTYMST DSTCTY
								 ON DSTCTY.CMPCOD = DSTEXG.CMPCOD
								AND DSTCTY.CTYCOD     = DSTEXG.CTYCOD
						WHERE DTL.PAYFLG    = 'T'
							AND TRUNC(DTL.FLTDAT) BETWEEN TO_DATE(?,'DD-MON-YYYY') AND TO_DATE(?,'DD-MON-YYYY')

						]]>
			     </QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
				<QRY:Id>67</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findunaccounteddipatchtotalforuldR2" Type="NATIVE">
				<![CDATA[
						SELECT
							  COUNT( DISTINCT ULD.MALSEQNUM ) TOTALNOOFDESP ,
							  ULD.CMPCOD CMPCOD                           ,
							  SUM(ULD.ACPWGT) WGT                         ,
							  NULL RAT                              ,
							  COALESCE(SUM(0),0) TOTALWGTCHG                   ,
							  MAX(ULD.SCNDAT) ACPDAT              ,
							  NULL CURRENCY                         ,
							  'R2' REASONCODE
					FROM MALULDSEGDTL ULD
							INNER JOIN MALFLT FLT
								 ON ULD.CMPCOD = FLT.CMPCOD
								AND ULD.FLTCARIDR  = FLT.FLTCARIDR
								AND ULD.FLTSEQNUM  = FLT.FLTSEQNUM
								AND ULD.FLTNUM     = FLT.FLTNUM
							INNER JOIN MALFLTSEG SEGFLT
								 ON SEGFLT.CMPCOD = FLT.CMPCOD
								AND SEGFLT.FLTCARIDR  = FLT.FLTCARIDR
								AND SEGFLT.FLTSEQNUM  = FLT.FLTSEQNUM
								AND SEGFLT.FLTNUM     = FLT.FLTNUM
								AND SEGFLT.POL        = FLT.ARPCOD
								AND SEGFLT.SEGSERNUM  = ULD.SEGSERNUM
							INNER JOIN MALEXGOFCMST ORGEXG
								 ON ORGEXG.CMPCOD = ULD.CMPCOD
								AND ORGEXG.EXGOFCCOD  = ULD.ORGEXGOFC
							INNER JOIN SHRCTYMST ORGCTY
								 ON ORGCTY.CMPCOD = ORGEXG.CMPCOD
								AND ORGCTY.CTYCOD     = ORGEXG.CTYCOD
							INNER JOIN MALEXGOFCMST DSTEXG
								 ON DSTEXG.CMPCOD = ULD.CMPCOD
								AND DSTEXG.EXGOFCCOD  = ULD.DSTEXGOFC
							INNER JOIN SHRCTYMST DSTCTY
								 ON DSTCTY.CMPCOD = DSTEXG.CMPCOD
								AND DSTCTY.CTYCOD     = DSTEXG.CTYCOD
              INNER JOIN MALMAST MAL
              ON MAL.CMPCOD = ULD.CMPCOD
              AND MAL.MALSEQNUM = ULD.MALSEQNUM
					WHERE ULD.ACPBAG    > 0
								AND ULD.RCVBAG        = 0
								AND NOT EXISTS
  										(SELECT 1
											 FROM MALMRABLGMST MST
											WHERE MST.CMPCOD = MAL.CMPCOD
											AND MST.MALIDR = MAL.MALIDR
											AND MST.ULDNUM = ULD.ULDNUM
										  )
								AND TRUNC(FLT.FLTDAT) BETWEEN TO_DATE (?,'DD-MON-YYYY') AND TO_DATE (?,'DD-MON-YYYY')

						]]>
			     </QRY:Source>
		</QRY:Definition>


		<QRY:Definition>
			<QRY:Id>68</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findunaccounteddipatchtotalforconR2" Type="NATIVE">
			<![CDATA[
					SELECT DISTINCT COUNT ( *) TOTALNOOFDESP, COALESCE(SUM(0),0)TOTALWGTCHG
						  FROM MALULDSEGDTL CON,
                   MALMST MAL,
						       MALFLT FLT,
						       MALFLTSEG SEGFLT
						 WHERE FLT.FLTDAT
							      BETWEEN TO_DATE(?,'DD-MON-YYYY') AND TO_DATE(?,'DD-MON-YYYY')
						   AND SEGFLT.CMPCOD = FLT.CMPCOD
							   AND SEGFLT.FLTCARIDR = FLT.FLTCARIDR
							   AND SEGFLT.FLTSEQNUM = FLT.FLTSEQNUM
							   AND SEGFLT.FLTNUM = FLT.FLTNUM
							   AND CON.CMPCOD = FLT.CMPCOD
							   AND CON.FLTCARIDR = FLT.FLTCARIDR
							   AND CON.FLTSEQNUM = FLT.FLTSEQNUM
							   AND CON.FLTNUM = FLT.FLTNUM
							   AND SEGFLT.SEGSERNUM = CON.SEGSERNUM
							   AND SEGFLT.POL = FLT.ARPCOD
                 AND CON.CMPCOD = MAL.CMPCOD
                 AND CON.MALSEQNUM = MAL.MALSEQNUM
							   AND CON.ACPBAG > 0
						     and (MAL.MALIDR)
								not in (SELECT MST.MALIDR FROM MALMRABLGMST MST, MALMRABLGDTL DTL,MALULDSEGDTL CON
							 WHERE MST.CMPCOD = DTL.CMPCOD
							   AND MST.MALSEQNUM = DTL.MALSEQNUM
								   AND CON.CMPCOD = MST.CMPCOD
								   and CON.ULDNUM = MST.ULDNUM
							   AND TRUNC(DTL.FLTDAT)
								       BETWEEN TO_DATE(?,'DD-MON-YYYY') AND TO_DATE(?,'DD-MON-YYYY') )



					]]>
		     </QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
	<QRY:Id>38</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.dsnroutingdetails" Type="NATIVE">
		<![CDATA[

		

		SELECT MST.MALIDR,MST.MALSEQNUM,RTG.CMPCOD,RTG.RTGSERNUM,RTG.FLTCARIDR,RTG.FLTCARCOD,RTG.FLTNUM,RTG.FLTDAT,RTG.FLTSEQNUM,RTG.SEGSERNUM,RTG.POL,RTG.POU,RTG.STDBAG,RTG.STDWGT,MST.TOTPCS,MST.GRSWGT,MST.DSPWGT,MST.DSPWGTUNT,MST.ROU,RTG.AGRTYP,RTG.BSAREF,RTG.BLKSPCTYP,RTG.FLTTYP,RTG.INTFCDFLG,MST.MRASTA,RTG.SEGSRC

		FROM MALMRARTG RTG INNER JOIN  MALMRABLGMST MST ON
			 RTG.CMPCOD = MST.CMPCOD
			 AND RTG.MALSEQNUM = MST.MALSEQNUM
			  WHERE RTG.CMPCOD=?
			  AND MST.MALIDR=?



				]]>
    		</QRY:Source>
		</QRY:Definition>


		<QRY:Definition>
			<QRY:Id>55</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findinterlinebillingdetails_qryone" Type="NATIVE">
			<![CDATA[

					SELECT BLGDTL.SECFRM, BLGDTL.SECTOO,
				(SELECT CASE
                       WHEN APHCODUSE =
                                      2
                               THEN TWOAPHCOD
                       WHEN APHCODUSE =
                                      3
                               THEN THRAPHCOD
               END FLTCARIDR
		          FROM SHRARLMST
		         WHERE CMPCOD = BLGMST.CMPCOD
		           AND ARLIDR = BLGDTL.FLTCARIDR)
                                     AS FLTCARIDR,
				       NULL AS INTBLGTYP, NULL AS CLRPRD,
				       BLGDTL.UPDGRSWGT AS TOTWGT, NULL AS DSNDAT,
				       (SELECT SUBCLSGRP FROM MALSUBCLSMST WHERE SUBCLSCOD= BLGMST.MALSUBCLS)
				        AS MALSUBCLS, BLGDTL.BLGSTA AS DSNSTA,
				       NULL AS INVNUM, BLGDTL.APLRAT AS APLRAT,
				       BLGDTL.WGTCHGCTR AS BLDAMT
				  FROM MALMRABLGDTL BLGDTL, MALMRABLGMST BLGMST
				 WHERE BLGDTL.CMPCOD = BLGMST.CMPCOD
				   AND BLGDTL.MALSEQNUM = BLGMST.MALSEQNUM
				   AND BLGDTL.BLGSTA IN ('IB','OB','OD','IU')
	?			   AND BLGDTL.CMPCOD = ?

			]]>
			</QRY:Source>
	</QRY:Definition>

		<QRY:Definition>
			<QRY:Id>56</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findinterlinebillingdetails_qrytwo" Type="NATIVE">
			<![CDATA[

			SELECT CARFRM AS SECFRM, CARTOO AS SECTOO,
       (SELECT CASE
                       WHEN APHCODUSE =
                                      2
                               THEN TWOAPHCOD
                       WHEN APHCODUSE =
                                      3
                               THEN THRAPHCOD
               END FLTCARIDR
	          FROM SHRARLMST
	         WHERE CMPCOD =  C66DTL.CMPCOD
	           AND ARLIDR = C66DTL.FLTCARIDR)
	                                     AS FLTCARIDR,
	       C66DTL.INTBLGTYP, C66DTL.CLRPRD,
	       C66DTL.TOTWGT, C66DTL.DSNDAT,
	       C66DTL.SUBCLSGRP, C66DTL.MALSTA,
	       C66DTL.INVNUM, C66DTL.APLRAT,
	       C66DTL.BLDAMTLSTUR
		  FROM MALMRAARLC66DTL C66DTL
		  WHERE
		        C66DTL.ORGEXGOFC
		       || C66DTL.DSTEXGOFC
		       || C66DTL.MALCTGCOD
		       || C66DTL.MALSUBCLS
		       || C66DTL.YER
		       || C66DTL.DSN =
	]]>
	</QRY:Source>
	</QRY:Definition>


		<QRY:Definition>
			<QRY:Id>57</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findproratefactor" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_RATING.SPR_GETPROFCT(
					?,
					?,
					?,
					?,
					?,
				    ?
				)
				]]>
			</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
			<QRY:Id>58</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findSectorDetails" Type="NATIVE">
			<![CDATA[
				SELECT FLTMST.CMPCOD, FLTMST.FLTCARIDR, FLTMST.FLTNUM, FLTMST.FLTSEQNUM,

				   FLTMST.FLTORG, FLTMST.FLTDST, FLTMST.LSTUPDUSR, FLTMST.LSTUPDTIM,
				   FLTMST.FLTDAT, FLTMST.FLTSTA,
				   FLTSEG.SEGSERNUM, FLTSEG.SEGORG,
				   FLTSEG.SEGDST, FLTSEG.SEGSTA
				 FROM FLTOPRMST FLTMST, FLTOPRSEG FLTSEG
				 WHERE FLTMST.FLTNUM = FLTSEG.FLTNUM
				 AND FLTMST.CMPCOD = FLTSEG.CMPCOD
				 AND FLTMST.FLTCARIDR = FLTSEG.FLTCARIDR
					 AND FLTMST.FLTSEQNUM = FLTSEG.FLTSEQNUM
					 AND FLTMST.FLTNUM = ?
					 AND FLTMST.FLTCARIDR = ?
					 AND FLTMST.FLTSEQNUM = ?
					 AND FLTMST.CMPCOD = ?

				]]>
			</QRY:Source>
	</QRY:Definition>

		<QRY:Definition>
   <QRY:Id>58</QRY:Id>
   <QRY:Source Name="mail.mra.defaults.prorationlogdetails" Type="NATIVE">
	<![CDATA[
	SELECT MST.MALIDR,HIS.CMPCOD,MST.CSGDOCNUM,MST.CSGSEQNUM,MST.MRASTA,
			HIS.SERNUM,HIS.VERNUM,HIS.MALSEQNUM,MST.POACOD,HIS.SECFRM,HIS.SECTOO,HIS.FLTCARCOD,
	HIS.TRGPNT,HIS.LSTUPDTIM,HIS.LSTUPDUSR,HIS.RMK,
	ARLMST.TWOAPHCOD,ARLMST.THRAPHCOD, ARLMST.APHCODUSE
	FROM MALMRABLGMST MST, MALMRABLGDTLHIS HIS
	 LEFT OUTER JOIN SHRARLMST ARLMST
	  ON HIS.CMPCOD = ARLMST.CMPCOD
	  AND HIS.FLTCARCOD = ARLMST.TWOAPHCOD


	WHERE   HIS.CMPCOD=? AND
		MST.MALIDR=?
		AND HIS.PAYFLG='T'
		AND MST.MALSEQNUM=HIS.MALSEQNUM
		ORDER BY HIS.MALSEQNUM,HIS.SERNUM,HIS.VERNUM
    			]]>
    		</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>

   <QRY:Id>59</QRY:Id>
   <QRY:Source Name="mail.mra.defaults.viewprorationlogdetails" Type="NATIVE">
	<![CDATA[
		SELECT
		  HIS.MALSEQNUM,
		  MST.MALIDR,
		  HIS.CMPCOD,
		  MST.CSGDOCNUM,
		  MST.CSGSEQNUM,
		  HIS.SERNUM,
		  HIS.FLTCARIDR,
		  HIS.SECFRM,
		  HIS.SECTOO,
		  MST.TOTPCS,
		  HIS.UPDGRSWGT,
		  HIS.PROTYP,
		  HIS.PROVAL,
		  HIS.PROPRC,
		  HIS.PAYFLG,
		  HIS.TRGPNT,
		  HIS.WGTCHGCTR,
		  HIS.WGTCHGUSD,
		  HIS.WGTCHGXDR,
		  HIS.WGTCHGBAS,
		  HIS.OTHCHGCTR,
		  HIS.OTHCHGBAS,
		  HIS.OTHCHGUSD,
		  HIS.OTHCHGXDR,
		  'ARR' SECTSTA,
		  MST.ORGEXGOFC,
		  MST.DSTEXGOFC,
		  MST.GRSWGT,
		  MST.MALCTGCOD,
		  MST.MALSUBCLS,
		  MST.RCVDAT,
		       ARLMST.TWOAPHCOD,
		  ARLMST.THRAPHCOD,
		  ARLMST.APHCODUSE,
		  ARLMST.BASCURCOD BASCUR,
		  HIS.CTRCURCOD,
		  MST.POACOD,
		  POAMST.POANAM,
		  HIS.LSTUPDUSR,
		  HIS.LSTUPDTIM
		FROM
      MALMRABLGDTLHIS HIS INNER JOIN
		  MALMRABLGMST MST  ON
      MST.CMPCOD=HIS.CMPCOD
      AND MST.MALSEQNUM=MST.MALSEQNUM
		  LEFT OUTER JOIN MALPOAMST POAMST
		ON
		  MST.CMPCOD  =POAMST.CMPCOD
      AND MST.POACOD = POAMST.POACOD
		  LEFT OUTER JOIN SHRARLMST ARLMST
		ON
		  HIS.CMPCOD      = ARLMST.CMPCOD
		     AND HIS.FLTCARCOD = ARLMST.TWOAPHCOD
		WHERE
		  HIS.CMPCOD     = MST.CMPCOD
		AND HIS.MALSEQNUM   = MST.MALSEQNUM
		AND HIS.CMPCOD   =?
		AND MST.MALIDR   =?
		AND MST.POACOD   =?
		AND HIS.SERNUM   =?
		AND HIS.MALSEQNUM   =?
    			]]>
    		</QRY:Source>
		</QRY:Definition>
		<QRY:Definition>

				<QRY:Id>60</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findProrationExceptionsDetailsfirst" Type="NATIVE">

				<![CDATA[

					select a.*, 
(select min(coalesce (fct.profct, 0))
from craprofct fct
where a.cmpcod = fct.cmpcod
and a.frmcty = fct.orgcod
and a.cmpcod = fct.cmpcod
and a.toocty = fct.dstcod
and a.rcvdat >= fct.vldfrm
and a.rcvdat <= fct.vldtoo
and fct.fctsta = 'A'
) profct
from ( SELECT
    exp.cmpcod                                   cmpcod,
    mst.malidr                                   malidr,
    mst.malseqnum                                malseqnum,
    mst.csgdocnum                                csgdocnum,
    mst.csgseqnum                                csgseqnum,
    mst.poacod                                   poacod,
    exp.expseqnum                                expseqnum,
    exp.expcod                                   expcod,
    exp.trgpnt                                   trgpnt,
    mst.rcvdat                                   rcvdat,
    exp.asdusr                                   asdusr,
    exp.asgdat                                   asgdat,
    exp.rsddat                                   rsddat,
    exp.expsta                                   expsta,
    exp.lstupdusr                                lstupdusr,
    exp.lstupdtim                                lstupdtim,
    mst.totpcs                                   pcs,
    rtg.fltcarcod                                fltcarcod,
    rtg.fltnum                                   fltnum,
    rtg.fltdat                                   fltdat,
    rtg.fltcaridr                                fltcaridr,
    rtg.fltseqnum                                fltseqnum,
    exp.secfrm                                   secfrm,
    exp.sectoo                                   sectoo,
					orgarp.ctycod frmcty   ,
					dstarp.ctycod toocty,
    rtg.rtgsernum,
    mst.dsn,
    mst.orgexgofc,
    mst.dstexgofc,
    mst.orgarpcod,
    mst.dstarpcod,
    mst.rsn,
    mst.hsn,
    mst.regind,
    mst.yer,
    mst.malsubcls,
    mst.malctgcod,
    mst.rou,
    MIN(rtg.rtgsernum)
    OVER(PARTITION BY rtg.cmpcod, rtg.malseqnum) minrtgsernum
FROM
         malmraexpdtl exp
    INNER JOIN malmrablgmst mst ON ( exp.cmpcod = mst.cmpcod
                                     AND exp.malseqnum = mst.malseqnum )
    INNER JOIN malmrartg    rtg ON ( exp.cmpcod = rtg.cmpcod
                                  AND exp.malseqnum = rtg.malseqnum )
    INNER JOIN shrarpmst    orgarp ON ( rtg.cmpcod = orgarp.cmpcod
    AND rtg.pol    = orgarp.arpcod)
    INNER JOIN shrarpmst    dstarp ON ( rtg.pou = dstarp.arpcod
    AND rtg.cmpcod   = dstarp.cmpcod)
    WHERE 
	 EXP.CMPCOD = ?
					AND EXP.EXPSTA IN ('U','V')



				]]>
		</QRY:Source>
		</QRY:Definition>
		<QRY:Definition>
					<QRY:Id>61</QRY:Id>
					<QRY:Source Name="mail.mra.defaults.prorateDsn" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_RATING.spr_prorat_dsn
								(
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?
								)
							]]>
					</QRY:Source>

			</QRY:Definition>

			<QRY:Definition>
				<QRY:Id>62</QRY:Id>
						<QRY:Source Name="mail.mra.defaults.dsnroute" Type="NATIVE">
						<![CDATA[
						SELECT  RTG.POL POL,RTG.POU POU

						FROM MALMRARTG RTG, MALMRABLGMST MST
						WHERE
            RTG.CMPCOD=MST.CMPCOD AND
						RTG.MALSEQNUM = MST.MALSEQNUM AND
						RTG.CMPCOD=? AND
						MST.MALIDR=? AND
						MST.CSGDOCNUM=? AND
						MST.CSGSEQNUM=? AND
						MST.POACOD=?



							]]>
						</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
		 <QRY:Id>63</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findflowndetails" Type="NATIVE">
			<![CDATA[
				SELECT DTL.SECFRM,DTL.SECTOO,DTL.FLTCARIDR,DTL.FLTNUM,DTL.FLTDAT,MST.TOTPCS,DTL.UPDGRSWGT,
				DTL.CTRCURCOD,DTL.WGTCHGCTR,DTL.WGTCHGBAS,DTL.BLGSTA FROM MALMRAGPABLGDTL DTL, MALMRABLGMST MST
				WHERE DTL.CMPCOD = MST.CMPCOD AND
					  DTL.MALSEQNUM = MST.MALSEQNUM AND
					  DTL.CMPCOD=? AND
					  MST.MALIDR=? AND
					  MST.POACOD=?

			]]>
    		</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
			<QRY:Id>63</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.triggerFlownAndInterlineProvAccounting" Type="PROCEDURE">
				<![CDATA[
						CALL PKG_MAL_MRA_PRORAT.spr_mra_acccal
						(
							?,
							?,
							?,
							?,
							?,
							?,
							?,
							?

						)
					]]>
			</QRY:Source>

		</QRY:Definition>

		<QRY:Definition>
		<QRY:Id>64</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.documentstatistics" Type="NATIVE">
		<![CDATA[
			SELECT   FLT.FLTNUM, FLT.FLTCARCOD,FLT.FLTDAT,
				 FLT.IMPCLSFLG CLSFLG,
				 COUNT ( DISTINCT (SEG.MALSEQNUM))
							    NOOFDOCUMENTS,
				 R.RATAUD, T.TOORATAUD, A.ACCNTD
			    FROM MALFLT FLT,
				 MALULDSEGDTL SEG,
				 MALMRABLGMST MST,
				 MALMRAFLNMALSEG FLN,
				 (SELECT   MST.DSN,
					   COUNT ( MST.DSN) TOORATAUD
				      FROM MALMRABLGMST MST
				  GROUP BY MST.DSN) T,
				 (SELECT   MST.DSN, COUNT (MST.DSN)
								   RATAUD
				      FROM MALMRABLGMST MST
				  GROUP BY MST.DSN) R,
				 (SELECT   MST.DSN, COUNT (MST.DSN)
								   ACCNTD
				      FROM MALMRABLGMST MST
				  GROUP BY MST.DSN) A
			   WHERE FLT.CMPCOD = SEG.CMPCOD
			     AND FLT.FLTCARIDR = SEG.FLTCARIDR
			     AND FLT.FLTNUM = SEG.FLTNUM
			     AND FLT.FLTSEQNUM = SEG.FLTSEQNUM
			     AND MST.CMPCOD = SEG.CMPCOD
			    
			     AND SEG.FLTCARIDR = FLN.FLTCARIDR
			     AND SEG.FLTNUM = FLN.FLTNUM
			     AND SEG.FLTSEQNUM = FLN.FLTSEQNUM
			    
			     AND SEG.CMPCOD = FLN.CMPCOD
			     AND MST.CMPCOD = FLN.CMPCOD
			     AND FLT.CMPCOD = FLN.CMPCOD
			     AND FLT.FLTCARIDR = FLN.FLTCARIDR
			     AND FLT.FLTNUM = FLN.FLTNUM
			     AND FLT.FLTSEQNUM = FLN.FLTSEQNUM
			     
			     AND FLT.CMPCOD=?

		]]>
		</QRY:Source>
	</QRY:Definition>

	<!-- Added by A-3434 for GPABillingEntries starts-->

	<QRY:Definition>
	<QRY:Id>15</QRY:Id>
	<QRY:Source Name="mail.mra.gpabilling.findGPABillingEntries" Type="NATIVE">
	<![CDATA[
					  (SELECT MAX(CMPCOD) CMPCOD,
					   MAX(MALSEQNUM) MALSEQNUM,
			  MAX (BLGSTA) BLGSTA,
			  MAX(CSGSEQNUM) CSGSEQNUM,
			  MAX(SEQNUM) SEQNUM,
			  MAX(POACOD) POACOD,
			  MAX(BLGBAS) BLGBAS,
			  MAX(COD) COD,
			  MAX(RATIDF) RATIDF,
			  MAX(RATLINIDR) RATLINIDR,
              MAX(RATTYP) RATTYP,
			  MAX(CNTCOD) CNTCOD,
			  MAX(INVNUM) INVNUM,
			  MAX(CSGDOCNUM) CSGDOCNUM,
			  MAX(VALCHGCTR) VALCHGCTR,
			  MAX(ORG) ORG,
			  MAX(DST) DST,
			  MAX(ORGCOD) ORGCOD,
			  MAX(DSTCOD) DSTCOD,
			  MAX(SUBCLSGRP) SUBCLSGRP,
			  MAX(DAT) DAT,
			  MAX(CTGCOD) CTGCOD,
			  MAX(SUBCLS) SUBCLS,
			  MAX(yer) yer,
			  MAX(DSN) DSN,
			  MAX(RSN) RSN,
			  MAX(HSN) HSN,
			  MAX(REGIND) REGIND,
			  MAX(PCS) PCS,
			  MAX(WGT) WGT,
			  MAX(REVGRSWGT) REVGRSWGT,
			  MAX(FLTNUM) FLTNUM,
			  MAX(CCATYP) CCATYP,
			  MAX(CCAREFNUM) CCAREFNUM,
			  MAX(LSTUPDTIM) LSTUPDTIM,
			  MAX(SRVTAX) SRVTAX,
			  MAX(TDS) TDS,
			  MAX(NETAMT) NETAMT,
			  MAX(APLRAT) APLRAT,
			  MAX(CTRCURCOD) CTRCURCOD,
			  MAX(GRSAMT) GRSAMT,
			  MAX(REVCURCOD) REVCURCOD,
			  MAX(RMK) RMK,
			  MAX(MAILCHG) MAILCHG,MAX(SURCHG) SURCHG,
			  MAX(DCLVAL) DCLVAL,
			MAX(STLCUR)STLCURCOD,
			MAX(DSNDAT)DSNDAT,
			  MAX(MALPERFLG) MALPERFLG,
			  MAX(PKG_FRMWRK.FUN_CONVCURR_NOROUNDING(CMPCOD,CTRCURCOD,STLCUR,'F',DAT,NETAMT)) TOTAMT,
			  MAX(PKG_FRMWRK.FUN_CONVCURR_NOROUNDING(CMPCOD,CTRCURCOD,STLCUR,'F',DAT,VALCHGCTR)) TOTVAL,
			  MAX(PKG_FRMWRK.FUN_CONVCURR_NOROUNDING(CMPCOD,CTRCURCOD,STLCUR,'F',DAT,SRVTAX)) TOTVAT,
			  MAX(PKG_FRMWRK.FUN_CONVCURR_NOROUNDING(CMPCOD,CTRCURCOD,STLCUR,'F',DAT,GRSAMT)) TOTGRSAMT,
			  MAX(DSPWGTUNT) DSPWGTUNT
			FROM
			(WITH INNERCCADTL AS
			  (SELECT CCA.CMPCOD ,
				MST.MALSEQNUM ,
        MST.MALIDR BLGBAS,
				MST.CSGDOCNUM ,
				MST.CSGSEQNUM ,
				MST.POACOD ,
				DTL.BLGMTXCOD RATIDF,
				DTL.RATLINIDR,
                DTL.RATTYP,
				DTL.APLRAT,
				DTL.BLGSTA,
				DTL.VALCHGCTR,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVWGTCHGCTR - CCA.WGTCHGCTR)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVWGTCHGCTR)
				END) MAILCHG,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVOTHCHGCTR - CCA.OTHCHGCTR)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVOTHCHGCTR)
				END) SURCHG,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVGRSWGT - CCA.GRSWGT)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVGRSWGT)
				END ) WGT,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVWGTCHGCTR - CCA.WGTCHGCTR)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN ((CCA.REVWGTCHGCTR+CCA.REVOTHCHGCTR))
				END)GRSAMT,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVNETAMT - CCA.NETAMT)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVNETAMT)
				END )REVNETAMT,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVSRVTAX-CCA.SRVTAX)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVSRVTAX)
				END )REVSRVTAX,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVTDS-CCA.TDS)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVTDS)
				END )REVTDS,
				MAX(CCA.MCAREFNUM) CCAREFNUM,
				DTL.SERNUM,
				DTL.FLTNUM,
				MST.DSPWGTUNT DSPWGTUNT
			  FROM MALMRAMCA CCA,
				MALMRAGPABLGDTL DTL,
				MALMRABLGMST MST
			  WHERE CCA.CMPCOD  = DTL.CMPCOD
			  AND CCA.MALSEQNUM    = DTL.MALSEQNUM
        AND MST.CMPCOD  = DTL.CMPCOD
			  AND MST.MALSEQNUM    = DTL.MALSEQNUM

			  AND CCA.MCASTA    = 'A'
			  AND CCA.MCATYP    = 'A'
			  AND CCA.BLGSTA   IN ('BB','OH','WD')
			  and to_number (to_char (mst.rcvdat, 'YYYYMMDD')) between ? and ?
			  GROUP BY CCA.CMPCOD ,
         MST.MALSEQNUM,
				MST.MALIDR ,
				MST.CSGDOCNUM ,
				MST.CSGSEQNUM ,
				MST.POACOD ,
				DTL.BLGMTXCOD,
				DTL.RATLINIDR,
                DTL.RATTYP,
				CCA.REVGPACOD,
				DTL.BLGMTXCOD,
				DTL.RATLINIDR,
                DTL.RATTYP,
				DTL.APLRAT,
				DTL.VALCHGCTR,
				DTL.BLGSTA,
				DTL.SERNUM,
				DTL.FLTNUM,
				MST.DSPWGTUNT
			  )
			SELECT DTL.CMPCOD CMPCOD,
      DTL.MALSEQNUM MALSEQNUM,
					  DTL.BLGSTA BLGSTA,
					  MST.CSGSEQNUM CSGSEQNUM,
					  DTL.SERNUM SEQNUM,
					  MST.POACOD POACOD,
					  MST.MALIDR BLGBAS,
					  DTL.UPDBILTOOPOA COD,
					  DTL.BLGMTXCOD RATIDF,
					  DTL.RATLINIDR,
                      DTL.RATTYP,
					  NULL CNTCOD,
					  NULL INVNUM,
					  MST.CSGDOCNUM CSGDOCNUM,
					  MST.ORGEXGOFC ORG,
					  MST.DSTEXGOFC DST,
					  MST.ORGARPCOD ORGCOD,
					  MST.DSTARPCOD DSTCOD,
				SUBCLS.SUBCLSGRP SUBCLSGRP,
				DTL.FLTDAT DAT,
					  MST.MALCTGCOD CTGCOD,
					  MST.MALSUBCLS SUBCLS,
					  DTL.UPDWGTCHGCTR MAILCHG,
					DTL.UPDOTHCHGCTR SURCHG,
					  MST.DCLVAL,
					  DTL.VALCHGCTR,
					  MST.YER YER,
					  MST.DSN DSN,
					   MST.RSN RSN,
					  MST.HSN HSN,
					  MST.REGIND REGIND,
					  MST.TOTPCS PCS,
					  MST.DSPWGT WGT,
					  0 REVGRSWGT,
					  DTL.FLTNUM FLTNUM,
					  NULL CCATYP,
				  NULL ccarefnum,

					  NULL LSTUPDTIM ,
					  DTL.SRVTAX,
					  DTL.TDS,
					  DTL.NETAMT,
					  DTL.APLRAT,
					  DTL.CTRCURCOD,
					  (DTL.UPDWGTCHGCTR+DTL.UPDOTHCHGCTR) GRSAMT,
  					  NULL REVCURCOD,
					  DTL.RMK,
					  POA.STLCUR,
					  MST.RCVDAT DSNDAT,
					  MST.MALPERFLG MALPERFLG,
					  MST.DSPWGTUNT DSPWGTUNT
					FROM MALMRABLGMST MST,MALMRAGPABLGDTL DTL,
				MALPOADTL POA,
				MALSUBCLSMST SUBCLS,
				MALEXGOFCMST OOE,
				MALEXGOFCMST DOE
					WHERE MST.CMPCOD     = DTL.CMPCOD
					AND MST.MALSEQNUM       = DTL.MALSEQNUM

			  AND POA.POACOD       = DTL.UPDBILTOOPOA
			  AND SUBCLS.CMPCOD    = MST.CMPCOD
			  AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
					AND POA.CMPCOD       = DTL.CMPCOD
					AND POA.PARCOD		 = 'STLINFO'
			  AND MST.CMPCOD = OOE.CMPCOD
			  AND MST.ORGEXGOFC = OOE.EXGOFCCOD
			  AND MST.CMPCOD = DOE.CMPCOD
			  AND MST.DSTEXGOFC = DOE.EXGOFCCOD
			  --AND TRUNC(MST.RCVDAT) BETWEEN POA.VLDFRM AND POA.VLDTOO

			 

			  AND TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD')) BETWEEN TO_NUMBER(to_char(POA.VLDFRM,'YYYYMMDD'))  AND  TO_NUMBER(to_char(POA.VLDTOO,'YYYYMMDD'))

			  AND NOT EXISTS
				(SELECT 1
				FROM MALMRAMCA
					WHERE CMPCOD= DTL.CMPCOD
					AND MALSEQNUM = DTL.MALSEQNUM
					AND MCAREFNUM IS NOT NULL
					AND MCATYP = 'A'
				AND MCASTA     = 'A'
				)
					AND DTL.BLGSTA      IN ('BB', 'OH', 'WP', 'WD', 'TR', 'RD','RR')
					AND MST.CMPCOD       = ?

		]]>
	</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
	<QRY:Id>16</QRY:Id>
	<QRY:Source Name="mail.mra.gpabilling.findc66GPABillingEntries" Type="NATIVE">
	<![CDATA[
		SELECT C66DTL.CMPCOD CMPCOD,
		C66DTL.MALSEQNUM MALSEQNUM,
          C66DTL.BLGSTA BLGSTA,
          MST.CSGSEQNUM CSGSEQNUM,
          C66DTL.INVSERNUM SEQNUM,
          MST.POACOD POACOD,
          MST.MALIDR BLGBAS,
          C66DTL.GPACOD COD,
		  C66DTL.BLGMTXCOD RATIDF,
		   C66DTL.RATLINIDR,
          C66DTL.RATTYP,
          NULL CNTCOD,
          C66DTL.INVNUM INVNUM,
          MST.CSGDOCNUM CSGDOCNUM,
          MST.ORGEXGOFC ORG,
          MST.DSTEXGOFC DST,
		  MST.ORGARPCOD ORGCOD,
		  MST.DSTARPCOD DSTCOD,
			  C66DTL.SUBCLSGRP SUBCLSGRP,
			  C66DTL.RCVDAT DAT,
          C66DTL.MALCTGCOD CTGCOD,
          C66DTL.ACTSUBCLS SUBCLS,
	  C66DTL.MALCHGBLGCUR MAILCHG,
		C66DTL.OTHCHGBLGCUR SURCHG,
		  MST.DCLVAL,
		  CASE
          WHEN C66DTL.APLRAT = 0
          THEN 0
          ELSE C66DTL.VALCHGBLGCUR
          END VALCHG,
          MST.YER YER,
          C66DTL.DSN DSN,
			  MST.RSN RSN,
			  MST.HSN HSN,
			  MST.REGIND REGIN1D,
          C66DTL.TOTPCS TOTPCS,
          C66DTL.TOTWGT WGT,
          0 REVGRSWGT ,
          C66DTL.FLTNUM FLTNUM,
          NULL CCATYP,
          C66DTL.MCAREFNUM CCAREFNUM,
          C66DTL.LSTUPDTIM LSTUPDTIM,
		  C66DTL.SRVTAXBLGCUR,
		  C66DTL.TDSBLGCUR,
          C66DTL.NETAMTBLGCUR,
          C66DTL.APLRAT,
          SMY.BLGCURCOD CTRCURCOD,
          C66DTL.TOTAMTEXCVATBLGCUR GRSAMT,
  			NULL REVCURCOD,
			NULL RMK,
			POA.STLCUR STLCUR,
			MST.RCVDAT DSNDAT,
			MST.MALPERFLG MALPERFLG,
			MST.DSPWGTUNT
        FROM MALMRAGPAC66DTL C66DTL ,
			  MALMRAGPAC51SMY SMY,
			  MALMRABLGMST MST,MALMRAGPABLGDTL GPADTL,
		  MALPOADTL POA,
		  MALEXGOFCMST OOE,
          MALEXGOFCMST DOE
			   WHERE SMY.CMPCOD=C66DTL.CMPCOD
			   AND SMY.INVNUM=C66DTL.INVNUM
        AND SMY.GPACOD            =C66DTL.GPACOD
		  AND C66DTL.INVSERNUM = (SELECT MAX(INVSERNUM) FROM MALMRAGPAC51SMY
                            WHERE CMPCOD = C66DTL.CMPCOD
                            AND INVNUM = C66DTL.INVNUM
                            AND GPACOD = C66DTL.GPACOD
							AND INVSTA IN ('F','P'))
		AND POA.CMPCOD    =C66DTL.CMPCOD
        AND POA.POACOD    =C66DTL.GPACOD
        AND POA.PARCOD    ='STLINFO'
		--AND TRUNC(C66DTL.RCVDAT) BETWEEN POA.VLDFRM AND POA.VLDTOO
        AND TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD')) BETWEEN TO_NUMBER(to_char(POA.VLDFRM,'YYYYMMDD'))  AND  TO_NUMBER(to_char(POA.VLDTOO,'YYYYMMDD'))
        AND MST.CMPCOD = C66DTL.CMPCOD
        AND MST.MALSEQNUM = C66DTL.MALSEQNUM
		AND MST.CMPCOD = GPADTL.CMPCOD
        AND MST.MALSEQNUM = GPADTL.MALSEQNUM
		AND C66DTL.BLGSTA <> 'WD'
		AND MST.CMPCOD = OOE.CMPCOD
		AND MST.ORGEXGOFC = OOE.EXGOFCCOD
		AND MST.CMPCOD = DOE.CMPCOD
		AND MST.DSTEXGOFC = DOE.EXGOFCCOD
        AND C66DTL.CMPCOD         =



	]]>

	<!--Modified as part of ICRD-264356-->
	</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
	<QRY:Id>17</QRY:Id>
	<QRY:Source Name="mail.mra.gpabilling.findccaGPABillingEntries" Type="NATIVE">
	<![CDATA[

			SELECT CCADTL.CMPCOD CMPCOD,
			CCADTL.MALSEQNUM,
							CCADTL.BLGSTA,
							MST.CSGSEQNUM CSGSEQNUM,
                            INNERCCADTL.SERNUM SEQNUM,
							MST.POACOD POACOD,
							MST.MALIDR BLGBAS,
							CCADTL.REVGPACOD COD,
							INNERCCADTL.RATIDF,
							INNERCCADTL.RATLINIDR,
							INNERCCADTL.RATTYP,
							NULL CNTCOD,
							NULL INVNUM,
							MST.CSGDOCNUM CSGDOCNUM,
							MST.ORGEXGOFC ORG,
							MST.DSTEXGOFC DST,
					  MST.ORGARPCOD ORGCOD,
					  MST.DSTARPCOD DSTCOD,
			  SUBCLS.SUBCLSGRP SUBCLSGRP,
			  MST.RCVDAT DAT,
							MST.MALCTGCOD CTGCOD,
							MST.MALSUBCLS SUBCLS,
									CASE
            WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
            AND CCADTL.CURCHGIND  <>'Y'
            AND EXISTS
              (SELECT 1
              FROM MALMRAGPAC66DTL
            WHERE MALSEQNUM=CCADTL.MALSEQNUM
            AND CMPCOD=CCADTL.CMPCOD
            AND GPACOD=CCADTL.REVGPACOD
            )
							THEN INNERCCADTL.MAILCHG
							WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
							AND CCADTL.GPACHGIND = 'Y'
							THEN 0
							ELSE CCADTL.REVWGTCHGCTR
						  END MAILCHG,
						  CASE
            WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
            AND CCADTL.CURCHGIND  <>'Y'
            AND EXISTS
              (SELECT 1
              FROM MALMRAGPAC66DTL
            WHERE MALSEQNUM=CCADTL.MALSEQNUM
            AND CMPCOD=CCADTL.CMPCOD
            AND GPACOD=CCADTL.REVGPACOD
            )
							THEN INNERCCADTL.SURCHG
							WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
							AND CCADTL.GPACHGIND = 'Y'
							THEN 0
							ELSE CCADTL.REVOTHCHGCTR
						  END SURCHG,
						  MST.DCLVAL,
									CASE
										WHEN CCADTL.REVNETAMT = 0
                                       AND CCADTL.GPACHGIND = 'Y'
										  THEN 0
										ELSE INNERCCADTL.VALCHGCTR
									END DCLVAL,
							MST.YER YER,
			  MST.DSN DSN,
			  MST.RSN RSN,
			  MST.HSN HSN,
			  mst.regind regind,
							MST.TOTPCS PCS,
          INNERCCADTL.WGT,
          CCADTL.REVGRSWGT,
							INNERCCADTL.FLTNUM FLTNUM,
							CCADTL.MCATYP,
									  INNERCCADTL.CCAREFNUM      ,
									  CCADTL.LSTUPDTIM LSTUPDTIM,
									CASE
            WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
            AND CCADTL.CURCHGIND  <>'Y'
            AND EXISTS
              (SELECT 1
              FROM MALMRAGPAC66DTL
            WHERE MALSEQNUM=CCADTL.MALSEQNUM
            AND CMPCOD=CCADTL.CMPCOD
            AND GPACOD=CCADTL.REVGPACOD
            )
										THEN INNERCCADTL.REVSRVTAX
										WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
										AND CCADTL.GPACHGIND = 'Y'
										   THEN 0
										ELSE CCADTL.REVSRVTAX
									  END REVSRVTAX,
										  INNERCCADTL.REVTDS ,
									CASE
            WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
            AND CCADTL.CURCHGIND  <>'Y'
            AND EXISTS
              (SELECT 1
              FROM MALMRAGPAC66DTL
            WHERE MALSEQNUM=CCADTL.MALSEQNUM
            AND CMPCOD=CCADTL.CMPCOD
            AND GPACOD=CCADTL.REVGPACOD
            )
										THEN INNERCCADTL.REVNETAMT
										WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
										AND CCADTL.GPACHGIND = 'Y'
										  THEN 0
										ELSE CCADTL.REVNETAMT
									END REVNETAMT,
										  INNERCCADTL.APLRAT ,
									CCADTL.REVCTRCURCOD CURCOD ,
									CASE
            WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
            AND CCADTL.CURCHGIND  <>'Y'
            AND EXISTS
              (SELECT 1
              FROM MALMRAGPAC66DTL
            WHERE MALSEQNUM=CCADTL.MALSEQNUM
            AND CMPCOD=CCADTL.CMPCOD
            AND GPACOD=CCADTL.REVGPACOD
            )
										THEN INNERCCADTL.GRSAMT+INNERCCADTL.SURCHG
										WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
										AND CCADTL.GPACHGIND = 'Y'
										  THEN 0
										ELSE CCADTL.REVWGTCHGCTR+CCADTL.REVOTHCHGCTR
									END GRSAMT,
  										 CCADTL.REVCTRCURCOD REVCURCOD,
										 NULL RMK,
										 POA.STLCUR STLCUR,
										 MST.RCVDAT DSNDAT,
										 MST.MALPERFLG MALPERFLG,
										 MST.DSPWGTUNT
									   FROM MALMRAMCA CCADTL
									INNER JOIN MALMRABLGMST MST
									ON MST.CMPCOD = CCADTL.CMPCOD
									AND MST.MALSEQNUM     = CCADTL.MALSEQNUM
			INNER JOIN MALSUBCLSMST SUBCLS
			ON SUBCLS.CMPCOD     = MST.CMPCOD
			AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
        inner join INNERCCADTL
        ON INNERCCADTL.CMPCOD     = CCADTL.CMPCOD
        AND INNERCCADTL.MALSEQNUM    = CCADTL.MALSEQNUM
        AND INNERCCADTL.POACOD    = MST.POACOD
        AND INNERCCADTL.CCAREFNUM = CCADTL.MCAREFNUM
									LEFT OUTER JOIN MALMRAGPAC66DTL C66DTL
									ON C66DTL.CMPCOD = CCADTL.CMPCOD
									AND C66DTL.MALSEQNUM = CCADTL.MALSEQNUM
									AND C66DTL.MCAREFNUM = CCADTL.MCAREFNUM
									AND C66DTL.GPACOD = CCADTL.REVGPACOD
									LEFT OUTER JOIN MALPOADTL POA
									ON  POA.CMPCOD       = CCADTL.CMPCOD
									AND POA.POACOD       = CCADTL.REVGPACOD
									AND POA.PARCOD       ='STLINFO'
									--AND TRUNC(CCADTL.ISSDAT) BETWEEN POA.VLDFRM AND POA.VLDTOO
									AND TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD')) BETWEEN TO_NUMBER(to_char(POA.VLDFRM,'YYYYMMDD'))  AND  TO_NUMBER(to_char(POA.VLDTOO,'YYYYMMDD'))
									WHERE CCADTL.BLGSTA IN ('BB','OH','WD','BD')
									AND CCADTL.MCATYP     = 'A'
									AND CCADTL.MCASTA     = 'A'
									AND CCADTL.CMPCOD     =

		]]>
	</QRY:Source>
	</QRY:Definition>

<!-- Added by A-3434 for GPABillingEntries ends-->


	          <QRY:Definition>
							<QRY:Id>18</QRY:Id>
							<QRY:Source Name="mail.mra.defaults.findmaxseqnumfrommrabillingdetailshistory" Type="NATIVE">
							<![CDATA[
							SELECT COALESCE( MAX(SERNUM), 0) MAXNUM FROM MALMRABLGDTLHIS, MALMRABLGMST MST WHERE
							MALMRABLGDTLHIS.CMPCOD = MST.CMPCOD
							AND MALMRABLGDTLHIS.MALSEQNUM = MST.MALSEQNUM
							AND MALMRABLGDTLHIS.CMPCOD=?
							  AND MST.MALIDR=?
					          --AND MST.CSGDOCNUM = ?
  					         -- AND MST.CSGSEQNUM = ?
					         -- AND MST.POACOD = ?

							]]>
							</QRY:Source>
				   </QRY:Definition>



    		 <!-- Added by A-3434 for Bug 30352 -->
    		 <QRY:Definition>
			 				<QRY:Id>70</QRY:Id>
			 				<QRY:Source Name="mail.mra.defaults.findbillingdetails" Type="NATIVE">
			 				<![CDATA[
			 				select dtl.cmpcod, MST.poacod,dtl.sernum,MST.csgdocnum,MST.csgseqnum,MST.MALIDR

			 				from MALMRAGPABLGDTL dtl,MALMRAGPAC66DTL c66dtl, MALMRABLGMST MST

			 				where dtl.cmpcod= c66dtl.cmpcod
			 				and dtl.MALSEQNUM= c66dtl.MALSEQNUM
							and dtl.cmpcod= MST.cmpcod
			 				and dtl.MALSEQNUM= MST.MALSEQNUM
			 				and dtl.UPDBILTOOPOA= c66dtl.gpacod
			 				and dtl.cmpcod=?
			 				and c66dtl.gpacod=?
			 				and  dtl.SERNUM=?
			 				and  MST.csgdocnum=?
			 				and  MST.csgseqnum=?
			 				and  MST.MALIDR=?
			 				]]>
			 		</QRY:Source>

     </QRY:Definition>

		<QRY:Definition>
		<QRY:Id>65</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.viewirregularitydetails" Type="NATIVE">
				<![CDATA[
				SELECT IRP.BLGBAS,IRP.POACOD,IRP.CSGSEQNUM,IRP.CSGDOCNUM,IRP.CMPCOD,IRP.OFLPCS,IRP.MOP,IRP.IRPDAT,
				IRP.ORGFLTCARIDR, IRP.ORGFLTNUM,IRP.ORGFLTDAT,IRP.OFLSTN,IRP.OFLWGT,IRP.REVFLTNUM,IRP.REVFLTDAT,
				IRP.REVFLTCARIDR,IRP.IRPSTA,IRP.DSN,
				DTL.UPDGRSWGT,DTL.WGTCHGCTR,DTL.CTRCURCOD,
				MST.RCVDAT ,MST.ORGEXGOFC,MST.DSTEXGOFC,
				RTG.POL,RTG.POU
				FROM MRAIRPDTL IRP,MALMRABLGDTL DTL,MALMRABLGMST MST,MALMRARTG RTG
				 WHERE  IRP.CMPCOD = DTL.CMPCOD(+)
				 AND MST.MALSEQNUM= DTL.MALSEQNUM(+)

				 AND IRP.CMPCOD = MST.CMPCOD(+)
				 AND IRP.CSGSEQNUM= MST.CSGSEQNUM(+)
				 AND IRP.CSGDOCNUM= MST.CSGDOCNUM(+)
				 AND IRP.POACOD = MST.POACOD(+)
				 AND IRP.BLGBAS =MST.MALIDR(+)

				 AND IRP.CMPCOD = RTG.CMPCOD(+)
				 AND MST.MALSEQNUM= RTG.MALSEQNUM(+)

				 AND DTL.PAYFLG='R'
				 AND TO_DATE(IRP.IRPDAT,'DD-MM-YYYY')<= TO_DATE(?,'DD-MM-YYYY')



				]]>
				</QRY:Source>
		</QRY:Definition>

			<QRY:Definition>
		<QRY:Id>66</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findAccountingDetails" Type="NATIVE">
				<![CDATA[
				SELECT TXN.ACCTXNIDR,TXN.FUNPNT,TXN.AWBDTL,TXN.ACCMON,
				DTL.ACCCOD,DTL.CRR,DTL.DRR,DTL.ACCSTR,MST.ACCNAM
				FROM CRAACCTXN TXN,CRAACCTXNDTL DTL, CRAACCMST MST
			    WHERE  MST.CMPCOD = DTL.CMPCOD
				 AND MST.SUBSYS= DTL.SUBSYS
	             AND MST.ACCCOD=DTL.ACCCOD
                 AND TXN.CMPCOD=DTL.CMPCOD
	             AND TXN.ACCTXNIDR=DTL.ACCTXNIDR
	             AND TXN.FUNPNT=DTL.FUNPNT
                 AND TXN.SUBSYS=DTL.SUBSYS
	             AND TXN.CMPCOD=?
	             AND TXN.BLGBAS=?


				 ]]>
				 </QRY:Source>

      </QRY:Definition>

	  	





		<QRY:Definition>
				<QRY:Id>68</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.triggerUSPSAccounting" Type="PROCEDURE">
					<![CDATA[
							CALL PKG_MAL_MRA_ACC.SPR_MRA_MALUSPSRPTACC
							(
								?,
								?,
								?,
								?,
								?,
								?

							)
						]]>
				</QRY:Source>

			</QRY:Definition>

	<QRY:Definition>
			<QRY:Id>69</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.reproratedsn" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_RATING.spr_prorat_dsn(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
				    ?,
				    ?
				)
				]]>
			</QRY:Source>
		</QRY:Definition>

		<QRY:Definition>
			<QRY:Id>70</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findoutstandingbalances" Type="NATIVE">
			<![CDATA[
			SELECT   SUM (TXNDTL.DRR ) DRR, SUM (TXNDTL.CRR ) CRR,
			ACCMST.ACCNAM ACCNAM, MIN (TXNDTL.ACCSTR ) ACCSTR,MIN (TXNDTL.CURNAM ) BASCUR,MIN(TXN.RMK) RMK
			FROM CRAACCTXN TXN, CRAACCTXNDTL TXNDTL,CRAACCMST ACCMST
			WHERE TXN.CMPCOD = TXNDTL.CMPCOD
			AND TXN.ACCTXNIDR = TXNDTL.ACCTXNIDR
			AND TXN.FUNPNT = TXNDTL.FUNPNT
			AND TXN.SUBSYS=TXNDTL.SUBSYS
			AND ACCMST.CMPCOD = TXNDTL.CMPCOD
			AND ACCMST.ACCCOD = TXNDTL.ACCCOD
			AND TXNDTL.CMPCOD=?
			AND TXNDTL.SUBSYS=?
			AND TXN.BLGBAS=?
			AND TXN.CSGDOCNUM=?
			AND TXN.CSGSEQNUM= ?
			AND TXN.POACOD=?

			GROUP BY TXNDTL.ACCCOD,ACCMST.ACCNAM,TXN.CMPCOD,ACCMST.GNLACCCOD

			]]>
			</QRY:Source>

	</QRY:Definition>

	<QRY:Definition>
		    <QRY:Id>71</QRY:Id>
		    <QRY:Source Name="mail.mra.defaults.findallbillingmarixformaintainblgmtx" Type="NATIVE">
			<![CDATA[
		    SELECT BLGMTX.CMPCOD BLGMTXCMPCOD,
		      BLGMTX.BLGMTXCOD BLGMTXBLGMTXCOD,
		      BLGMTX.BLGMTXDES BLGMTXBLGMTXDES,
		      BLGMTX.BLGMTXSTA BLGMTXBLGMTXSTA,
		      BLGMTX.TOTBLGLIN BLGMTXTOTBLGLIN,
		      BLGMTX.VLDENDDAT BLGMTXVLDENDDAT,
		      BLGMTX.VLDSTRDAT BLGMTXVLDSTRDAT,
		      BLGMTX.TOTBLGLIN
		       FROM MALMRABLGMTX BLGMTX LEFT OUTER JOIN
		      MALMRABLGMTXLIN BLGLIN
		      on BLGMTX.CMPCOD=BLGLIN.CMPCOD
		      AND BLGMTX.BLGMTXCOD =BLGLIN.BLGMTXCOD
		      WHERE BLGMTX.CMPCOD    =?

		       ]]>
		    </QRY:Source>
	    </QRY:Definition>

	    <QRY:Definition>
		<QRY:Id>72</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.unaccounteddespatchesprocedure" Type="PROCEDURE">
		<![CDATA[
			CALL pkg_mal_mra_acc.SPR_MRA_UNACCOUNTED_DSN (
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
			    	?,
			    	?,
				?,
				?,
				?,
				?,
				?,
				?,
				?,
				?
			)
			]]>
		</QRY:Source>
	    </QRY:Definition>

	<QRY:Definition>
		<QRY:Id>73</QRY:Id>

		<QRY:Source Name="mail.mra.defaults.findintrlinblgentriesinrejmemo" Type="NATIVE">

		<![CDATA[

         SELECT MEM.CMPCOD CMPCOD,
        MST.CSGDOCNUM CSGDOCNUM,
        MST.CSGSEQNUM CSGSEQNUM,
        MST.MALIDR BLGBAS,
		MST.MALSEQNUM MALSEQNUM,
        DTL.SERNUM SERNUM,
        MST.POACOD POACOD,
        MEM.CRTCURCOD CURCOD,
		NULL RATIDF,
        NULL RATLINIDR,
        NULL RATTYP,
        MST.DSN DSN,
        DTL.DSTCOD DSTCOD,
        DTL.ORGCOD ORGCOD,
        MST.MALCTGCOD CTGCOD,
        MST.MALSUBCLS SUBCLS,
        MEM.MEMDAT DAT,
        MST.YER YER,
        MST.orgexgofc,
        MST.dstexgofc,
        MST.rsn,
        MST.HSN,
        MST.REGIND,
        DTL.TOTPCS PCS,
        MEM.MEMSTA STA,
        MEM.REVFLG REV,
        MEM.RMK RMK,
        DTL.SECFRM SECFRM,
        DTL.SECTOO SECTO,
        DTL.PVNWGT WGT,
        NULL REVGRSWGT,
        DTL.INTBLGTYP INTBLGTYP,
        NULL INVNUM,
        NULL RAT,
        MEM.BLGREJAMT AMT,
        NULL CCAREFNUM,
        NULL CCATYP,
        DTL.ARLCOD ARLCOD,
        MEM.LSTUPDTIM LSTUPDTIM,
        'Y' MEMO,
        MEM.OUTINVNUM OUTINVNUM,
        MEM.INWINVNUM INWINVNUM,
        MEM.ARLIDR ARLIDR,
				 		MEM.MEMCOD MEMCOD
      FROM MALMRAARLMEM MEM,
        MALMRAARLEXPDTL DTL,
        MALMRABLGMST MST
      WHERE MST.CMPCOD    = DTL.CMPCOD
     -- AND MST.MALIDR   =DTL.BLGBAS
     -- AND MST.CSGDOCNUM=DTL.CSGDOCNUM
     -- AND MST.CSGSEQNUM=DTL.CSGSEQNUM
	    AND MST.MALSEQNUM=DTL.MALSEQNUM
				 		AND MEM.CMPCOD = DTL.CMPCOD
				 		AND MEM.ARLIDR = DTL.ARLIDR
				 		AND MEM.MEMCOD = DTL.MEMCOD
				 		AND MEM.MEMSTA IN ('OB','OH')
   						AND MEM.CMPCOD =

		]]>

	</QRY:Source>



</QRY:Definition>
  
	    



	    <QRY:Definition>
			<QRY:Id>76</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findgpablgdlsinc66" Type="NATIVE">
			<![CDATA[
			SELECT DISTINCT DTL.INVSERNUM,
			  DTL.DSN,
			  DTL.BLGSTA,
			  DTL.APLRAT,
			  DTL.MALCHGBLGCUR WGTCHG,
			    DTL.OTHCHGBLGCUR ,
			  MST.YER YER,
			  DTL.RMK,
			  DTL.MCAREFNUM,
			  SMY.BLGPRDFRM,
			  SMY.BLGPRDTOO,
			  DTL.INVNUM,
			  POA.POANAM,
			  SMY.INVDAT BLDDAT,
			  SMY.GPACOD,
			  SMY.BLGCURCOD CURCOD,
			  SMY.INVSTA,
			  DTL.SRVTAXBLGCUR,
			  DTL.NETAMTBLGCUR,
			   MST.MALIDR BLGBAS
			FROM MALMRAGPAC66DTL DTL,
			  MALMRAGPAC51SMY SMY,
			  MALMRABLGMST MST,
			MALPOAMST POA
			WHERE DTL.CMPCOD = SMY.CMPCOD
			AND DTL.INVNUM = SMY.INVNUM
			AND DTL.GPACOD = SMY.GPACOD
			AND DTL.INVSERNUM = (SELECT MAX(INVSERNUM)
								  FROM MALMRAGPAC51SMY
								  WHERE CMPCOD = SMY.CMPCOD
								  AND INVNUM   = SMY.INVNUM
								  AND GPACOD   = SMY.GPACOD)
			AND SMY.GPACOD = POA.POACOD
			AND DTL.CMPCOD  = POA.CMPCOD
			AND DTL.CMPCOD = MST.CMPCOD
			AND DTL.MALSEQNUM = MST.MALSEQNUM
			AND DTL.CMPCOD =
			]]>
			</QRY:Source>
	</QRY:Definition>

	    <QRY:Definition>
			<QRY:Id>77</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listunaccounteddespatchesfrommrawithexception" Type="NATIVE">
			<![CDATA[
				SELECT    NULL CSGDOCNUM,
  						  SEGFLT.CMPCOD CMPCOD,
						  ORGEXG.CTYCOD ORIGIN,
						  DSTEXG.CTYCOD DESTN ,
						  (FLT.FLTCARCOD
						  || ' '
						  || FLT.FLTNUM ) FLIGHTNO                      ,
						  TO_CHAR (FLT.FLTDAT, 'DD-MON-YYYY') FLTDATE   ,
						  'PP' BILLTYPE                                 ,
						  ULD.CURCOD CURRENCY                           ,
						  NULL RATE                               ,
						  0 AMOUNT ,
						  SUM(COALESCE(ULD.ACPWGT,0)) WGT                    ,
						  POL SECFRM                                    ,
						  POU SECTO                                     ,
						  0 PRORATEDAMOUNTINNZD                         ,
						  'R1' REASONCODE                               ,
						  '' BLGBAS                                     ,
						  0 CSGSEQNUM                                   ,
						  '' POACOD                                     ,
						  ULD.DSN DSN                                   ,
						  MAX(ULD.SCNDAT) ACPDAT                   ,
						  0 SERNUM                     ,
						  0 SEGSERNUM                  ,
						  0 FLTSEQNUM                  ,
						  '' LSTUPDUSR                 ,
						  MAX(ULD.LSTUPDTIM) LSTUPDTIM ,
						  0 PRORATEDAMOUNTINCTR        ,
						  ULD.MALCTGCOD MALCTGCOD      ,
						  ULD.MALSUBCLS MALSUBCLS
						   FROM MALULDSEGDTL ULD
						INNER JOIN MALFLT FLT
							 ON ULD.CMPCOD = FLT.CMPCOD
						AND ULD.FLTCARIDR  = FLT.FLTCARIDR
						AND ULD.FLTSEQNUM  = FLT.FLTSEQNUM
						AND ULD.FLTNUM     = FLT.FLTNUM
						INNER JOIN MALFLTSEG SEGFLT
							 ON SEGFLT.CMPCOD = FLT.CMPCOD
						AND SEGFLT.FLTCARIDR  = FLT.FLTCARIDR
						AND SEGFLT.FLTSEQNUM  = FLT.FLTSEQNUM
						AND SEGFLT.FLTNUM     = FLT.FLTNUM
						AND SEGFLT.POL        = FLT.ARPCOD
						AND SEGFLT.SEGSERNUM  = ULD.SEGSERNUM
						INNER JOIN MALEXGOFCMST ORGEXG
							 ON ORGEXG.CMPCOD = ULD.CMPCOD
						AND ORGEXG.EXGOFCCOD  = ULD.ORGEXGOFC
						INNER JOIN SHRCTYMST ORGCTY
							 ON ORGCTY.CMPCOD = ORGEXG.CMPCOD
						AND ORGCTY.CTYCOD     = ORGEXG.CTYCOD
						INNER JOIN MALEXGOFCMST DSTEXG
							 ON DSTEXG.CMPCOD = ULD.CMPCOD
						AND DSTEXG.EXGOFCCOD  = ULD.DSTEXGOFC
						INNER JOIN SHRCTYMST DSTCTY
							 ON DSTCTY.CMPCOD = DSTEXG.CMPCOD
						AND DSTCTY.CTYCOD     = DSTEXG.CTYCOD
						  WHERE ULD.ACPBAG    > 0
						AND ULD.RCVBAG        = 0

						AND TRUNC(FLT.FLTDAT) BETWEEN TO_DATE (? ,'DD-MON-YYYY') AND TO_DATE (? ,'DD-MON-YYYY')
			]]>
			</QRY:Source>
	</QRY:Definition>

	    <QRY:Definition>
			<QRY:Id>78</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findunaccounteddipatchtotalforR1withexp" Type="NATIVE">
			<![CDATA[
				SELECT    NULL CSGDOCNUM,
  						  SEGFLT.CMPCOD CMPCOD,
						  ORGEXG.CTYCOD ORIGIN,
						  DSTEXG.CTYCOD DESTN ,
						  (FLT.FLTCARCOD
						  || ' '
						  || FLT.FLTNUM ) FLIGHTNO                      ,
						  TO_CHAR (FLT.FLTDAT, 'DD-MON-YYYY') FLTDATE   ,
						  'PP' BILLTYPE                                 ,
						  ULD.CURCOD CURRENCY ,
						  NULL RATE                               ,
						  0 AMOUNT ,
						  SUM(COALESCE(ULD.ACPWGT,0)) WGT                    ,
						  POL SECFRM                                    ,
						  POU SECTO                                     ,
						  0 PRORATEDAMOUNTINNZD                         ,
						  'R1' REASONCODE                               ,
						  '' BLGBAS                                     ,
						  0 CSGSEQNUM                                   ,
						  '' POACOD                                     ,
						  ULD.DSN DSN                                   ,
						  MAX(ULD.SCNDAT) ACPDAT                   ,
						  0 SERNUM                     ,
						  0 SEGSERNUM                  ,
						  0 FLTSEQNUM                  ,
						  '' LSTUPDUSR                 ,
						  MAX(ULD.LSTUPDTIM) LSTUPDTIM ,
						  0 PRORATEDAMOUNTINCTR        ,
						  ULD.MALCTGCOD MALCTGCOD      ,
						  ULD.MALSUBCLS MALSUBCLS
						   FROM MALULDSEGDTL ULD
						INNER JOIN MALFLT FLT
							 ON ULD.CMPCOD = FLT.CMPCOD
						AND ULD.FLTCARIDR  = FLT.FLTCARIDR
						AND ULD.FLTSEQNUM  = FLT.FLTSEQNUM
						AND ULD.FLTNUM     = FLT.FLTNUM
						INNER JOIN MALFLTSEG SEGFLT
							 ON SEGFLT.CMPCOD = FLT.CMPCOD
						AND SEGFLT.FLTCARIDR  = FLT.FLTCARIDR
						AND SEGFLT.FLTSEQNUM  = FLT.FLTSEQNUM
						AND SEGFLT.FLTNUM     = FLT.FLTNUM
						AND SEGFLT.POL        = FLT.ARPCOD
						AND SEGFLT.SEGSERNUM  = ULD.SEGSERNUM
						INNER JOIN MALEXGOFCMST ORGEXG
							 ON ORGEXG.CMPCOD = ULD.CMPCOD
						AND ORGEXG.EXGOFCCOD  = ULD.ORGEXGOFC
						INNER JOIN SHRCTYMST ORGCTY
							 ON ORGCTY.CMPCOD = ORGEXG.CMPCOD
						AND ORGCTY.CTYCOD     = ORGEXG.CTYCOD
						INNER JOIN MALEXGOFCMST DSTEXG
							 ON DSTEXG.CMPCOD = ULD.CMPCOD
						AND DSTEXG.EXGOFCCOD  = ULD.DSTEXGOFC
						INNER JOIN SHRCTYMST DSTCTY
							 ON DSTCTY.CMPCOD = DSTEXG.CMPCOD
						AND DSTCTY.CTYCOD     = DSTEXG.CTYCOD
						  WHERE ULD.ACPBAG    > 0
						AND ULD.RCVBAG        = 0
						AND TRUNC(FLT.FLTDAT) BETWEEN TO_DATE (?,'DD-MON-YYYY') AND TO_DATE (?,'DD-MON-YYYY')
			]]>
			</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>16</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findgpabillingperiods" Type="NATIVE">
		<![CDATA[

		SELECT COUNT(*) VAL FROM MALPOADTL poadtl,shrbilprddtl dtl

		WHERE

		DTL.CMPCOD = poadtl.CMPCOD

		AND poadtl.blgfrq = dtl.bilprdcod

		AND poadtl.PARCOD ='BLGINFO'

		AND DTL.CMPCOD = ?

		AND poadtl.vldfrm <= ?

		AND poadtl.vldtoo >= ?

		AND poadtl.blgfrq = ?

		AND DTL.BILFRMPRD = ?

		AND DTL.BILENDPRD = ?

		]]>
	</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>79</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.generatecsvreport" Type="PROCEDURE">
		<![CDATA[

			CALL PKG_MAL_MRA_MALEXPRPT.SPR_GENCSVRPT(?,?,?,?,?,?,?,?)

		]]>
	</QRY:Source>
	</QRY:Definition>

	
<QRY:Definition>

		<QRY:Id>81</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findbillingentriesforflight" Type="NATIVE">
		<![CDATA[
		SELECT DISTINCT
		BLGMST.CMPCOD,
		BLGMST.CSGDOCNUM,BLGMST.CSGSEQNUM,BLGMST.MALIDR,
		CSGMST.CSGORG,CSGMST.CSGDST,CSGMST.CSGDAT,
		POAMST.POACOD,POAMST.CNTCOD,BLGDTL.SERNUM,
		BLGDTL.WGTCHGCTR,BLGDTL.CTRCURCOD,
		BLGDTL.RATINCSRVTAXFLG,
		OFC1.ARPCOD ORG,
		OFC2.ARPCOD DST,
		BLGDTL.SECFRM,
		BLGDTL.SECTOO,
		BLGDTL.BILTOOPOA,
		NULL PAYFLG,
		BLGDTL.NETAMT,
		BLGDTL.VALCHGCTR,
		ctymst.cntcod ORGCNTCOD,
		BLGDTL.MALSEQNUM,
		MRAINT.SEQNUM SEQNUMINT
		FROM
		MALMRABLGMST BLGMST
		INNER JOIN MALMRAGPABLGDTL BLGDTL
		ON BLGMST.CMPCOD = BLGDTL.CMPCOD
		AND BLGMST.MALSEQNUM = BLGDTL.MALSEQNUM
		INNER JOIN MALEXGOFCMST OFC1
		ON BLGMST.CMPCOD = OFC1.CMPCOD
		AND BLGMST.ORGEXGOFC = OFC1.EXGOFCCOD
		INNER JOIN MALEXGOFCMST OFC2
		ON BLGMST.CMPCOD = OFC2.CMPCOD
		AND BLGMST.DSTEXGOFC = OFC2.EXGOFCCOD
		LEFT OUTER JOIN MALCSGMST CSGMST
		ON BLGDTL.CMPCOD = CSGMST.CMPCOD
		AND BLGMST.POACOD = CSGMST.POACOD
		AND BLGMST.CSGDOCNUM = CSGMST.CSGDOCNUM
		AND BLGMST.CSGSEQNUM = CSGMST.CSGSEQNUM

		INNER JOIN  MALPOAMST POAMST
		ON CSGMST.CMPCOD = POAMST.CMPCOD
		AND CSGMST.POACOD = POAMST.POACOD

		inner join SHRCTYMST ctymst 
		on BLGMST.CMPCOD    =ctymst.CMPCOD
		and BLGMST.orgctycod =ctymst.ctycod 
		left outer join MALMRAINT MRAINT
		ON BLGMST.CMPCOD    =MRAINT.CMPCOD
		AND BLGMST.MALSEQNUM=MRAINT.MALSEQNUM
		AND MRAINT.SEQNUM   =
		  (SELECT MAX(SEQNUM)
		  FROM MALMRAINT
		  WHERE MALSEQNUM=BLGMST.MALSEQNUM
		  AND CMPCOD     =BLGMST.CMPCOD
		  )
		AND MRAINT.TAXUPD   ='N'
		WHERE BLGDTL.CMPCOD = ?
		AND BLGDTL.FLTCARIDR = ?
		AND BLGDTL.FLTNUM = ?
		AND BLGDTL.FLTSEQNUM = ?

		]]>
	</QRY:Source>
	</QRY:Definition>

<!--added for 7352 starts-->
	<QRY:Definition>
		<QRY:Id>82</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findmcalov" Type="NATIVE">
		<![CDATA[
			  SELECT CCADTL.MCAREFNUM CCANUM,
			   	  MST.CSGDOCNUM             ,
				  CCADTL.MCATYP                ,
				  NULL              ,
				  CCADTL.ISSDAT                ,
				  MST.DSN                   ,
				  CCADTL.MCASTA,
				  MST.YER YER
				   FROM MALMRAMCA CCADTL, MALMRABLGMST MST
				  WHERE
					CCADTL.CMPCOD = MST.CMPCOD
					AND CCADTL.MALSEQNUM = MST.MALSEQNUM
				    AND CCADTL.CMPCOD=?



		]]>
	</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>83</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.finddsnlov" Type="NATIVE">
		<![CDATA[
			   SELECT blgmst.DSN                         ,
			          blgmst.RSN                         ,
					  blgmst.HSN                         ,
					  blgmst.REGIND                      ,
					  blgmst.ORGEXGOFC                   ,
					   blgmst.DSTEXGOFC                  ,
					    blgmst.MALCTGCOD                  ,
						blgmst.MALSUBCLS                  ,
						blgmst.YER                  ,
					  blgmst.CSGDOCNUM                         ,
					  blgmst.CSGSEQNUM                         ,
					  blgmst.POACOD                            ,
					  blgmst.ORGARPCOD,
					  blgmst.DSTARPCOD,
					  blgmst.MALIDR
					   FROM MALMRABLGMST blgmst
						 WHERE BLGMST.CMPCOD = ?


		]]>
	</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>84</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.triggerproration" Type="PROCEDURE">
		<![CDATA[

			CALL Pkg_MAL_Mra_Prorat.spr_prorat_dsn(?,?,?,?,?,?,?,?,?,?,?,?)


		]]>
	</QRY:Source>
	</QRY:Definition>
	<!--Added by A-5166 for ICRD-17262 on 08-Feb-2013 Starts-->
	<QRY:Definition>
				<QRY:Id>84</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findratelinestocheckoverlap" Type="NATIVE">
					<![CDATA[
					SELECT 	   RATLIN.CMPCOD,
						   RATLIN.RATCRDCOD,
						   RATLIN.RATLINSEQNUM,
						   RATLIN.RATLINSTA,
						   RATLIN.ORGCOD,
						   RATLIN.DSTCOD,
						   RATLIN.IATKLM,
						   RATLIN.MALKLM,
						   RATLIN.CATONEXDRCURRAT,
						   RATLIN.CATTWOXDRCURRAT,
						   RATLIN.CATTHRXDRCURRAT,
						   RATLIN.CATONEBASCURRAT,
						   RATLIN.CATTWOBASCURRAT,
						   RATLIN.CATTHRBASCURRAT,
						   RATLIN.VLDSTRDAT,
						   RATLIN.VLDENDDAT,
						   RATLIN.LSTUPDUSR,
						   RATLIN.LSTUPDTIM ,
               					   'N' OVERLAPFLG
						   FROM MALMRARATLIN RATLIN
					   WHERE RATLIN.CMPCOD=?
             	AND RATLIN.RATCRDCOD=?
               and not  exists
             ( select 1 from MALMRARATLIN LIN where LIN.ORGCOD = RATLIN.ORGCOD
             and  LIN.DSTCOD = RATLIN.DSTCOD
             and  LIN.cmpcod = ratlin.cmpcod
             and ( ? between LIN.VLDSTRDAT and LIN.VLDENDDAT OR
             ? between LIN.VLDSTRDAT and LIN.VLDENDDAT )
             and  LIN.RATCRDCOD != RATLIN.RATCRDCOD
             and LIN.ratlinsta = 'A')
             union all
					SELECT 	   RATLIN.CMPCOD,
						   RATLIN.RATCRDCOD,
						   RATLIN.RATLINSEQNUM,
						   RATLIN.RATLINSTA,
						   RATLIN.ORGCOD,
						   RATLIN.DSTCOD,
						   RATLIN.IATKLM,
						   RATLIN.MALKLM,
						   RATLIN.CATONEXDRCURRAT,
						   RATLIN.CATTWOXDRCURRAT,
						   RATLIN.CATTHRXDRCURRAT,
						   RATLIN.CATONEBASCURRAT,
						   RATLIN.CATTWOBASCURRAT,
						   RATLIN.CATTHRBASCURRAT,
						   RATLIN.VLDSTRDAT,
						   RATLIN.VLDENDDAT,
						   RATLIN.LSTUPDUSR,
						   RATLIN.LSTUPDTIM,
               					   'Y' OVERLAPFLG
						   FROM MALMRARATLIN RATLIN
					   WHERE RATLIN.CMPCOD=?
             AND RATLIN.RATCRDCOD=?
                and  exists
             ( select 1 from MALMRARATLIN LIN where LIN.ORGCOD = RATLIN.ORGCOD
             and  LIN.DSTCOD = RATLIN.DSTCOD
             and  LIN.cmpcod = ratlin.cmpcod
             and ( ? between LIN.VLDSTRDAT and LIN.VLDENDDAT OR
             ? between LIN.VLDSTRDAT and LIN.VLDENDDAT )
             and  LIN.RATCRDCOD != RATLIN.RATCRDCOD
             and LIN.ratlinsta = 'A')


				]]>
				</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>85</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findoverlapratelinedetails" Type="NATIVE">
		<![CDATA[
			 select * from MALMRARATLIN LIN where
 		  		     LIN.ORGCOD = ?
             			and  LIN.DSTCOD = ?
             			and  LIN.cmpcod = ?
             			and ( ? between LIN.VLDSTRDAT and LIN.VLDENDDAT OR
             			      ? between LIN.VLDSTRDAT and LIN.VLDENDDAT )
             			and  LIN.RATCRDCOD != ?
             			and LIN.ratlinsta = 'A'
		]]>
		</QRY:Source>
	</QRY:Definition>
	<!--Added by A-5166 for ICRD-17262 on 08-Feb-2013 Ends-->
	<QRY:Definition>
			<QRY:Id>85</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.triggermcaacc" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_ACC_NEW.SPR_MRA_MALFLNACC_MCA(?,?,?,?,?,?,?,?,?,?)
			]]>
		</QRY:Source>
	</QRY:Definition>
	<!--Added by A-5166 for ICRD-17262 starts-->
	<QRY:Definition>
		<QRY:Id>82</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findRoutingCarrierDetails" Type="NATIVE">
		<![CDATA[
			SELECT * FROM MALMRARTGCFG WHERE
			CMPCOD = ?
		]]>
		</QRY:Source>
	</QRY:Definition>
	<!--Added by A-5166 for ICRD-17262 Ends-->
	<!--Added by A-5166 for ICRD-36146 starts-->
	<QRY:Definition>
		<QRY:Id>86</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.initiateproration" Type="PROCEDURE">
		<![CDATA[
				CALL PKG_MAL_MRA_IMPORTMAIL.PRORATE_DSN_YYROUTING(?,?,?,?)
		]]>
		</QRY:Source>
	</QRY:Definition>
<!--Added by A-5166 for ICRD-36146 Ends-->
	<QRY:Definition>
			<QRY:Id>87</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.billingsitemaster"
				Type="NATIVE">
				<![CDATA[
			SELECT
			       BSTMST.CMPCOD,
			       BSTMST.BLGSITCOD BLGSITMSTCOD,
				   BSTMST.BLGSITNAM,
			       BSTMST.FRMDAT,
			       BSTMST.TOODAT,
			       BSTMST.SIGONE,
			       BSTMST.SIGTWO,
			       BSTMST.DSGONE,
			       BSTMST.DSGTWO,
				   BSTMST.ARLADR,
             BSTMST.CORADR,
             BSTMST.RMK,
             BSTBNK.CURCOD,
			 BSTBNK.BLGSITCOD BLGSITBNKCOD,
             BSTBNK.BNKNAM,
			 BSTBNK.SERNUM BNKSERNUM,
			 BSTCNT.SERNUM CNTSERNUM,
             BSTBNK.BNKBRN,
             BSTBNK.ACCNUM,
             BSTBNK.CTYNAM,
             BSTBNK.CNTNAM,
             BSTBNK.SWTCOD,
             BSTBNK.IBNNUM,
             BSTCNT.CNTCOD,
			 BSTCNT.BLGSITCOD BLGSITCNTCOD
FROM MALMRABLGSITMST BSTMST LEFT OUTER JOIN 
  MALMRABLGSITBNKDTL BSTBNK ON (BSTMST.CMPCOD  = BSTBNK.CMPCOD AND  BSTMST.BLGSITCOD =BSTBNK.BLGSITCOD)
  LEFT OUTER JOIN
  MALMRABLGSITCNTDTL BSTCNT ON (BSTMST.CMPCOD = BSTCNT.CMPCOD

AND BSTMST.BLGSITCOD =BSTCNT.BLGSITCOD)
			       WHERE

BSTMST.CMPCOD    = ?
AND BSTMST.BLGSITCOD = ?
		]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>88</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listbillinglovs"
				Type="NATIVE">
				<![CDATA[
			      SELECT
			       BLGSITCOD,
			       BLGSITNAM
			       FROM MALMRABLGSITMST
			       WHERE  CMPCOD = ?
		]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>89</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findcountrydateoverlap"
				Type="NATIVE">
				<![CDATA[
			     SELECT BLGSIT.*
					FROM
					  (SELECT BSTMST.BLGSITCOD,
					BSTMST.FRMDAT,
					BSTMST.TOODAT,
					BSTCNT.BLGSITCOD BLGSITCNTCOD,
					BSTCNT.CNTCOD
					  FROM MALMRABLGSITMST BSTMST
					  LEFT OUTER JOIN MALMRABLGSITCNTDTL BSTCNT
					  ON BSTMST.CMPCOD  =BSTCNT.CMPCOD
					  AND BSTMST.BLGSITCOD =BSTCNT.BLGSITCOD
					  WHERE BSTMST.CMPCOD  = ?
			    
		]]>
		</QRY:Source>
	</QRY:Definition>
		<QRY:Definition>
			<QRY:Id>90</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.updateflightsegment" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_IMPORTMAIL.SPR_UPDATE_CRAFLTSEG_LSTUPDIM(
					?,
					?,
					?,
					?,
					?
				)
				]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>91</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.processBillingMatrixUploadDetails" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_BILMTX_UPLOAD.spr_mra_billingmtxupload( ?, ?, ?, ?)
			]]>
		</QRY:Source>
	</QRY:Definition>
		<!--Added by A-6245 for ICRD-106057 on 15-05-2015 starts-->
	<QRY:Definition>
			<QRY:Id>92</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.triggerintmcaacc" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_ACC_NEW.SPR_MRA_ACCINTMCA(?,?,?,?,?,?,?,?,?,?)
			]]>
		</QRY:Source>
	</QRY:Definition>
	<!--Added by A-6245 for ICRD-106057 ends-->
	<!--Added by A-6245 for ICRD-106032 ends-->
	<QRY:Definition>
		<QRY:Id>93</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.prorateexceptionflights" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_RATING.SPR_MRA_PRORATEEXCEPTIONFLIGHT
								(
									?,
									?,
									?,
									?,
									?,
									?,
									?
								)
							]]>
			</QRY:Source>
	</QRY:Definition>
	<!--Added by A-6245 for ICRD-106032 ends-->
	<QRY:Definition>
			<QRY:Id>93</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findBillingLineChargeDetails" Type="NATIVE">
			<![CDATA[
				SELECT LGLINRATBSS.CMPCOD,
				  LGLINRATBSS.BLGMTXCOD,
				  LGLINRATBSS. BLGLINSEQNUM,
				  LGLINRATBSS.CHGTYP,
				  LGLINRATBSS.RATBSS,
				  LGLINRATBSS.FRMWGT,
				  LGLINRATBSS.APPRAT,
				  LGLINRATBSS.RATBSS,
				  BLGLIN.CURCOD
				FROM MALMRABLGMTXLINBSS LGLINRATBSS
				INNER JOIN MALMRABLGMTXLIN BLGLIN
				ON LGLINRATBSS.CMPCOD        =BLGLIN.CMPCOD
				AND LGLINRATBSS.BLGMTXCOD    =BLGLIN.BLGMTXCOD
				AND LGLINRATBSS.BLGLINSEQNUM =BLGLIN.BLGLINSEQNUM
				WHERE LGLINRATBSS.CMPCOD = ?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
		<QRY:Definition>
			<QRY:Id>94</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listSurchargeProrationDetails" Type="NATIVE">
			<![CDATA[
				SELECT
				DTL.CMPCOD,
				MST.CSGSEQNUM,
				MST.CSGDOCNUM,
				MST.POACOD,
				MST.MALIDR,
				DTL.SERNUM,
				SURCHG.CHGCOD,
				SURCHG.CHGAMTCTR,
				SURCHG.CHGAMTUSD,
				SURCHG.CHGAMTXDR,
				SURCHG.CHGAMTBAS,
				DTL.SECFRM,
				DTL.SECTOO,
				SUM(SURCHG.CHGAMTCTR)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALS,
				SUM(SURCHG.CHGAMTUSD)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALUSDS,
				SUM(SURCHG.CHGAMTXDR)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALSDRS,
				SUM(SURCHG.CHGAMTBAS)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALBASS
				FROM  MALMRABLGDTL DTL, MALMRABLGCHG SURCHG, MALMRABLGMST MST
				WHERE
				DTL.CMPCOD     = SURCHG.CMPCOD
				AND MST.MALSEQNUM = SURCHG.MALSEQNUM
				AND MST.MALSEQNUM = DTL.MALSEQNUM
				AND MST.CMPCOD = SURCHG.CMPCOD
				AND MST.CMPCOD = DTL.CMPCOD
				AND DTL.SERNUM   = SURCHG.SERNUM
				AND DTL.CMPCOD = ?
				AND MST.POACOD =?
				AND MST.MALIDR =?
				AND SURCHG.SERNUM=?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>95</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listSurchargeCCADetails" Type="NATIVE">
			<![CDATA[
				SELECT CCACHGDTL.CMPCOD,
				  MST.MALIDR,
				  MST.CSGDOCNUM,
				  MST.CSGSEQNUM,
				  MST.POACOD,
				  CCACHGDTL.MCAREFNUM,
				  CCACHGDTL.CHGCOD,
				  CCACHGDTL.ORGCHGAMTCTR,
				  CCACHGDTL.REVCHGAMTCTR,
				  CCACHGDTL.ORGRAT,
				  CCACHGDTL.REVRAT
				FROM MALMRAMCACHGDTL CCACHGDTL, MALMRABLGMST MST
				WHERE
				MST.CMPCOD = CCACHGDTL.CMPCOD
				AND MST.MALSEQNUM = CCACHGDTL.MALSEQNUM
				AND CCACHGDTL.CMPCOD  = ?
				AND MST.MALIDR    = ?

				AND CCACHGDTL.MCAREFNUM = ?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>96</QRY:Id>
			<QRY:Source Name="mail.mra.gpabilling.listSurchargeDetails" Type="NATIVE">
			<![CDATA[
				SELECT CCACHGDTL.CMPCOD,
				  CCACHGDTL.INVNUM,
				  MST.MALSEQNUM,
				  MST.MALIDR,
				  CCACHGDTL.GPACOD,
				  MST.CSGSEQNUM,
				  MST.CSGDOCNUM,
				  CCACHGDTL.CHGTYP,
				  CCACHGDTL.APLRAT,
				  CCACHGDTL.CHGAMTBLGCUR,
				  POADTL.STLCUR
				FROM MALMRAGPAC66CHGDTL CCACHGDTL
				LEFT OUTER JOIN MALPOADTL POADTL
				ON CCACHGDTL.CMPCOD=POADTL.CMPCOD
				AND CCACHGDTL.GPACOD=POADTL.POACOD
        LEFT OUTER JOIN MALMRABLGMST MST ON
        CCACHGDTL.CMPCOD=MST.CMPCOD
        AND CCACHGDTL.MALSEQNUM=MST.MALSEQNUM
				AND POADTL.PARCOD='STLINFO'
				WHERE CCACHGDTL.CMPCOD  = ?
				AND CCACHGDTL.INVNUM    = ?
				AND CCACHGDTL.INVSERNUM = (SELECT MAX(INVSERNUM)
				FROM MALMRAGPAC66CHGDTL CCACHGDTL
				WHERE INVNUM = CCACHGDTL.INVNUM
				AND CMPCOD = MST.CMPCOD
				AND MALSEQNUM =MST.MALSEQNUM
				AND CHGTYP=CCACHGDTL.CHGTYP
				AND GPACOD = CCACHGDTL.GPACOD)
				AND MST.MALSEQNUM=?
				AND MST.MALIDR    = ?
				AND CCACHGDTL.GPACOD    =?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>97</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.billingmatrixaudit" Type="NATIVE">
			<![CDATA[
				SELECT CMPCOD,ACTCOD, AUDRMK, ADLINF, STNCOD, UPDUSR,
			   UPDTXNTIM, UPDTXNTIMUTC
			   FROM MALMRABLGMTXAUD
			   WHERE CMPCOD=?
			   AND BLGMTXCOD=?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
		<QRY:Definition>
			<QRY:Id>98</QRY:Id>
			<QRY:Source Name="mail.mra.gpabilling.listSurchargeBillableDetails" Type="NATIVE">
			<![CDATA[
				SELECT BLGCHG.APLRAT,
				  BLGCHG.CHGCOD CHGTYP,
					  BLGCHG.CHGCOD,
				  MST.MALIDR,
				  MST.POACOD,
				  MST.CSGSEQNUM,
				  MST.CSGDOCNUM,
				  BLGCHG.CHGAMTCTR CHGVAL
				FROM MALMRABLGCHG BLGCHG
        INNER JOIN  MALMRABLGMST MST ON
				BLGCHG.CMPCOD=MST.CMPCOD
				AND BLGCHG.MALSEQNUM=MST.MALSEQNUM
				INNER JOIN MALMRAGPABLGDTL BLGDTL ON
				BLGDTL.CMPCOD=MST.CMPCOD
				AND BLGDTL.MALSEQNUM=MST.MALSEQNUM
				WHERE BLGCHG.CMPCOD  = ?
				AND MST.MALIDR    = ?
				AND BLGDTL.BILTOOPOA    =?
				--AND MST.CSGSEQNUM = ?
--AND MST.CSGDOCNUM = ?
				AND BLGCHG.SERNUM=1
				AND NOT EXISTS (SELECT 1 FROM  MALMRAMCA DTL,MALMRABLGMST MST  WHERE
					DTL.CMPCOD=MST.CMPCOD
					AND DTL.MALSEQNUM=MST.MALSEQNUM
					AND DTL.MCASTA = 'A'
					AND DTL.MCATYP = 'A'
					AND DTL.CMPCOD =?
					AND MST.MALIDR   =?
					--AND MST.CSGSEQNUM =?
					--AND MST.CSGDOCNUM =?
					)
			       ]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>99</QRY:Id>
		<QRY:Source Name="mail.mra.gpabilling.listSurchargeMcaillableDetails" Type="NATIVE">
			<![CDATA[
				SELECT DISTINCT COALESCE(SURCHG. APLRAT,0)APLRAT,
				  SURCHGCCA.CHGCOD,
				  SURCHGCCA.CMPCOD,
				  MST.MALIDR,
				  MST.POACOD,
				  MST.CSGSEQNUM,
				  MST.CSGDOCNUM,
				  SURCHGCCA.REVCHGAMTCTR CHGVAL
				FROM MALMRAMCACHGDTL SURCHGCCA
        INNER JOIN MALMRABLGMST MST ON
        	 MST.CMPCOD =SURCHGCCA.CMPCOD
				AND MST.MALSEQNUM =SURCHGCCA.MALSEQNUM
				LEFT OUTER JOIN MALMRABLGCHG SURCHG
				ON SURCHGCCA.CMPCOD     =SURCHG.CMPCOD
				AND SURCHGCCA.MALSEQNUM    = SURCHG.MALSEQNUM
				INNER JOIN MALMRAMCA CCADTL
				ON SURCHGCCA.CMPCOD     =CCADTL.CMPCOD
				AND MST.CMPCOD =CCADTL.CMPCOD
				AND MST.MALSEQNUM =CCADTL.MALSEQNUM
				WHERE CCADTL.CMPCOD  = ?
				AND MST.MALIDR    = ?
				AND CCADTL.REVGPACOD = ?
				--AND MST.CSGSEQNUM = ?
				--AND MST.CSGDOCNUM = ?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
<QRY:Definition>
<!--Query MOdified by A-7794 as part of ICRD-252665-->
		<QRY:Id>100</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findgpablgdlsinmca" Type="NATIVE">
		<![CDATA[
				SELECT 0 INVSERNUM,
					  MST.DSN,
					  DTL.BLGSTA,
					  DTL.APLRAT,
					  CASE
						WHEN C66.INVNUM IS NOT NULL
						THEN CCA.REVWGTCHGCTR-CCA.WGTCHGCTR
						ELSE CCA.REVWGTCHGCTR
					  END WGTCHG,
					  CASE
						WHEN C66.INVNUM IS NOT NULL
						THEN CCA.REVOTHCHGCTR-CCA.OTHCHGCTR
						ELSE CCA.REVOTHCHGCTR
					  END OTHCHG,
					  MST.YER YER,
					  DTL.RMK,
					  CCA.MCAREFNUM CCAREFNUM,
						 CCA.BILPRDFRM BLGPRDFRM,
						  CCA.BILPRDTOO BLGPRDTOO,
						  C66.INVNUM,
						  CCA.GPANAM POANAM,
					  NULL BLDDAT,
						  CCA.GPACOD,
					  CCA.REVCTRCURCOD CURCOD,
					  NULL INVSTA,
					  CASE
						WHEN C66.INVNUM IS NOT NULL
						THEN CCA.REVSRVTAX-CCA.SRVTAX
						ELSE CCA.REVSRVTAX
					  END SRVTAX,
					  CASE
						WHEN C66.INVNUM IS NOT NULL
						THEN CCA.REVNETAMT-CCA.NETAMT
						ELSE CCA.REVNETAMT
					  END NETAMT,
						  MST.MALIDR BLGBAS
					FROM MALMRAMCA CCA,
					  MALMRAGPABLGDTL DTL,
					  MALMRABLGMST MST,
					  MALMRAGPAC66DTL C66
					WHERE CCA.CMPCOD      = DTL.CMPCOD
					AND CCA.MALSEQNUM        = DTL.MALSEQNUM
					AND CCA.CMPCOD        = MST.CMPCOD
					AND CCA.MALSEQNUM        = MST.MALSEQNUM
					AND CCA.CMPCOD        = C66.CMPCOD(+)
					AND CCA.MALSEQNUM        = C66.MALSEQNUM(+)
					AND CCA.REVGPACOD     = C66.GPACOD(+)
					AND CCA.MCASTA        = 'A'
					AND CCA.MCATYP        = 'A'
					AND CCA.CMPCOD        = ?
					AND MST.MALIDR        = ?
					AND TRUNC(MST.RCVDAT) = ?
					AND CCA.BLGSTA        = 'BB'
					AND CCA.MCAREFNUM  =
						(SELECT MAX(CCADTL.MCAREFNUM)
						FROM MALMRAMCA CCADTL
						WHERE CCADTL.CMPCOD  = MST.CMPCOD
						AND CCADTL.MALSEQNUM    = MST.MALSEQNUM
						AND CCADTL.BLGSTA    ='BB'
						AND CCADTL.REVNETAMT<>0
						)
			       ]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>101</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.listSurchargeProrationDetailsformca" Type="NATIVE">
			<![CDATA[
				SELECT
				DTL.CMPCOD,
				MST.CSGSEQNUM,
				MST.CSGDOCNUM,
				MST.POACOD,
				MST.MALIDR,
				DTL.SERNUM,
				CASE WHEN CHGDTL.CHGCOD IS NOT NULL AND CHGDTL.MCAREFNUM IS NOT NULL
				  THEN
					CHGDTL.CHGCOD
					ELSE
					SURCHG.CHGCOD
					END CHGCOD,
				  CASE WHEN CHGDTL.MCAREFNUM IS NOT NULL
				   THEN CHGDTL.REVCHGAMTCTR
				   ELSE SURCHG.CHGAMTCTR
			    END CHGAMTCTR,
				SURCHG.CHGAMTUSD,
				SURCHG.CHGAMTXDR,
				SURCHG.CHGAMTBAS,
				DTL.SECFRM,
				DTL.SECTOO,
				SUM(SURCHG.CHGAMTCTR)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALS,
				SUM(SURCHG.CHGAMTUSD)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALUSDS,
				SUM(SURCHG.CHGAMTXDR)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALSDRS,
				SUM(SURCHG.CHGAMTBAS)  OVER (PARTITION BY DTL.CMPCOD, MST.CSGSEQNUM,MST.CSGDOCNUM,MST.POACOD,MST.POACOD,DTL.SERNUM) AS CHGVALBASS,
				CASE WHEN CHGDTL.REVRAT IS NOT NULL THEN CHGDTL.REVRAT ELSE SURCHG.APLRAT END SURCHGRAT,
				CASE WHEN CHGDTL.ORGRAT IS NOT NULL THEN CHGDTL.ORGRAT ELSE SURCHG.APLRAT END REVSURCHGRAT
				FROM MALMRABLGDTL DTL
               INNER JOIN MALMRABLGCHG SURCHG
               ON DTL.CMPCOD     = SURCHG.CMPCOD
				AND DTL.MALSEQNUM = SURCHG.MALSEQNUM
               INNER JOIN MALMRABLGMST MST
               ON MST.CMPCOD     = SURCHG.CMPCOD
				AND MST.MALSEQNUM   = SURCHG.MALSEQNUM
               LEFT OUTER JOIN MALMRAMCACHGDTL CHGDTL
              ON CHGDTL.CMPCOD     = MST.CMPCOD
               AND CHGDTL.MALSEQNUM = MST.MALSEQNUM
				WHERE SURCHG.SERNUM=1
				AND DTL.PAYFLG   = 'R'
				AND DTL.CMPCOD = ?
				AND MST.MALIDR =?
			       ]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>102</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.updateinterfacedmails" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_RATING.SPR_MRA_UPDINTFCDMAL
								(
									?,
									?,
									?,
									?
								)
			       ]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>104</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.bulkactivationupurates" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_BILMTX_UPLOAD.spr_bulk_activateratelines
								(
									?,
									?,
									?,
									?,
									?
      )
			       ]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>104</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findRerateBillableMails" Type="NATIVE">
		<![CDATA[

		SELECT DTL.CMPCOD CMPCOD,DTL.MALSEQNUM,
  DTL.BLGSTA BLGSTA,
  MST.CSGSEQNUM CSGSEQNUM,
  DTL.SERNUM SEQNUM,
  MST.POACOD POACOD,
  MST.MALIDR BLGBAS,
  DTL.UPDBILTOOPOA COD,
  NULL CNTCOD,
  NULL INVNUM,
  MST.CSGDOCNUM CSGDOCNUM,
  MST.ORGEXGOFC ORG,
  MST.DSTEXGOFC DST,
  SUBCLS.SUBCLSGRP SUBCLSGRP,
  DTL.FLTDAT DAT,
  MST.MALCTGCOD CTGCOD,
  MST.MALSUBCLS SUBCLS,
  DTL.WGTCHGCTR MAILCHG,
  DTL.OTHCHGCTR SURCHG,
  DTL.VALCHGCTR,
  MST.YER YER,
  MST.DSN DSN,
  MST.RSN RSN,
  MST.HSN HSN,
  MST.REGIND REGIND,
  MST.TOTPCS PCS,
  MST.DSPWGT WGT,
  NULL REVGRSWGT,
  DTL.FLTNUM FLTNUM,
  NULL CCATYP,
  NULL ccarefnum,
  NULL LSTUPDTIM ,
  DTL.SRVTAX,
  DTL.TDS,
  DTL.NETAMT,
  DTL.APLRAT,
  DTL.CTRCURCOD,
  (DTL.WGTCHGCTR+DTL.OTHCHGCTR) GRSAMT,
  NULL REVCURCOD,
  DTL.RMK,
  POA.STLCUR
FROM MALMRABLGMST MST,
  MALMRAGPABLGDTL DTL,
  MALPOADTL POA,
  MALSUBCLSMST SUBCLS,
  MALEXGOFCMST ORGOFC,
  MALEXGOFCMST DSTOFC
WHERE MST.CMPCOD     = DTL.CMPCOD
AND MST.MALSEQNUM       = DTL.MALSEQNUM
AND POA.POACOD       = DTL.UPDBILTOOPOA
AND SUBCLS.CMPCOD    = MST.CMPCOD
AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
AND POA.CMPCOD       = DTL.CMPCOD
AND POA.PARCOD       = 'STLINFO'
AND ORGOFC.CMPCOD    = MST.CMPCOD
AND ORGOFC.EXGOFCCOD = MST.ORGEXGOFC
AND ORGOFC.ACTFLG    = 'A'
AND DSTOFC.CMPCOD    = MST.CMPCOD
AND DSTOFC.EXGOFCCOD = MST.DSTEXGOFC
AND DSTOFC.ACTFLG    = 'A'
AND TRUNC(MST.RCVDAT) BETWEEN POA.VLDFRM AND POA.VLDTOO
AND NOT EXISTS
  (SELECT 1
  FROM MALMRAMCA
  WHERE CMPCOD   = DTL.CMPCOD
  AND MALSEQNUM  = DTL.MALSEQNUM
  AND MCAREFNUM IS NOT NULL
  AND MCATYP     = 'A'
  AND MCASTA     NOT IN  ('A','N')
  )
AND DTL.BLGSTA      IN ('BB', 'OH', 'WP', 'WD', 'TR','RD','RR')
AND MST.CMPCOD       = ?
	]]>
		</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>
		<QRY:Id>105</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findRerateInterlineBillableMails" Type="NATIVE">
		<![CDATA[


SELECT DTL.CMPCOD CMPCOD,
  MST.CSGDOCNUM CSGDOCNUM,
  MST.CSGSEQNUM CSGSEQNUM,
  MST.MALIDR BLGBAS,
  DTL.SERNUM SERNUM,
  MST.POACOD POACOD,
  DTL.CTRCURCOD CURCOD,
  MST.DSN DSN,
  DSTEXG.CTYCOD DSTCOD,
  ORGEXG.CTYCOD ORGCOD,
  MST.MALCTGCOD CTGCOD,
  MST.MALSUBCLS SUBCLS,
  DTL.FLTDAT DAT,
  MST.YER YER,
  MST.ORGEXGOFC ORGEXGOFC,
  MST.DSTEXGOFC DSTEXGOFC,
  MST.RSN RSN,
  MST.HSN HSN,
  MST.REGIND REGIND,
  MST.TOTPCS PCS,
  DTL.BLGSTA STA,
  DTL.REVFLG REV,
  DTL.RMK RMK,
  DTL.SECFRM SECFRM,
  DTL.SECTOO SECTO,
  DTL.UPDGRSWGT WGT,
  NULL REVGRSWGT,
  NULL INTBLGTYP,
  NULL INVNUM,
  DTL.APLRAT RAT,
  DTL.WGTCHGCTR AMT,
  (SELECT DISTINCT (MCAREFNUM)
  FROM MALMRAMCA
  WHERE CMPCOD  = DTL.CMPCOD
  AND MALSEQNUM    = DTL.MALSEQNUM
  AND ISSDAT    =
    (SELECT MAX (ISSDAT )
    FROM MALMRAMCA
    WHERE CMPCOD  = DTL.CMPCOD
    AND MALSEQNUM    = DTL.MALSEQNUM
    AND MCATYP    = 'A'
    AND MCASTA    = 'OB'
    )
  AND MCASTA = 'OB'
  AND MCATYP = 'A'
  ) MCAREFNUM,
  NULL MCATYP,
  DTL.BILTOOPTYCOD ARLCOD,
  NULL LSTUPDTIM,
  NULL MEMO,
  NULL OUTINVNUM,
  NULL INWINVNUM,
  NULL ARLIDR,
  NULL MEMCOD
FROM MALMRABLGMST MST,
  MALMRABLGDTL DTL,
  MALEXGOFCMST ORGEXG,
  MALEXGOFCMST DSTEXG
WHERE MST.CMPCOD       = DTL.CMPCOD
AND MST.MALSEQNUM         = DTL.MALSEQNUM
AND ORGEXG.CMPCOD      = MST.CMPCOD
AND ORGEXG.EXGOFCCOD   = MST.ORGEXGOFC
AND DSTEXG.CMPCOD      = MST.CMPCOD
AND DSTEXG.EXGOFCCOD   = MST.DSTEXGOFC
AND NOT EXISTS (SELECT 1
    FROM MALMRAMCA
    WHERE CMPCOD  = DTL.CMPCOD
    AND MALSEQNUM    = DTL.MALSEQNUM
    AND MCATYP    = 'A'
    AND MCASTA    = 'OB')
AND ( DTL.BLGSTA       = 'IU'
OR DTL.BLGSTA          = 'OB'
OR DTL.BLGSTA          = 'OH' )
AND DTL.PAYFLG        <> 'T'
AND MST.CMPCOD         = ?
	]]>
	</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>109</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.latestCCAStatus" Type="NATIVE">
			<![CDATA[
			SELECT MCASTA
			FROM MALMRAMCA MCA, MALMRABLGMST MST
			WHERE
			MCA.CMPCOD = MST.CMPCOD
			AND MCA.MALSEQNUM = MST.MALSEQNUM
     AND MCA.CMPCOD  = ?
			AND MST.MALIDR    = ?
			--AND MST.CSGDOCNUM = ?
			--AND MST.CSGSEQNUM = ?
			AND MST.POACOD =  ?
			AND MCA.MCAREFNUM =
			  (SELECT MAX(MCAREFNUM)
			  FROM MALMRAMCA
			  WHERE CMPCOD  = MCA.CMPCOD
			  AND MALSEQNUM    = MCA.MALSEQNUM)

			  ]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>110</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.saveMraDataForRating" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_IMPORTMAIL.SPR_MRA_IMPORT_MAILDATA
								(
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?,
									?

								)
							]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>111</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.validateAgent" Type="NATIVE">
			<![CDATA[
			SELECT 'Y' ISVALID FROM
			MALMST MST
			LEFT OUTER JOIN OPRSHPMST SHP
			ON MST.CMPCOD  = SHP.CMPCOD
			AND MST.DOCOWRIDR   = SHP.DOCOWRIDR
			AND MST.MSTDOCNUM = SHP.MSTDOCNUM
			AND MST.DUPNUM = SHP.DUPNUM
			AND MST.SEQNUM = SHP.SEQNUM
			LEFT OUTER JOIN SHRAGTMST CUS
			ON SHP.CMPCOD  = CUS.CMPCOD
			AND SHP.AGTCOD = CUS.AGTCOD
			WHERE CUS.AGTTYP = ?
			AND MST.CMPCOD = ?
			AND MST.MALSEQNUM = ?
			  ]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>112</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findbillingLineParmeters" Type="NATIVE">
			<![CDATA[
			SELECT CMPCOD,PARCOD,PARDES FROM MALMRAPARMST
            WHERE CMPCOD = ?
			  ]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>110</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findReproarteMails" Type="NATIVE">
			<![CDATA[
			     SELECT
			     MST.CMPCOD,
			     MST.MALIDR BLGBAS,
				 MST.MALSEQNUM,
			     MST.CSGDOCNUM,
			     MST.CSGSEQNUM,
				 MST.POACOD,
				 EXP.EXPCOD
			     FROM MALMRABLGMST MST,
                 MALMRAEXPDTL EXP WHERE
                 MST.CMPCOD = EXP.CMPCOD AND
                 MST.MALSEQNUM = EXP.MALSEQNUM
				-- and rownum <=30000
				 AND
				 EXP.CMPCOD = ? AND
                 EXP.EXPSTA = 'U' AND
                 TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD') ) BETWEEN ? AND ?

			  ]]>
		</QRY:Source>
	</QRY:Definition>
		<QRY:Definition>
		<QRY:Id>113</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.listAWMProrationDetails" Type="NATIVE">
			<![CDATA[
SELECT DTL.CMPCOD CMPCOD,
  SURCHG.CHGCOD CHGCOD,
  MAX(DTL.FLTCARCOD) FLTCARCOD,
 MAX( DTL.PROTYP) PROTYP,
  MAX(DTL.AWMPER) PROPRC,
   MAX(DTL.CTRCURCOD) CTRCURCOD,
  MAX(MST.POACOD) POACOD,
  MAX(MST.MALIDR) MALIDR,
  MST.MALSEQNUM,
  DTL.SECFRM,
  DTL.SECTOO,
  DTL.SERNUM SERNUM,
  MAX(DTL.SECSTA) SECSTA,
  MAX(MST.TOTPCS) TOTPCS,
  MAX(DTL.UPDGRSWGT) UPDGRSWGT,
  MAX(COALESCE(DTL.SECSTA,'N')) SECTSTA,
  MAX(DTL.AWMAMTCTR) MALCHGVAL,
  MAX(DTL.AWMAMTUSD) MALCHGVALUSD,
  MAX(DTL.AWMAMTXDR) MALCHGVALXDR,
  MAX(DTL.AWMAMTBAS) MALCHGVALBAS,
  MAX(SURCHG.AWMAMTCTR) SURCHGVAL,
  MAX(SURCHG.AWMAMTUSD) SURCHGVALUSD,
  MAX(SURCHG.AWMAMTXDR) SURCHGVALSDR,
  MAX(SURCHG.AWMAMTBAS) SURCHGVALBAS
FROM MALMRABLGDTL DTL,
  MALMRABLGMST MST,MALMRABLGCHG SURCHG
WHERE MST.MALSEQNUM = DTL.MALSEQNUM
AND MST.CMPCOD      = DTL.CMPCOD
AND DTL.CMPCOD      = ?
AND MST.POACOD      = ?
AND DTL.MALSEQNUM   = ?
AND DTL.PAYFLG      = 'T'
AND SURCHG.MALSEQNUM(+) = DTL.MALSEQNUM
AND SURCHG.CMPCOD(+) = DTL.CMPCOD
AND SURCHG.SERNUM   (+) = DTL.SERNUM
GROUP BY DTL.CMPCOD,
  DTL.SECFRM,
  DTL.SECTOO, DTL.SERNUM,
  MST.MALSEQNUM,SURCHG.CHGCOD
  ORDER BY DTL.sernum

			  ]]>
		</QRY:Source>
	</QRY:Definition>



	<QRY:Definition>
		<QRY:Id>114</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.mailbillingInterface" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MRA_MAILBILLING_INTERFACE.SPR_GENERATE_FILE
								(
								 ?,
								 ?,
								 ?,
								 ?,
								 ?,
								 ?,
								 ?,
								 ?,
								 ?
								)
							]]>
			</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>
		<QRY:Id>115</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findFlightrevenueDetails" Type="NATIVE">
			<![CDATA[
			select
	adjflg,
	LPAD(PKG_MAL_MRA_DEFAULTS.Fun_GetMalFltInterfaceSernum(?, '1', 'MALFLTREVINT',?, CURRENT_DATE)::TEXT, 10, 0::TEXT) ERPSEQ,
	hismalseqnum malseqnum,
	histrgpnt trgpnt,
	hiscmpcod cmpcod,
	blgdtltrkordnum trkordnum,
	hisfltdat fltdat,
	malmalidr malidr,
	wgt,
	hisctrcurcod ctrcurcod,
	histotamtctr totamtctr,
	hisfltnum fltnum,
	hissecfrm secfrm,
	hissectoo sectoo,
	blgmstrou rou,
	blgmstmalctgcod malctgcod,
	blgmstfstfltdat fstfltdat,
	maldsn dsn,
	subclssubclsgrp subclsgrp,
	blgmstorgctycod orgctycod,
	blgmstdstctycod dstctycod,
	histotamtusd totamtusd,
	blgmstrsn rsn,
	setcod,
	blgmstpoacod poacod,
	hisfltcarcod fltcarcod,
	hisintfcdflg intfcdflg,
	hissernum sernum,
	hisvernum vernum,
	stnnam,
	fltorg,
	fltdst,
	fltlincod,
	hissegsernum segsernum,
	flttalnum talnum,
	hisfltseqnum fltseqnum,
	fltflttyp flttyp,
	cntregcod regcod
from
	(
	select
		(
		case
			when count (hismst.malseqnum) over (partition by hismst.malseqnum,
			hismst.sernum,
			hismst.cmpcod) > 1 then 'Y'
			else 'N'
		end) adjflg,
		hismst.malseqnum hismalseqnum,
		hismst.trgpnt histrgpnt,
		hismst.cmpcod hiscmpcod,
		blgdtl.trkordnum blgdtltrkordnum,
		hismst.fltdat hisfltdat,
		blgmst.malidr malmalidr,
		(
		case
			when hismst.updgrswgt > 0 then hismst.updgrswgt
			else blgmst.grswgt
		end) wgt,
		hismst.ctrcurcod hisctrcurcod,
		hismst.totamtctr histotamtctr,
		hismst.fltnum hisfltnum,
		hismst.secfrm hissecfrm,
		hismst.sectoo hissectoo,
		blgmst.rou blgmstrou,
		blgmst.malctgcod blgmstmalctgcod,
		blgmst.fstfltdat blgmstfstfltdat,
		blgmst.dsn maldsn,
		subclsmst.subclsgrp subclssubclsgrp,
		blgmst.orgctycod blgmstorgctycod,
		blgmst.dstctycod blgmstdstctycod,
		hismst.totamtusd histotamtusd,
		blgmst.rsn blgmstrsn,
		(
		case
			when hismst.blgsta = 'OB' then hismst.biltooptycod
			when hismst.trgpnt = 'CA'
			and hismst.biltooptycod is not null then hismst.biltooptycod
			else coalesce (hismst.biltooptycod,
			blgmst.poacod)
		end) setcod,
		(
		case
			when hismst.blgsta = 'OB' then blgmst.poacod
			else coalesce (hismst.biltooptycod,
			blgmst.poacod)
		end) blgmstpoacod,
		hismst.fltcarcod hisfltcarcod,
		hismst.intfcdflg hisintfcdflg,
		hismst.sernum hissernum,
		hismst.vernum hisvernum,
		blgdtl.secfrm,
		substr (stnmst.stnnam,
		1,
		5) stnnam,
		substr (fltmst.fltrou,
		1,
		3) fltorg,
		substr (fltmst.fltrou,
		length (fltmst.fltrou) - 2,
		length (fltmst.fltrou)) fltdst,
		cntmst2.regcod
        || '-'
        || cntmst3.regcod fltlincod,
		hismst.segsernum hissegsernum,
		fltleg.talnum flttalnum,
		hismst.fltseqnum hisfltseqnum,
		fltmst.flttyp fltflttyp,
		cntmst4.regcod cntregcod
	from
		(with malhisnotinterfaced as
          (
		select
			*
		from
			(
			select
				cmpcod,
				malseqnum,
				sernum,
				secfrm,
				sectoo,
				fltdat,
				awmamtctr + awmothchgctr totamtctr,
				ctrcurcod,
				fltcarcod,
				awmamtusd + awmothchgusd totamtusd,
				fltseqnum,
				segsernum,
				fltcaridr,
				fltnum,
				vernum,
				max (vernum) over (partition by malseqnum,
				sernum,
				cmpcod) maxvernum,
				biltooptycod,
				blgsta,
				coalesce (intfcdflg,
				'Y') intfcdflg,
				payflg,
				trgpnt,
				updgrswgt
			from
				malmrablgdtlhis
			where
				cmpcod = ?
				and payflg = 'T'
				and intfcdflg = ?
				and fltdat>CURRENT_DATE-210
              ) as mal1
		where
			vernum = maxvernum
          ),
		malhisinterfaced as
          (
		select
			*
		from
			(
			select
				cmpcod,
				malseqnum,
				sernum,
				secfrm,
				sectoo,
				fltdat,
				awmamtctr + awmothchgctr totamtctr,
				ctrcurcod,
				fltcarcod,
				awmamtusd + awmothchgusd totamtusd,
				fltseqnum,
				segsernum,
				fltcaridr,
				fltnum,
				vernum,
				max (vernum) over (partition by malseqnum,
				sernum,
				cmpcod) maxvernum,
				biltooptycod,
				blgsta,
				coalesce (intfcdflg,
				'Y') intfcdflg,
				payflg,
				trgpnt,
				updgrswgt
			from
				malmrablgdtlhis his
			where
				cmpcod = ?
				and payflg = 'T'
				and intfcdflg = 'Y'
				and fltdat>CURRENT_DATE-210
				and exists
                  (
				select
					1
				from
					malhisnotinterfaced int
				where
					int.cmpcod = his.cmpcod
					and int.malseqnum = his.malseqnum
					and int.sernum = his.sernum
                  )
              ) as mal2 
		where
			vernum = maxvernum
          )
		select
			*
		from
			malhisnotinterfaced
	union
		select
			*
		from
			malhisinterfaced
        ) hismst 	
	inner join
        (
		select
			*
		from
			malmrablgmst
		where
			fstfltdat >= coalesce (to_date (
            (
			select
				parval
			from
				shrsyspar
			where
				parcod = 'mra.defaults.revenueinterfacestartdate'
				and cmpcod = ?
            ),
			'dd-mm-yyyy'),
			to_date ('01-04-2019',
			'dd-mm-yyyy'))
        ) blgmst
      on
		blgmst.malseqnum = hismst.malseqnum
		and blgmst.cmpcod = hismst.cmpcod
		and coalesce (blgmst.mrasta,
		'X') <> 'V'
	inner join malmrablgdtl blgdtl
      on
		blgdtl.malseqnum = hismst.malseqnum
		and blgdtl.cmpcod = hismst.cmpcod
		and blgdtl.sernum = hismst.sernum
	inner join shrctymst ctymst
      on
		ctymst.cmpcod = blgmst.cmpcod
		and ctymst.ctycod = blgmst.orgctycod
	inner join shrcntmst cntmst on
		cntmst.cmpcod = blgmst.cmpcod
		and cntmst.cntcod = ctymst.cntcod
	inner join malsubclsmst subclsmst on
		subclsmst.cmpcod = hismst.cmpcod
		and subclsmst.subclscod = blgmst.malsubcls
	inner join fltoprmst fltmst
      on
		fltmst.fltnum = hismst.fltnum
		and fltmst.cmpcod = hismst.cmpcod
		and fltmst.fltcaridr = hismst.fltcaridr
		and fltmst.fltseqnum = hismst.fltseqnum
	inner join shrarpmst arpmst
      on
		arpmst.cmpcod = hismst.cmpcod
		and arpmst.arpcod = fltorg
	inner join shrarpmst arpmst2
      on
		arpmst2.cmpcod = hismst.cmpcod
		and arpmst2.arpcod = fltdst
	inner join shrcntmst cntmst2
      on
		cntmst2.cmpcod = blgmst.cmpcod
		and cntmst2.cntcod = arpmst.cntcod
	inner join shrcntmst cntmst3
      on
		cntmst3.cmpcod = blgmst.cmpcod
		and cntmst3.cntcod = arpmst2.cntcod
	inner join fltoprseg fltseg
      on
		fltseg.fltnum = hismst.fltnum
		and fltseg.cmpcod = hismst.cmpcod
		and fltseg.fltcaridr = hismst.fltcaridr
		and fltseg.fltseqnum = hismst.fltseqnum
		and fltseg.segsernum = hismst.segsernum
	inner join fltoprleg fltleg
      on
		fltleg.fltnum = hismst.fltnum
		and fltleg.cmpcod = hismst.cmpcod
		and fltleg.fltcaridr = hismst.fltcaridr
		and fltleg.fltseqnum = hismst.fltseqnum
		and fltleg.legorg = fltseg.segorg
	inner join malmrablgdtl blgdtltmp
      on
		hismst.cmpcod = blgdtltmp.cmpcod
		and hismst.malseqnum = blgdtltmp.malseqnum
		and blgdtltmp.payflg = 'T'
		and blgdtltmp.fstfltind = 'Y'
	inner join shrusearp arpuse
      on
		hismst.cmpcod = arpuse.cmpcod
		and blgdtltmp.secfrm = arpuse.arpcod
	inner join shrstnmst stnmst
      on
		stnmst.cmpcod = hismst.cmpcod
		and arpuse.stncod = stnmst.stncod
	inner join shrarpmst arpmst4
      on
		arpmst4.cmpcod = blgdtltmp.cmpcod
		and arpmst4.arpcod = blgdtltmp.secfrm
	inner join shrcntmst cntmst4 on
		cntmst4.cmpcod = arpmst4.cmpcod
		and cntmst4.cntcod = arpmst4.cntcod
	order by
		hismalseqnum,
		hissernum,
		hisvernum
    ) as mal

			  ]]>
		</QRY:Source>
	</QRY:Definition>



	<QRY:Definition>
		<QRY:Id>115</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.isBSAExist" Type="NATIVE">
			<![CDATA[
			SELECT count(MST.BLKSPCIDR) as BSACNT
			FROM CRABLKSPCMST MST
			INNER JOIN CRABLKSPCRATDTL DTL
			ON DTL.CMPCOD  = MST.CMPCOD
			AND DTL.ARLIDR = MST.ARLIDR
			AND DTL.BLKSPCIDR = MST.BLKSPCIDR
			LEFT OUTER JOIN CRABLKSPCRATPAR PAR
			ON PAR.CMPCOD = DTL.CMPCOD
			AND PAR.ARLIDR = DTL.ARLIDR
			AND PAR.BLKSPCIDR = DTL.BLKSPCIDR
			AND PAR.RATSEQNUM = DTL.RATSEQNUM
			WHERE MST.CMPCOD = ?
			AND DTL.FLTCARIDR= ?
			AND DTL.FLTNUM = ?
				 AND ((DTL.FLNORGLVLINC = 'ARP'
          AND ?        IN (DTL.FLNORGVALINC))
          OR (DTL.FLNORGLVLEXC   = 'ARP'
          AND ? NOT    IN (DTL.FLNORGVALEXC)))
          AND ((DTL.FLNDSTLVLINC = 'ARP'
          AND ?        IN (DTL.FLNDSTVALINC))
          OR (DTL.FLNDSTLVLEXC   = 'ARP'
          AND ? NOT    IN (DTL.FLNDSTVALEXC)))
			AND ? BETWEEN DTL.VLDFRM AND DTL.VLDTOO
			AND DTL.BLKSPCRATSTA = 'A'
      AND MST.SUBSYS='M'
      AND DTL.BLKSPCTYP = ?
			ORDER BY DTL.BLKSPCTYP DESC

			  ]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>116</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findbillingstatus" Type="NATIVE">
			<![CDATA[
			SELECT BLGSTA FROM MALMRABLGMST MST INNER JOIN MALMRABLGDTL DTL
ON MST.MALSEQNUM=DTL.MALSEQNUM
AND MST.CMPCOD=DTL.CMPCOD
WHERE MST.CMPCOD=?
AND DTL.FLTCARIDR=?
AND MST.MALSEQNUM=?
AND DTL.FLTNUM=?
AND FLTSEQNUM=?
AND DTL.SECFRM=?



							]]>
			</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>
		<QRY:Id>118</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.updateBSAInterfaceFlag" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_RATING.SPR_UPDATE_BSA_INTFLG
								(
								 ?,
								 ?,
								 ?,
								 ?,
								 ?,
								 ?,
								 ?
								)
							]]>
			</QRY:Source>
	</QRY:Definition>




		<QRY:Definition>
		<QRY:Id>119</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findBlockspaceFlights" Type="NATIVE">
					<![CDATA[
					   SELECT DISTINCT CMPCOD,
                       FLTCARIDR,
                       FLTNUM ,
                       FLTDAT,
                       FLTSEQNUM,
					   SEGSERNUM
                       FROM MALMRARTG
                       WHERE CMPCOD = ?
					   AND INTFCDFLG='T'
							]]>
			</QRY:Source>
	</QRY:Definition>


<QRY:Definition>
		<QRY:Id>117</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.proratemca" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_RATING.SPR_PRORAT_MCA
								(
								 ?,
								 ?,
								 ?,
								 ?
								)
							]]>
			</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>
		<QRY:Id>119</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.updatetruckcost" Type="PROCEDURE">
						<![CDATA[
								CALL PKG_MAL_MRA_TRKCST.SPR_MRA_UPDATE_TRUCKCOST
								(
								 ?,
								 ?,
								 ?,
								 ?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?
								)
							]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>120</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findCarrierDetails" Type="NATIVE">
		<![CDATA[
			SELECT ARLIDR FROM SHRARLMST WHERE CMPCOD= ? AND TWOAPHCOD= ? AND OWNARLIND='N'
		]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>121</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.importConsignmentToMRA" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_IMPORTMAIL.SPR_MRA_IMPORT_CSGDOCDATA(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
				)
				]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>122</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.finduspsinternationalincentivejobdetails" Type="NATIVE">
			<![CDATA[
				SELECT CMPCOD,GPACOD,INCCALDAT,PRDFRM,PRDTOO,CLMGENDAT
					FROM MALCALMST
					WHERE CMPCOD = ?
					AND GPACOD in    (SELECT PARVAL FROM SHRSYSPAR WHERE PARCOD in ( 'mailtracking.defaults.uspsinternationalpa',
					'mailtracking.domesticmra.usps')
					AND CMPCOD=?)
					AND CALTYP='I'
				]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>123</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.calculateincentive" Type="PROCEDURE">
			<![CDATA[
				CALL PKG_MAL_MRA_INVOIC_CALC.SPR_MRA_CALC_INTINC_MALBAG(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
				)
				]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>124</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findmailsfromcarditforimport" Type="NATIVE">
			<![CDATA[
				SELECT DISTINCT MST.CMPCOD,MALMST.MALSEQNUM,MST.CSGDOCNUM,MST.CSGSEQNUM,MST.POACOD FROM
					MALCSGMST MST , MALCSGDTL DTL, MALCSGRTG RTG,
					MALMST MALMST
					WHERE DTL.CMPCOD = MST.CMPCOD
					AND DTL.CSGDOCNUM = MST.CSGDOCNUM
					AND DTL.CSGSEQNUM = MST.CSGSEQNUM
					AND DTL.POACOD    = MST.POACOD
					AND MST.CMPCOD    = RTG.CMPCOD
					AND MST.CSGDOCNUM = RTG.CSGDOCNUM
					AND MST.CSGSEQNUM = RTG.CSGSEQNUM
					AND MST.POACOD    = RTG.POACOD
					AND DTL.CMPCOD = MALMST.CMPCOD
					AND DTL.MALSEQNUM = MALMST.MALSEQNUM
					AND MST.CMPCOD  = ?
				]]>
			</QRY:Source>
	</QRY:Definition>

		<QRY:Definition>
		<QRY:Id>121</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findMRABillingDetails" Type="NATIVE">
		<![CDATA[
			SELECT CMPCOD,MALSEQNUM,SERNUM FROM
			MALMRABLGDTL BLGDTL WHERE BLGDTL.CMPCOD=?
			AND BLGDTL.MALSEQNUM=?
		]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
			<QRY:Id>125</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.findmailbagexistsinmra" Type="NATIVE">
			<![CDATA[
					SELECT 1 FROM MALMRABLGMST MST WHERE MST.CMPCOD = ? AND
					MST.MALSEQNUM=(SELECT MALMST.MALSEQNUM FROM MALMST MALMST
					WHERE MALMST.CMPCOD = ? AND MALMST.MALIDR  = ?)
				]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
			<QRY:Id>126</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.importResditData" Type="PROCEDURE">
			<![CDATA[
					CALL PKG_MAL_MRA_IMPORTMAIL.SPR_MRA_IMPORT_RESDITDATA(
					?,
					?,
					?,
					?,
					?,
					?
					)
				]]>
			</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
	<QRY:Id>126</QRY:Id>
	<QRY:Source Name="mail.mra.gpabilling.listconsignmentdetails" Type="NATIVE">
	<![CDATA[


	 (
        SELECT
        MAX(CMPCOD) CMPCOD,
			  MAX(MALSEQNUM) MALSEQNUM,
			  MAX (BLGSTA) BLGSTA,
			  MAX(CSGSEQNUM) CSGSEQNUM,
			  MAX(SEQNUM) SEQNUM,
			  MAX(POACOD) POACOD,
			  MAX(BLGBAS) BLGBAS,
			  MAX(GPA) GPA,
			  MAX(RATIDF) RATIDF,
			  MAX(RATLINIDR) RATLINIDR,
			  MAX(RATTYP) RATTYP,
			  MAX(CNTCOD) CNTCOD,
			  MAX(INVNUM) INVNUM,
			  MAX(CSGDOCNUM) CSGDOCNUM,
			  MAX(VALCHGCTR) VALCHGCTR,
			  MAX(OOE) OOE,
			  MAX(DOE) DOE,
			  MAX(ORGCOD) ORGCOD,
			  MAX(DSTCOD) DSTCOD,
			  MAX(RATSEC) RATSEC,
			  MAX(SUBCLSGRP) SUBCLSGRP,
			  MAX(DAT) DAT,
			  MAX(CAT) CAT,
			  MAX(SUBCLS) SUBCLS,
			  MAX(yer) YER,
			  MAX(DSN) DSN,
			  MAX(RSN) RSN,
			  MAX(HSN) HSN,
			  MAX(REGIND) REGIND,
			  MAX(PCS) PCS,
			  MAX(WGT) WGT,
			  MAX(REVGRSWGT) REVGRSWGT,
			  MAX(FLTNUM) FLTNUM,
			  MAX(CCATYP) CCATYP,
			  MAX(CCAREFNUM) CCAREFNUM,
			  MAX(MCAIND) MCAIND,
			  --MAX(LSTUPDTIM) LSTUPDTIM,
			  MAX(SRVTAX) SRVTAX,
			  MAX(TDS) TDS,
			  MAX(NETAMT) NETAMT,
			  MAX(RAT) RAT,
			  MAX(CTRCURCOD) CTRCURCOD,
			  MAX(GRSAMT) GRSAMT,
			  MAX(REVCURCOD) REVCURCOD,
			  MAX(RMK) RMK,
			  MAX(MAILCHG) MAILCHG,
			  MAX(SURCHG) SURCHG,
			  MAX(DCLVAL) DCLVAL,
			 -- MAX(STLCUR)STLCURCOD,
			  MAX(DSNDAT)DSNDAT,
			  MAX(PERMET) PERMET

      from
      (
		
		WITH USER_MALMRABLGMST AS     (SELECT * FROM MALMRABLGMST      WHERE TO_NUMBER(TO_CHAR(RCVDAT,'YYYYMMDD') ) BETWEEN ? AND ? )
       

      SELECT DISTINCT MST.CMPCOD,
        MST.MALSEQNUM MALSEQNUM,
        CASE
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NULL
          THEN C66DTL.BLGSTA
          ELSE COALESCE(INRCCADTLBLGSTA, DTL.BLGSTA)
        END BLGSTA,
        MST.CSGSEQNUM,
        CASE
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NULL
          THEN C66DTL.INVSERNUM
          ELSE DTL.SERNUM
        END SEQNUM,
        CASE
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NULL
          THEN NULL
          ELSE MST.POACOD
        END POACOD,
        MST.MALIDR BLGBAS ,
        CASE
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NULL
          THEN C66DTL.GPACOD
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLREVGPACOD
          ELSE DTL.UPDBILTOOPOA
        END GPA,
        DTL.BLGMTXCOD RATIDF,
        DTL.RATLINIDR,
        DTL.RATTYP,
        NULL CNTCOD,
        CASE
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NULL
          THEN C66DTL.INVNUM
          ELSE NULL
        END INVNUM ,
        MST.CSGDOCNUM CSGDOCNUM,
        DTL.VALCHGCTR,
        MST.ORGEXGOFC OOE,
        MST.DSTEXGOFC DOE,
        SUBCLS.SUBCLSGRP,
  CASE
  WHEN DTL.BLGSTA        IN ('PB', 'BD')
  AND INRCCADTLMCAREFNUM IS NULL
  THEN C66DTL.RCVDAT
  WHEN INRCCADTLMCAREFNUM IS NOT NULL
  THEN MST.RCVDAT
  ELSE DTL.FLTDAT END DAT,

        MST.MALCTGCOD CAT,
        MST.MALSUBCLS SUBCLS,
        MST.YER YER,
        MST.DSN DSN,
        MST.RSN RSN,
        MST.HSN HSN,
        MST.REGIND REGIND,
        MST.TOTPCS PCS,
        CASE
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NULL
          THEN C66DTL.TOTWGT
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN (SELECT REVGRSWGT FROM MALMRAMCA WHERE MCAREFNUM = INRCCADTLMCAREFNUM AND MALSEQNUM=MST.MALSEQNUM AND CMPCOD=MST.CMPCOD)
          ELSE MST.GRSWGT
        END WGT,
        CASE
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN CCADTL.REVGRSWGT
          ELSE NULL
        END REVGRSWGT,
        DTL.FLTNUM FLTNUM,
        CASE
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLCCATYP
          ELSE NULL
        END CCATYP,
        COALESCE(INRCCADTLMCAREFNUM ,C66DTL.MCAREFNUM) CCAREFNUM,
        DTL.SRVTAX,
        DTL.TDS,
        CASE
          WHEN DTL.BLGSTA         ='BB'
          AND C66DTL.INVNUM      IS NULL
          AND INRCCADTLMCAREFNUM IS NOT NULL
          THEN DTL.NETAMT+INRCCADTLNETAMT
          WHEN DTL.BLGSTA    ='BB'
          AND C66DTL.INVNUM IS NULL
          THEN DTL.NETAMT
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NOT NULL
          AND INRCCADTLGPAEXIST  IS NULL
          THEN CCADTL.REVNETAMT
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLNETAMT
          WHEN DTL.BLGSTA IN ('PB', 'BD')
          THEN C66DTL.NETAMTBLGCUR
          ELSE DTL.NETAMT
        END NETAMT,
        CASE
          WHEN INRCCADTLMCAREFNUM IS NULL
          AND DTL.BLGSTA          IN ('PB', 'BD')
          THEN C66DTL.APLRAT
          ELSE DTL.APLRAT
        END RAT,
        CASE
          WHEN DTL.BLGSTA         ='BB'
          AND C66DTL.INVNUM      IS NULL
          AND INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLREVCURCOD
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLREVCURCOD
          WHEN DTL.BLGSTA IN ('PB', 'BD')
          THEN SMY.BLGCURCOD
          ELSE DTL.CTRCURCOD
        END CTRCURCOD,
        CASE
          WHEN DTL.BLGSTA         ='BB'
          AND C66DTL.INVNUM      IS NULL
          AND INRCCADTLMCAREFNUM IS NOT NULL
          THEN (DTL.UPDWGTCHGCTR + DTL.UPDOTHCHGCTR)
          WHEN DTL.BLGSTA              IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NOT NULL
          AND INRCCADTLGPAEXIST  IS NULL
          THEN CCADTL.REVWGTCHGCTR
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLGRSAMT
          WHEN DTL.BLGSTA IN ('PB', 'BD')
          THEN C66DTL.TOTAMTEXCVATBLGCUR
          ELSE (DTL.UPDWGTCHGCTR + DTL.UPDOTHCHGCTR)
        END GRSAMT,
        CASE
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLREVCURCOD
          ELSE NULL
        END REVCURCOD,
        CASE
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN NULL
          ELSE DTL.RMK
        END RMK,
        CASE
          WHEN DTL.BLGSTA         ='BB'
          AND C66DTL.INVNUM      IS NULL
          AND INRCCADTLMCAREFNUM IS NOT NULL
          THEN DTL.UPDWGTCHGCTR
          WHEN DTL.BLGSTA        IN ('PB', 'BD')
          AND INRCCADTLMCAREFNUM IS NOT NULL
          AND INRCCADTLGPAEXIST  IS NULL
          THEN CCADTL.REVWGTCHGCTR
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLMALCHG
          WHEN DTL.BLGSTA IN ('PB', 'BD')
          THEN C66DTL.MALCHGBLGCUR
          ELSE DTL.UPDWGTCHGCTR
        END MAILCHG,
        CASE
          WHEN INRCCADTLMCAREFNUM IS NOT NULL
          THEN INRCCADTLSURCHG
          ELSE DTL.UPDOTHCHGCTR
        END SURCHG,
        MST.DCLVAL,
        MST.RCVDAT DSNDAT,
        MST.MALPERFLG PERMET,
        CASE WHEN INRCCADTLMCAREFNUM IS NOT NULL OR C66DTL.MCAREFNUM IS NOT NULL THEN 'Y' ELSE 'N' END MCAIND,
         MST.ORGCTYCOD||'-'||MST.DSTCTYCOD RATSEC,
		DTL.SECFRM ORGCOD,
		DTL.SECTOO DSTCOD

      FROM USER_MALMRABLGMST MST
      INNER JOIN MALMRAGPABLGDTL DTL
      ON MST.CMPCOD     = DTL.CMPCOD
      AND MST.MALSEQNUM = DTL.MALSEQNUM
      INNER JOIN MALSUBCLSMST SUBCLS
      ON SUBCLS.CMPCOD     = MST.CMPCOD
      AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
      INNER JOIN MALEXGOFCMST OOE
      ON MST.CMPCOD     = OOE.CMPCOD
      AND MST.ORGEXGOFC = OOE.EXGOFCCOD
      INNER JOIN MALEXGOFCMST DOE
      ON MST.CMPCOD     = DOE.CMPCOD
      AND MST.DSTEXGOFC = DOE.EXGOFCCOD
      LEFT OUTER JOIN
        malmragpac66dtl c66dtl
                on mst.cmpcod        = c66dtl.cmpcod
                and mst.malseqnum  = c66dtl.malseqnum
      AND C66DTL.BLGSTA <> 'WD'
      LEFT OUTER JOIN MALMRAGPAC51SMY SMY
      ON SMY.CMPCOD       = C66DTL.CMPCOD
      AND SMY.INVNUM      = C66DTL.INVNUM
      AND SMY.GPACOD      = C66DTL.GPACOD
      AND C66DTL.INVSERNUM=SMY.INVSERNUM
                and  c66dtl.invsernum =
                    (select   max (invsernum)
                      from malmragpac51smy
                      where cmpcod = c66dtl.cmpcod
                        and invnum = c66dtl.invnum
                        and gpacod = c66dtl.gpacod
		  AND INVSTA   IN ('F','P','N')
          )
      LEFT OUTER JOIN
        (SELECT MALMRAMCA.CMPCOD,
          MALMRAMCA.MALSEQNUM,
          REVGPACOD INRCCADTLREVGPACOD,
          MAX(MCAREFNUM) INRCCADTLMCAREFNUM,
          MAX(BLGSTA) INRCCADTLBLGSTA,
          MAX(REVGRSWGT) INRCCADTLREVGRSWGT,
          MAX(MCATYP) INRCCADTLCCATYP,
          SUM(MALMRAMCA.REVNETAMT    - MALMRAMCA.NETAMT) INRCCADTLNETAMT,
          SUM(MALMRAMCA.REVWGTCHGCTR - MALMRAMCA.WGTCHGCTR) INRCCADTLGRSAMT,
          MAX(MALMRAMCA.REVCTRCURCOD) INRCCADTLREVCURCOD,
          SUM(MALMRAMCA.REVWGTCHGCTR - MALMRAMCA.WGTCHGCTR) INRCCADTLMALCHG,
          SUM(MALMRAMCA.REVOTHCHGCTR - MALMRAMCA.OTHCHGCTR) INRCCADTLSURCHG,
          SUM(MALMRAMCA.REVGRSWGT    -MALMRAMCA.GRSWGT) INRCCADTLWGT,
          (SELECT MAX('Y')
          FROM MALMRAGPAC66DTL
          WHERE MALSEQNUM = MALMRAMCA.MALSEQNUM
          AND CMPCOD      = MALMRAMCA.CMPCOD
          AND GPACOD      = MALMRAMCA.REVGPACOD
       --   AND ROWNUM      =1
          )INRCCADTLGPAEXIST
        FROM MALMRAMCA,
          USER_MALMRABLGMST
        WHERE MALMRAMCA.CMPCOD  = USER_MALMRABLGMST.CMPCOD
        AND MALMRAMCA.MALSEQNUM = USER_MALMRABLGMST.MALSEQNUM
        AND MALMRAMCA.CMPCOD    =?

        AND MALMRAMCA.BLGSTA IN ('BB', 'OH', 'WD')
        AND MALMRAMCA.MCATYP  = 'A'
        AND MALMRAMCA.MCASTA  = 'A'
        GROUP BY MALMRAMCA.CMPCOD,
          MALMRAMCA.MALSEQNUM,
          REVGPACOD
        UNION
        SELECT C66DTL.CMPCOD,
          C66DTL.MALSEQNUM,
          C66DTL.GPACOD,
          NULL INRCCADTLMCAREFNUM,
          NULL INRCCADTLBLGSTA,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL,
          NULL
        FROM USER_MALMRABLGMST MST
        INNER JOIN MALMRAGPAC66DTL C66DTL
        ON MST.CMPCOD    =C66DTL.CMPCOD
        AND MST.MALSEQNUM=C66DTL.MALSEQNUM
        WHERE MST.CMPCOD =?

        ) INRCCADTL ON MST.CMPCOD = INRCCADTL.CMPCOD
      AND MST.MALSEQNUM           = INRCCADTL.MALSEQNUM
      LEFT OUTER JOIN MALMRAMCA CCADTL
      ON INRCCADTL.CMPCOD             =CCADTL.CMPCOD
      AND INRCCADTL.MALSEQNUM         =CCADTL.MALSEQNUM
      AND INRCCADTL.INRCCADTLMCAREFNUM=CCADTL.MCAREFNUM
       WHERE EXISTS
      (SELECT 1
      FROM MALPOADTL POA
      WHERE POA.CMPCOD = DTL.CMPCOD
      AND POA.POACOD   = DTL.UPDBILTOOPOA
      AND POA.PARCOD   = 'STLINFO'
      AND TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD') ) BETWEEN TO_NUMBER(TO_CHAR(POA.VLDFRM,'YYYYMMDD') ) AND TO_NUMBER(TO_CHAR(POA.VLDTOO,'YYYYMMDD') )
     -- AND ROWNUM = 1
      )
      AND MST.CMPCOD                = ?


		]]>
</QRY:Source>
	</QRY:Definition>
<!--	<![CDATA[
			(SELECT MAX(CMPCOD) CMPCOD,
			  MAX(MALSEQNUM) MALSEQNUM,
			  MAX (BLGSTA) BLGSTA,
			  MAX(CSGSEQNUM) CSGSEQNUM,
			  MAX(SEQNUM) SEQNUM,
			  MAX(POACOD) POACOD,
			  MAX(BLGBAS) BLGBAS,
			  MAX(GPA) GPA,
			  MAX(RATIDF) RATIDF,
			  MAX(RATLINIDR) RATLINIDR,
			  MAX(RATTYP) RATTYP,
			  MAX(CNTCOD) CNTCOD,
			  MAX(INVNUM) INVNUM,
			  MAX(CSGDOCNUM) CSGDOCNUM,
			  MAX(VALCHGCTR) VALCHGCTR,
			  MAX(OOE) OOE,
			  MAX(DOE) DOE,
			  MAX(ORGCOD) ORGCOD,
			  MAX(DSTCOD) DSTCOD,
			  MAX(RATSEC) RATSEC,
			  MAX(SUBCLSGRP) SUBCLSGRP,
			  MAX(DAT) DAT,
			  MAX(CAT) CAT,
			  MAX(SUBCLS) SUBCLS,
			  MAX(yer) yer,
			  MAX(DSN) DSN,
			  MAX(RSN) RSN,
			  MAX(HSN) HSN,
			  MAX(REGIND) REGIND,
			  MAX(PCS) PCS,
			  MAX(WGT) WGT,
			  MAX(REVGRSWGT) REVGRSWGT,
			  MAX(FLTNUM) FLTNUM,
			  MAX(CCATYP) CCATYP,
			  MAX(CCAREFNUM) CCAREFNUM,
			  MAX(MCAIND) MCAIND,
			  MAX(LSTUPDTIM) LSTUPDTIM,
			  MAX(SRVTAX) SRVTAX,
			  MAX(TDS) TDS,
			  MAX(NETAMT) NETAMT,
			  MAX(RAT) RAT,
			  MAX(CTRCURCOD) CTRCURCOD,
			  MAX(GRSAMT) GRSAMT,
			  MAX(REVCURCOD) REVCURCOD,
			  MAX(RMK) RMK,
			  MAX(MAILCHG) MAILCHG,
			  MAX(SURCHG) SURCHG,
			  MAX(DCLVAL) DCLVAL,
			  MAX(STLCUR)STLCURCOD,
			  MAX(DSNDAT)DSNDAT,
			  MAX(PERMET) PERMET
			FROM
			  (WITH INNERCCADTL AS
			  (SELECT CCA.CMPCOD ,
				MST.MALSEQNUM ,
				MST.MALIDR BLGBAS,
				MST.CSGDOCNUM ,
				MST.CSGSEQNUM ,
				MST.POACOD ,
				DTL.BLGMTXCOD RATIDF,
				DTL.RATLINIDR,
				DTL.RATTYP,
				DTL.APLRAT RAT,
				DTL.BLGSTA,
				DTL.VALCHGCTR,
				SUM(
				CASE
				  WHEN DTL.BLGSTA       IN ('PB','BD')
				  OR CCA.BLGSTA         IN ('BD','PB')
				  THEN (CCA.REVWGTCHGCTR - CCA.WGTCHGCTR)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVWGTCHGCTR)
				END) MAILCHG,
				SUM(
				CASE
				  WHEN DTL.BLGSTA       IN ('PB','BD')
				  OR CCA.BLGSTA         IN ('BD','PB')
				  THEN (CCA.REVOTHCHGCTR - CCA.OTHCHGCTR)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVOTHCHGCTR)
				END) SURCHG,
				SUM(
				CASE
				  WHEN DTL.BLGSTA    IN ('PB','BD')
				  OR CCA.BLGSTA      IN ('BD','PB')
				  THEN (CCA.REVGRSWGT - CCA.GRSWGT)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVGRSWGT)
				END ) WGT,
				SUM(
				CASE
				  WHEN DTL.BLGSTA       IN ('PB','BD')
				  OR CCA.BLGSTA         IN ('BD','PB')
				  THEN (CCA.REVWGTCHGCTR - CCA.WGTCHGCTR)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN ((CCA.REVWGTCHGCTR+CCA.REVOTHCHGCTR))
				END)GRSAMT,
				SUM(
				CASE
				  WHEN DTL.BLGSTA    IN ('PB','BD')
				  OR CCA.BLGSTA      IN ('BD','PB')
				  THEN (CCA.REVNETAMT - CCA.NETAMT)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVNETAMT)
				END )REVNETAMT,
				SUM(
				CASE
				  WHEN DTL.BLGSTA   IN ('PB','BD')
				  OR CCA.BLGSTA     IN ('BD','PB')
				  THEN (CCA.REVSRVTAX-CCA.SRVTAX)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVSRVTAX)
				END )REVSRVTAX,
				SUM(
				CASE
				  WHEN DTL.BLGSTA IN ('PB','BD')
				  OR CCA.BLGSTA   IN ('BD','PB')
				  THEN (CCA.REVTDS -CCA.TDS)
				  WHEN DTL.BLGSTA = 'BB'
				  THEN (CCA.REVTDS)
				END )REVTDS,
				MAX(CCA.MCAREFNUM) CCAREFNUM,
				DTL.SERNUM,
				DTL.FLTNUM
			  FROM MALMRAMCA CCA,
				MALMRAGPABLGDTL DTL,
				MALMRABLGMST MST
			  WHERE CCA.CMPCOD  = DTL.CMPCOD
			  AND CCA.MALSEQNUM = DTL.MALSEQNUM
			  AND MST.CMPCOD    = DTL.CMPCOD
			  AND MST.MALSEQNUM = DTL.MALSEQNUM
			  AND CCA.MCASTA    = 'A'
			  AND CCA.MCATYP    = 'A'-->
		<QRY:Definition>
		<QRY:Id>122</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findInterfacedDetails" Type="NATIVE">
		<![CDATA[
			SELECT INTFCDDTL.CMPCOD ,
  INTFCDDTL.SEQNUM ,
  INTFCDDTL.REFONE ,
  INTFCDDTL.REFTWO ,
  INTFCDDTL.REFTHREE ,
  INTFCDDTL.REFFOUR ,
  INTFCDDTL.REFFIVE ,
  INTFCDDTL.REFSIX ,
  INTFCDDTL.REFSEVEN ,
  INTFCDDTL.REFEIGHT ,
  INTFCDDTL.REFNINE ,
  INTFCDDTL.REFTEN,
  INTFCDDTL.REFELEVEN ,
  INTFCDDTL.REFTWELVE ,
  INTFCDDTL.REFTHIRTEEN ,
  INTFCDDTL.REFFOURTEEN ,
  INTFCDDTL.REFFIFTEEN ,
  INTFCDDTL.REFSIXTEEN ,
  INTFCDDTL.REFSEVENTEEN ,
  INTFCDDTL.REFEIGHTEEN ,
  INTFCDDTL.REFNINTEEN ,
  INTFCDDTL.REFTWENTY ,
  INTFCDDTL.REFTWENTYONE ,
  INTFCDDTL.REFTWENTYTWO ,
  INTFCDDTL.REFTWENTYTHREE ,
  INTFCDDTL.REFTWENTYFOUR ,
  INTFCDDTL.REFTWENTYFIVE ,
  INTFCDDTL.REFTWENTYSIX ,
  INTFCDDTL.REFTWENTYSEVEN ,
  INTFCDDTL.REFTWENTYEIGHT ,
  INTFCDDTL.REFTWENTYNINE ,
  INTFCDDTL.REFTHIRTY ,
  INTFCDDTL.REFTHIRTYONE ,
  INTFCDDTL.REFTHIRTYTWO ,
  INTFCDDTL.REFTHIRTYTHREE ,
  INTFCDDTL.INTFCDFLG ,
  INTFCDDTL.INTFCDTIM
FROM MALMRAINTFCDDTL INTFCDDTL
WHERE INTFCDDTL.INTFCDFLG='N'
AND INTFCDDTL.CMPCOD     = ?
ORDER BY INTFCDDTL.SEQNUM

		]]>
		</QRY:Source>
	</QRY:Definition>

<!--	 <QRY:Definition>
		<QRY:Id>123</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findGPABillingEntries" Type="NATIVE">
		<![CDATA[

			SELECT DISTINCT MST.CMPCOD,
  MST.MALSEQNUM MALSEQNUM,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.BLGSTA
    ELSE COALESCE(INRCCADTLBLGSTA, DTL.BLGSTA)
  END BLGSTA,
  MST.CSGSEQNUM,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.INVSERNUM
    ELSE DTL.SERNUM
  END SEQNUM,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN NULL
    ELSE MST.POACOD
  END POACOD,
  MST.MALIDR BLGBAS ,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.GPACOD
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLREVGPACOD
    ELSE DTL.UPDBILTOOPOA
  END COD,
  DTL.BLGMTXCOD RATIDF,
  DTL.RATLINIDR,
  DTL.RATTYP,
  NULL CNTCOD,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.INVNUM
    ELSE NULL
  END INVNUM ,
  MST.CSGDOCNUM CSGDOCNUM,
  DTL.VALCHGCTR,
  MST.ORGEXGOFC ORG,
  MST.DSTEXGOFC DST,
  SUBCLS.SUBCLSGRP,
   CASE
    WHEN DTL.BLGSTA        IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.RCVDAT
    ELSE MST.RCVDAT
  END DAT,
  MST.MALCTGCOD CTGCOD,
  MST.MALSUBCLS SUBCLS,
  MST.YER yer,
  MST.DSN DSN,
  MST.RSN RSN,
  MST.HSN HSN,
  MST.REGIND REGIND,
  MST.TOTPCS PCS,
  CASE WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.TOTWGT
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLWGT
    ELSE MST.GRSWGT
  END WGT,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN CCADTL.REVGRSWGT
    ELSE NULL
  END REVGRSWGT,
  DTL.FLTNUM FLTNUM,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLCCATYP
    ELSE NULL
  END CCATYP,
  COALESCE(INRCCADTLMCAREFNUM ,C66DTL.MCAREFNUM) CCAREFNUM,
  DTL.SRVTAX,
  DTL.TDS,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN DTL.NETAMT+INRCCADTLNETAMT
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    THEN DTL.NETAMT
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NOT NULL
    AND INRCCADTLGPAEXIST  IS NULL
    THEN CCADTL.REVNETAMT
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLNETAMT
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN C66DTL.NETAMTBLGCUR
    ELSE DTL.NETAMT
  END NETAMT,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NULL
    AND DTL.BLGSTA   IN ('PB', 'BD')
    THEN C66DTL.APLRAT
    ELSE DTL.APLRAT
  END APLRAT,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN INRCCADTLREVCURCOD
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLREVCURCOD
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN SMY.BLGCURCOD
    ELSE DTL.CTRCURCOD
  END CTRCURCOD,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN (DTL.UPDWGTCHGCTR + DTL.UPDOTHCHGCTR)
    WHEN DTL.BLGSTA       IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NOT NULL
    AND INRCCADTLGPAEXIST  IS NULL
    THEN CCADTL.REVWGTCHGCTR
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLGRSAMT
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN C66DTL.TOTAMTEXCVATBLGCUR
    ELSE (DTL.UPDWGTCHGCTR + DTL.UPDOTHCHGCTR)
  END GRSAMT,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLREVCURCOD
    ELSE NULL
  END REVCURCOD,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN NULL
    ELSE DTL.RMK
  END RMK,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN DTL.UPDWGTCHGCTR
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NOT NULL
    AND INRCCADTLGPAEXIST  IS NULL
    THEN CCADTL.REVWGTCHGCTR
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLMALCHG
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN C66DTL.MALCHGBLGCUR
    ELSE DTL.UPDWGTCHGCTR
  END MAILCHG,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLSURCHG
    ELSE DTL.UPDOTHCHGCTR
  END SURCHG,
  MST.DCLVAL,
  MST.RCVDAT DSNDAT
FROM MALMRABLGMST MST
INNER JOIN MALMRAGPABLGDTL DTL
ON MST.CMPCOD     = DTL.CMPCOD
AND MST.MALSEQNUM = DTL.MALSEQNUM
INNER JOIN MALPOADTL POA
ON POA.CMPCOD  = DTL.CMPCOD
AND POA.POACOD = DTL.UPDBILTOOPOA
AND POA.PARCOD = 'STLINFO'
AND TO_NUMBER(TO_CHAR(MST.RCVDAT,'YYYYMMDD') ) BETWEEN TO_NUMBER(TO_CHAR(POA.VLDFRM,'YYYYMMDD') ) AND TO_NUMBER(TO_CHAR(POA.VLDTOO,'YYYYMMDD'))
INNER JOIN MALSUBCLSMST SUBCLS
ON SUBCLS.CMPCOD     = MST.CMPCOD
AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
INNER JOIN MALEXGOFCMST OOE
ON MST.CMPCOD     = OOE.CMPCOD
AND MST.ORGEXGOFC = OOE.EXGOFCCOD
INNER JOIN MALEXGOFCMST DOE
ON MST.CMPCOD     = DOE.CMPCOD
AND MST.DSTEXGOFC = DOE.EXGOFCCOD
LEFT OUTER JOIN MALMRAGPAC66DTL C66DTL
ON MST.CMPCOD        = C66DTL.CMPCOD
AND MST.MALSEQNUM    = C66DTL.MALSEQNUM
AND C66DTL.BLGSTA   <> 'WD'
AND C66DTL.INVSERNUM =
  (SELECT MAX (INVSERNUM)
  FROM MALMRAGPAC51SMY
  WHERE CMPCOD = C66DTL.CMPCOD
  AND INVNUM   = C66DTL.INVNUM
  AND GPACOD   = C66DTL.GPACOD
  )
LEFT OUTER JOIN MALMRAGPAC51SMY SMY
ON SMY.CMPCOD       = C66DTL.CMPCOD
AND SMY.INVNUM      = C66DTL.INVNUM
AND SMY.GPACOD      = C66DTL.GPACOD
AND C66DTL.INVSERNUM=SMY.INVSERNUM
LEFT OUTER JOIN
  (SELECT MALMRAMCA.CMPCOD,
    MALMRAMCA.MALSEQNUM,
    REVGPACOD INRCCADTLREVGPACOD,
    MAX(MCAREFNUM) INRCCADTLMCAREFNUM,
    MAX(BLGSTA) INRCCADTLBLGSTA,
    MAX(REVGRSWGT) INRCCADTLREVGRSWGT,
    MAX(MCATYP) INRCCADTLCCATYP,
    SUM(MALMRAMCA.REVNETAMT    - MALMRAMCA.NETAMT) INRCCADTLNETAMT,
    SUM(MALMRAMCA.REVWGTCHGCTR - MALMRAMCA.WGTCHGCTR) INRCCADTLGRSAMT,
    MAX(MALMRAMCA.REVCTRCURCOD) INRCCADTLREVCURCOD,
    SUM(MALMRAMCA.REVWGTCHGCTR - MALMRAMCA.WGTCHGCTR) INRCCADTLMALCHG,
    SUM(MALMRAMCA.REVOTHCHGCTR - MALMRAMCA.OTHCHGCTR) INRCCADTLSURCHG,
    SUM(MALMRAMCA.REVGRSWGT    -MALMRAMCA.GRSWGT) INRCCADTLWGT,
    (SELECT 'Y'
    FROM MALMRAGPAC66DTL
    WHERE MALSEQNUM = MALMRAMCA.MALSEQNUM
    AND CMPCOD      = MALMRAMCA.CMPCOD
    AND GPACOD      = MALMRAMCA.REVGPACOD
    AND ROWNUM      =1
    )INRCCADTLGPAEXIST
  FROM MALMRAMCA,
    MALMRABLGMST
  WHERE MALMRAMCA.CMPCOD  = MALMRABLGMST.CMPCOD
  AND MALMRAMCA.MALSEQNUM = MALMRABLGMST.MALSEQNUM
  AND MALMRAMCA.CMPCOD    =?
  AND TO_NUMBER (TO_CHAR (MALMRABLGMST.RCVDAT, 'YYYYMMDD')) BETWEEN ? AND ?
  AND MALMRAMCA.BLGSTA IN ('BB', 'OH', 'WD')
  AND MALMRAMCA.MCATYP  = 'A'
  AND MALMRAMCA.MCASTA  = 'A'
  GROUP BY MALMRAMCA.CMPCOD,
    MALMRAMCA.MALSEQNUM,
    REVGPACOD
  UNION
  SELECT C66DTL.CMPCOD,
    C66DTL.MALSEQNUM,
    C66DTL.GPACOD,
    NULL INRCCADTLMCAREFNUM,
    NULL INRCCADTLBLGSTA,NULL,NULL,NULL,
    NULL,NULL,NULL,NULL,NULL,NULL
  FROM   MALMRABLGMST MST INNER JOIN  MALMRAGPAC66DTL C66DTL
  ON MST.CMPCOD=C66DTL.CMPCOD AND MST.MALSEQNUM=C66DTL.MALSEQNUM
  WHERE MST.CMPCOD=?
  AND TO_NUMBER (TO_CHAR (MST.RCVDAT, 'YYYYMMDD')) BETWEEN ? AND ?
  ) INRCCADTL
ON MST.CMPCOD     = INRCCADTL.CMPCOD
AND MST.MALSEQNUM = INRCCADTL.MALSEQNUM
LEFT OUTER JOIN MALMRAMCA CCADTL
ON INRCCADTL.CMPCOD      =CCADTL.CMPCOD
AND INRCCADTL.MALSEQNUM  =CCADTL.MALSEQNUM
AND INRCCADTL.INRCCADTLMCAREFNUM=CCADTL.MCAREFNUM
WHERE MST.CMPCOD         = ?
AND TO_NUMBER (TO_CHAR (MST.RCVDAT, 'YYYYMMDD')) BETWEEN ? AND ?

		]]>
		</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
		<QRY:Id>124</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.voidmailbags" Type="PROCEDURE">
				<![CDATA[
						CALL PKG_MAL_MRA_RATING.SPR_MRA_VOIDMAILBAG
						(
						 ?,
						 ?,
						 ?,
						 ?,
						 ?,
						 ?
						)
					]]>
			</QRY:Source>
	</QRY:Definition>-->




		<QRY:Definition>
		<QRY:Id>125</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findVoidedInterfacedDetails" Type="NATIVE">
		<![CDATA[
SELECT
	LATINTDTL.CMPCOD,
    LATINTDTL.REFONE MALSEQNUM,
    LATINTDTL.REFTWO SERNUM,
    TO_NUMBER(LATINTDTL.REFTHREE)+1 VERNUM,
    LATINTDTL.REFEIGHTEEN DSN,
    LATINTDTL.REFTWENTYTHREE REGCOD,
    LATINTDTL.REFFOUR STNNAM,
    LATINTDTL.REFSIXTEEN MALCTGCOD,
    LATINTDTL.REFTWENTYSIX SETCOD,
    LATINTDTL.REFTWENTYSEVEN SUBCLSGRP,
    LATINTDTL.REFNINTEEN ORGCTYCOD,
    LATINTDTL.REFSEVENTEEN DSTCTYCOD,
    LATINTDTL.REFFIVE FLTTYP,
    'Y' INTFCDFLG,
    'N' ADJFLG,
    LATINTDTL.REFSIX CTRCURCOD,
    LATINTDTL.REFTEN FLTLINCOD,
    LATINTDTL.REFTHIRTEEN TALNUM,
    LATINTDTL.REFTWENTYONE TOTAMTCTR,
    LATINTDTL.REFTWENTY WGT,
    LATINTDTL.REFTWENTYTWO TOTAMTUSD,
    LATINTDTL.REFTWENTYFOUR MALIDR,
    LATINTDTL.REFTHIRTYTHREE POACOD,
    LATINTDTL.REFELEVEN VODFLTNUM,
    LATINTDTL.REFEIGHT VODFLTDAT,
    LATINTDTL.REFSEVEN VODFSTFLTDAT,
    LATINTDTL.REFTWELVE SECFRM,
    LATINTDTL.REFNINE SECTOO,
    'VOID' TRGPNT,
    LPAD(PKG_MAL_MRA_DEFAULTS.FUN_GETMALFLTINTERFACESERNUM(?,'1','MALFLTREVINT',?,SYSDATE),10,0) ERPSEQ
FROM
    (
        SELECT
            CMPCOD,
            SEQNUM,
            REFONE,
            REFTWO,
            REFTHREE,
            REFFOUR,
            REFFIVE,
            REFSIX,
            REFSEVEN,
            REFEIGHT,
            REFNINE,
            REFTEN,
            REFELEVEN,
            REFTWELVE,
            REFTHIRTEEN,
            REFFOURTEEN,
            REFFIFTEEN,
            REFSIXTEEN,
            REFSEVENTEEN,
            REFEIGHTEEN,
            REFNINTEEN,
            REFTWENTY,
            REFTWENTYONE,
            REFTWENTYTWO,
            REFTWENTYTHREE,
            REFTWENTYFOUR,
            REFTWENTYFIVE,
            REFTWENTYSIX,
            REFTWENTYSEVEN,
            REFTWENTYEIGHT,
            REFTWENTYNINE,
            REFTHIRTY,
            REFTHIRTYONE,
            REFTHIRTYTWO,
            REFTHIRTYTHREE,
            MAX(REFTHREE) OVER(
                PARTITION BY REFONE,REFTWO,CMPCOD
            ) MAXVERNUM
        FROM
            MALMRAINTFCDDTL INTDTL
        WHERE
            INTDTL.CMPCOD = ?
            AND INTDTL.REFONE = ?
            AND INTDTL.INTFCDFLG = 'Y'
    )LATINTDTL LEFT OUTER JOIN MALMRABLGMST MST 
    ON LATINTDTL.CMPCOD=MST.CMPCOD
    AND LATINTDTL.REFONE=MST.MALSEQNUM
WHERE
    LATINTDTL.REFTHREE = LATINTDTL.MAXVERNUM
	AND COALESCE(MST.MRASTA,'V')='V'

		]]>
		</QRY:Source>
	</QRY:Definition>


	<QRY:Definition>
		<QRY:Id>126</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findVoidedInterfacedDetailsOldData" Type="NATIVE">
		<![CDATA[
SELECT
ADJFLG,
LPAD(PKG_MAL_MRA_DEFAULTS.Fun_GetMalFltInterfaceSernum(?,'1','MALFLTREVINT',?,SYSDATE),10,0) ERPSEQ,
HISMALSEQNUM MALSEQNUM,
'VDOLD' TRGPNT,
HISCMPCOD CMPCOD,
BLGDTLTRKORDNUM TRKORDNUM,
HISFLTDAT FLTDAT,
MALMALIDR MALIDR,
WGT,
HISCTRCURCOD CTRCURCOD,
HISTOTAMTCTR TOTAMTCTR,
HISFLTNUM FLTNUM,
HISSECFRM SECFRM,
HISSECTOO SECTOO,
BLGMSTROU ROU,
BLGMSTMALCTGCOD MALCTGCOD,
BLGMSTFSTFLTDAT FSTFLTDAT,
MALDSN DSN,
SUBCLSSUBCLSGRP SUBCLSGRP,
BLGMSTORGCTYCOD ORGCTYCOD,
BLGMSTDSTCTYCOD DSTCTYCOD,
HISTOTAMTUSD TOTAMTUSD ,
BLGMSTRSN RSN,
SETCOD,
BLGMSTPOACOD POACOD,
HISFLTCARCOD FLTCARCOD,
HISINTFCDFLG INTFCDFLG,
HISSERNUM SERNUM,
HISVERNUM VERNUM,
STNNAM,
FLTORG,
FLTDST,
FLTLINCOD,
HISSEGSERNUM SEGSERNUM,
FLTTALNUM TALNUM,
HISFLTSEQNUM FLTSEQNUM ,
FLTFLTTYP FLTTYP,
CNTREGCOD REGCOD
FROM
(SELECT
(case when
count(HISMST.MALSEQNUM) over (PARTITION BY HISMST.MALSEQNUM,HISMST.SERNUM,HISMST.CMPCOD) >  1
then 'Y' else
'N' end) ADJFLG
,
HISMST.MALSEQNUM HISMALSEQNUM,
HISMST.TRGPNT HISTRGPNT,
HISMST.CMPCOD HISCMPCOD,
BLGDTL.TRKORDNUM BLGDTLTRKORDNUM,
HISMST.FLTDAT HISFLTDAT,
BLGMST.MALIDR MALMALIDR,
(case when HISMST.UPDGRSWGT >0 then HISMST.UPDGRSWGT else BLGMST.GRSWGT end) WGT,
HISMST.CTRCURCOD HISCTRCURCOD,
HISMST.TOTAMTCTR HISTOTAMTCTR,
HISMST.FLTNUM HISFLTNUM,
HISMST.SECFRM HISSECFRM,
HISMST.SECTOO HISSECTOO,
BLGMST.ROU BLGMSTROU,
BLGMST.MALCTGCOD BLGMSTMALCTGCOD,
BLGMST.FSTFLTDAT BLGMSTFSTFLTDAT,
BLGMST.DSN MALDSN,
SUBCLSMST.SUBCLSGRP SUBCLSSUBCLSGRP,
BLGMST.ORGCTYCOD BLGMSTORGCTYCOD,
BLGMST.DSTCTYCOD BLGMSTDSTCTYCOD,
HISMST.TOTAMTUSD HISTOTAMTUSD,
BLGMST.RSN BLGMSTRSN,
(case when HISMST.BLGSTA = 'OB' THEN
HISMST.BILTOOPTYCOD
WHEN HISMST.TRGPNT='CA' AND HISMST.BILTOOPTYCOD IS NOT NULL THEN HISMST.BILTOOPTYCOD
else
coalesce(HISMST.BILTOOPTYCOD,BLGMST.POACOD) end
)SETCOD,
(case when HISMST.BLGSTA = 'OB' THEN
BLGMST.POACOD
else
coalesce(HISMST.BILTOOPTYCOD,BLGMST.POACOD) end
)BLGMSTPOACOD,
HISMST.FLTCARCOD HISFLTCARCOD,
HISMST.INTFCDFLG HISINTFCDFLG,
HISMST.SERNUM HISSERNUM,
HISMST.VERNUM HISVERNUM,
BLGDTL.SECFRM,SUBSTR(STNMST.STNNAM,1,5) STNNAM,
SUBSTR(FLTMST.FLTROU,1,3) FLTORG,
SUBSTR(FLTMST.FLTROU,LENGTH(FLTMST.FLTROU)-2,LENGTH(FLTMST.FLTROU)) FLTDST,
CNTMST2.REGCOD||'-'||CNTMST3.REGCOD FLTLINCOD,
HISMST.SEGSERNUM HISSEGSERNUM,
FLTLEG.TALNUM FLTTALNUM,
HISMST.FLTSEQNUM HISFLTSEQNUM,
FLTMST.FLTTYP FLTFLTTYP,
CNTMST4.REGCOD CNTREGCOD FROM
(WITH
  MALHISINTERFACED AS
  (
  SELECT * FROM (
  SELECT CMPCOD,MALSEQNUM,SERNUM,SECFRM,SECTOO,FLTDAT,
   AWMAMTCTR+AWMOTHCHGCTR TOTAMTCTR,
    CTRCURCOD,FLTCARCOD,AWMAMTUSD+AWMOTHCHGUSD TOTAMTUSD,FLTSEQNUM,SEGSERNUM,FLTCARIDR,FLTNUM,VERNUM,
    MAX(VERNUM) OVER(PARTITION BY MALSEQNUM,SERNUM,CMPCOD) MAXVERNUM,BILTOOPTYCOD,BLGSTA,
    COALESCE(INTFCDFLG,'Y') INTFCDFLG,PAYFLG,TRGPNT,UPDGRSWGT
  FROM MALMRABLGDTLHIS HIS
  WHERE
  CMPCOD=? AND
  MALSEQNUM=? AND
   PAYFLG      ='T'
   and blgsta<>'VD'
  AND INTFCDFLG   ='Y'
  ) WHERE VERNUM =MAXVERNUM)
SELECT * FROM MALHISINTERFACED
) HISMST
  INNER JOIN  MALMRABLGMST BLGMST ON
  BLGMST.MALSEQNUM=HISMST.MALSEQNUM AND
  BLGMST.CMPCOD=HISMST.CMPCOD
  INNER JOIN MALMRABLGDTL BLGDTL ON
  BLGDTL.MALSEQNUM=HISMST.MALSEQNUM AND
  BLGDTL.CMPCOD=HISMST.CMPCOD AND
  BLGDTL.SERNUM=HISMST.SERNUM
  LEFT OUTER JOIN MALMRAINTFCDDTL INTDTL
  ON HISMST.CMPCOD=INTDTL.CMPCOD AND HISMST.MALSEQNUM=INTDTL.REFONE
  LEFT OUTER JOIN SHRCTYMST CTYMST ON
  CTYMST.CMPCOD=BLGMST.CMPCOD
  AND CTYMST.CTYCOD=BLGMST.ORGCTYCOD
  LEFT OUTER JOIN SHRCNTMST CNTMST ON
  CNTMST.CMPCOD=BLGMST.CMPCOD
  AND CNTMST.CNTCOD=CTYMST.CNTCOD
  LEFT OUTER JOIN MALSUBCLSMST SUBCLSMST ON
  SUBCLSMST.CMPCOD=HISMST.CMPCOD
  AND SUBCLSMST.SUBCLSCOD=BLGMST.MALSUBCLS
  LEFT OUTER JOIN FLTOPRMST FLTMST ON
  FLTMST.FLTNUM=HISMST.FLTNUM AND
  FLTMST.CMPCOD=HISMST.CMPCOD AND
  FLTMST.FLTCARIDR=HISMST.FLTCARIDR AND
  FLTMST.FLTSEQNUM=HISMST.FLTSEQNUM
  LEFT OUTER JOIN SHRARPMST ARPMST ON
  ARPMST.CMPCOD=HISMST.CMPCOD
  AND ARPMST.ARPCOD=FLTORG
  LEFT OUTER JOIN SHRARPMST ARPMST2 ON
  ARPMST2.CMPCOD=HISMST.CMPCOD
  AND ARPMST2.ARPCOD=FLTDST
  LEFT OUTER JOIN SHRCNTMST CNTMST2 ON
  CNTMST2.CMPCOD=BLGMST.CMPCOD
  AND CNTMST2.CNTCOD=ARPMST.CNTCOD
  LEFT OUTER JOIN SHRCNTMST CNTMST3 ON
  CNTMST3.CMPCOD=BLGMST.CMPCOD
  AND CNTMST3.CNTCOD=ARPMST2.CNTCOD
LEFT OUTER JOIN FLTOPRSEG FLTSEG
ON FLTSEG.FLTNUM    =HISMST.FLTNUM
AND FLTSEG.CMPCOD   =HISMST.CMPCOD
AND FLTSEG.FLTCARIDR=HISMST.FLTCARIDR
AND FLTSEG.FLTSEQNUM=HISMST.FLTSEQNUM
AND FLTSEG.SEGSERNUM=HISMST.SEGSERNUM
LEFT OUTER JOIN FLTOPRLEG FLTLEG
ON FLTLEG.FLTNUM    =HISMST.FLTNUM
AND FLTLEG.CMPCOD   =HISMST.CMPCOD
AND FLTLEG.FLTCARIDR=HISMST.FLTCARIDR
AND FLTLEG.FLTSEQNUM=HISMST.FLTSEQNUM
AND FLTLEG.LEGORG=FLTSEG.SEGORG
LEFT OUTER JOIN MALMRABLGDTL BLGDTLTMP
ON HISMST.CMPCOD=BLGDTLTMP.CMPCOD AND
HISMST.MALSEQNUM= BLGDTLTMP.MALSEQNUM AND
BLGDTLTMP.PAYFLG='T' AND BLGDTLTMP.FSTFLTIND = 'Y'
LEFT OUTER JOIN SHRUSEARP ARPUSE
ON HISMST.CMPCOD=ARPUSE.CMPCOD
AND BLGDTLTMP.SECFRM=ARPUSE.ARPCOD
LEFT OUTER JOIN SHRSTNMST STNMST ON
STNMST.CMPCOD=HISMST.CMPCOD AND
ARPUSE.STNCOD=STNMST.STNCOD
LEFT OUTER JOIN SHRARPMST ARPMST4 ON
ARPMST4.CMPCOD=BLGDTLTMP.CMPCOD
AND ARPMST4.ARPCOD=BLGDTLTMP.SECFRM
LEFT OUTER JOIN SHRCNTMST CNTMST4 ON
CNTMST4.CMPCOD=ARPMST4.CMPCOD
AND CNTMST4.CNTCOD=ARPMST4.CNTCOD
WHERE INTDTL.CMPCOD IS NULL
ORDER BY HISMALSEQNUM ,HISSERNUM,HISVERNUM
)

		]]>
		</QRY:Source>
	</QRY:Definition>



	
	<QRY:Definition>
	<QRY:Id>127</QRY:Id>
	<QRY:Source Name="mail.mra.gpabilling.listc66consignmentdetails" Type="NATIVE">
	<![CDATA[
			SELECT C66DTL.CMPCOD CMPCOD,
			  C66DTL.MALSEQNUM MALSEQNUM,
			  C66DTL.BLGSTA BLGSTA,
			  MST.CSGSEQNUM CSGSEQNUM,
			  C66DTL.INVSERNUM SEQNUM,
			  MST.POACOD POACOD,
			  MST.MALIDR BLGBAS,
			  C66DTL.GPACOD GPA,
			  C66DTL.BLGMTXCOD RATIDF,
			  C66DTL.RATLINIDR,
			  C66DTL.RATTYP,
			  NULL CNTCOD,
			  C66DTL.INVNUM INVNUM,
			  MST.CSGDOCNUM CSGDOCNUM,
			  MST.ORGEXGOFC OOE,
			  MST.DSTEXGOFC DOE,
			  MST.ORGARPCOD ORGCOD,
			  MST.DSTARPCOD DSTCOD,
			  MST.ORGARPCOD||'-'||MST.DSTARPCOD RATSEC,
			  C66DTL.SUBCLSGRP SUBCLSGRP,
			  C66DTL.RCVDAT DAT,
			  C66DTL.MALCTGCOD CAT,
			  C66DTL.ACTSUBCLS SUBCLS,
			  C66DTL.MALCHGBLGCUR MAILCHG,
			  C66DTL.OTHCHGBLGCUR SURCHG,
			  MST.DCLVAL,
			  CASE
				WHEN C66DTL.APLRAT = 0
				THEN 0
				ELSE C66DTL.VALCHGBLGCUR
			  END VALCHG,
			  MST.YER YER,
			  C66DTL.DSN DSN,
			  MST.RSN RSN,
			  MST.HSN HSN,
			  MST.REGIND REGIN1D,
			  C66DTL.TOTPCS TOTPCS,
			  C66DTL.TOTWGT WGT,
			  NULL REVGRSWGT ,
			  C66DTL.FLTNUM FLTNUM,
			  NULL CCATYP,
			  C66DTL.MCAREFNUM CCAREFNUM,
			  CASE WHEN C66DTL.MCAREFNUM IS NOT NULL THEN 'Y'
              ELSE 'N' END MCAIND,
			  C66DTL.LSTUPDTIM LSTUPDTIM,
			  C66DTL.SRVTAXBLGCUR,
			  C66DTL.TDSBLGCUR,
			  C66DTL.NETAMTBLGCUR,
			  C66DTL.APLRAT RAT,
			  SMY.BLGCURCOD CTRCURCOD,
			  C66DTL.TOTAMTEXCVATBLGCUR GRSAMT,
			  NULL REVCURCOD,
			  NULL RMK,
			  POA.STLCUR STLCUR,
			  MST.RCVDAT DSNDAT,
			  MST.MALPERFLG PERMET
			FROM MALMRAGPAC66DTL C66DTL ,
			  MALMRAGPAC51SMY SMY,
			  MALMRABLGMST MST,
			  MALMRAGPABLGDTL GPADTL,
			  MALPOADTL POA,
			  MALEXGOFCMST OOE,
			  MALEXGOFCMST DOE
			WHERE SMY.CMPCOD     =C66DTL.CMPCOD
			AND SMY.INVNUM       =C66DTL.INVNUM
			AND SMY.GPACOD       =C66DTL.GPACOD
			AND C66DTL.INVSERNUM =
			  (SELECT MAX(INVSERNUM)
			  FROM MALMRAGPAC51SMY
			  WHERE CMPCOD = C66DTL.CMPCOD
			  AND INVNUM   = C66DTL.INVNUM
			  AND GPACOD   = C66DTL.GPACOD
			  AND INVSTA = 'F'
			  )
			AND POA.CMPCOD =C66DTL.CMPCOD
			AND POA.POACOD =C66DTL.GPACOD
			AND POA.PARCOD ='STLINFO'
			AND TRUNC(C66DTL.RCVDAT) BETWEEN POA.VLDFRM AND POA.VLDTOO
			AND MST.CMPCOD     = C66DTL.CMPCOD
			AND MST.MALSEQNUM  = C66DTL.MALSEQNUM
			AND MST.CMPCOD     = GPADTL.CMPCOD
			AND MST.MALSEQNUM  = GPADTL.MALSEQNUM
			AND C66DTL.BLGSTA <> 'WD'
			AND MST.CMPCOD     = OOE.CMPCOD
			AND MST.ORGEXGOFC  = OOE.EXGOFCCOD
			AND MST.CMPCOD     = DOE.CMPCOD
			AND MST.DSTEXGOFC  = DOE.EXGOFCCOD
			AND C66DTL.CMPCOD  =
	]]>
	</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>124</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.voidmailbags" Type="PROCEDURE">
				<![CDATA[
						CALL PKG_MAL_MRA_RATING.SPR_MRA_VOIDMAILBAG
						(
						 ?,
						 ?,
						 ?,
						 ?,
						 ?,
						 ?
						)
					]]>
			</QRY:Source>
	</QRY:Definition>
	
	
	
	<QRY:Definition>
	<QRY:Id>128</QRY:Id>
	<QRY:Source Name="mail.mra.gpabilling.listccaconsignmentdetails" Type="NATIVE">
	<![CDATA[
			SELECT CCADTL.CMPCOD CMPCOD,
			  CCADTL.MALSEQNUM,
			  CCADTL.BLGSTA,
			  MST.CSGSEQNUM CSGSEQNUM,
			  INNERCCADTL.SERNUM SEQNUM,
			  MST.POACOD POACOD,
			  MST.MALIDR BLGBAS,
			  CCADTL.REVGPACOD GPA,
			  INNERCCADTL.RATIDF,
			  INNERCCADTL.RATLINIDR,
			  INNERCCADTL.RATTYP,
			  NULL CNTCOD,
			  NULL INVNUM,
			  MST.CSGDOCNUM CSGDOCNUM,
			  MST.ORGEXGOFC OOE,
			  MST.DSTEXGOFC DOE,
			  MST.ORGARPCOD ORGCOD,
			  MST.DSTARPCOD DSTCOD,
			  MST.ORGARPCOD||'-'||MST.DSTARPCOD RATSEC,
			  SUBCLS.SUBCLSGRP SUBCLSGRP,
			  MST.RCVDAT DAT,
			  MST.MALCTGCOD CAT,
			  MST.MALSUBCLS SUBCLS,
			  CASE
				WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
				AND CCADTL.CURCHGIND    <>'Y'
				AND EXISTS
				  (SELECT 1
				  FROM MALMRAGPAC66DTL
				  WHERE MALSEQNUM=CCADTL.MALSEQNUM
				  AND CMPCOD     =CCADTL.CMPCOD
				  AND GPACOD     =CCADTL.REVGPACOD
				  )
				THEN INNERCCADTL.MAILCHG
				WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
				AND CCADTL.GPACHGIND = 'Y'
				THEN 0
				ELSE CCADTL.REVWGTCHGCTR
			  END MAILCHG,
			  CASE
				WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
				AND CCADTL.CURCHGIND    <>'Y'
				AND EXISTS
				  (SELECT 1
				  FROM MALMRAGPAC66DTL
				  WHERE MALSEQNUM=CCADTL.MALSEQNUM
				  AND CMPCOD     =CCADTL.CMPCOD
				  AND GPACOD     =CCADTL.REVGPACOD
				  )
				THEN INNERCCADTL.SURCHG
				WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
				AND CCADTL.GPACHGIND = 'Y'
				THEN 0
				ELSE CCADTL.REVOTHCHGCTR
			  END SURCHG,
			  MST.DCLVAL,
			  CASE
				WHEN CCADTL.REVNETAMT = 0
				AND CCADTL.GPACHGIND  = 'Y'
				THEN 0
				ELSE INNERCCADTL.VALCHGCTR
			  END DCLVAL,
			  MST.YER YER,
			  MST.DSN DSN,
			  MST.RSN RSN,
			  MST.HSN HSN,
			  mst.regind regind,
			  MST.TOTPCS PCS,
			  INNERCCADTL.WGT,
			  CCADTL.REVGRSWGT,
			  INNERCCADTL.FLTNUM FLTNUM,
			  CCADTL.MCATYP,
			  INNERCCADTL.CCAREFNUM ,
			   'Y' MCAIND,
			  CCADTL.LSTUPDTIM LSTUPDTIM,
			  CASE
				WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
				AND CCADTL.CURCHGIND    <>'Y'
				AND EXISTS
				  (SELECT 1
				  FROM MALMRAGPAC66DTL
				  WHERE MALSEQNUM=CCADTL.MALSEQNUM
				  AND CMPCOD     =CCADTL.CMPCOD
				  AND GPACOD     =CCADTL.REVGPACOD
				  )
				THEN INNERCCADTL.REVSRVTAX
				WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
				AND CCADTL.GPACHGIND = 'Y'
				THEN 0
				ELSE CCADTL.REVSRVTAX
			  END REVSRVTAX,
			  INNERCCADTL.REVTDS ,
			  CASE
				WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
				AND CCADTL.CURCHGIND    <>'Y'
				AND EXISTS
				  (SELECT 1
				  FROM MALMRAGPAC66DTL
				  WHERE MALSEQNUM=CCADTL.MALSEQNUM
				  AND CMPCOD     =CCADTL.CMPCOD
				  AND GPACOD     =CCADTL.REVGPACOD
				  )
				THEN INNERCCADTL.REVNETAMT
				WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
				AND CCADTL.GPACHGIND = 'Y'
				THEN 0
				ELSE CCADTL.REVNETAMT
			  END REVNETAMT,
			  INNERCCADTL.RAT RAT,
			  CCADTL.REVCTRCURCOD CURCOD ,
			  CASE
				WHEN INNERCCADTL.BLGSTA IN ('PB','BD')
				AND CCADTL.CURCHGIND    <>'Y'
				AND EXISTS
				  (SELECT 1
				  FROM MALMRAGPAC66DTL
				  WHERE MALSEQNUM=CCADTL.MALSEQNUM
				  AND CMPCOD     =CCADTL.CMPCOD
				  AND GPACOD     =CCADTL.REVGPACOD
				  )
				THEN INNERCCADTL.GRSAMT+INNERCCADTL.SURCHG
				WHEN CCADTL.GPACOD   = CCADTL.REVGPACOD
				AND CCADTL.GPACHGIND = 'Y'
				THEN 0
				ELSE CCADTL.REVWGTCHGCTR+CCADTL.REVOTHCHGCTR
			  END GRSAMT,
			  CCADTL.REVCTRCURCOD REVCURCOD,
			  NULL RMK,
			  POA.STLCUR STLCUR,
			  MST.RCVDAT DSNDAT,
			  MST.MALPERFLG PERMET
			FROM MALMRAMCA CCADTL
			INNER JOIN MALMRABLGMST MST
			ON MST.CMPCOD     = CCADTL.CMPCOD
			AND MST.MALSEQNUM = CCADTL.MALSEQNUM
			INNER JOIN MALSUBCLSMST SUBCLS
			ON SUBCLS.CMPCOD     = MST.CMPCOD
			AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
			INNER JOIN INNERCCADTL
			ON INNERCCADTL.CMPCOD     = CCADTL.CMPCOD
			AND INNERCCADTL.MALSEQNUM = CCADTL.MALSEQNUM
			AND INNERCCADTL.POACOD    = MST.POACOD
			AND INNERCCADTL.CCAREFNUM = CCADTL.MCAREFNUM
			LEFT OUTER JOIN MALMRAGPAC66DTL C66DTL
			ON C66DTL.CMPCOD     = CCADTL.CMPCOD
			AND C66DTL.MALSEQNUM = CCADTL.MALSEQNUM
			AND C66DTL.MCAREFNUM = CCADTL.MCAREFNUM
			AND C66DTL.GPACOD    = CCADTL.REVGPACOD
			LEFT OUTER JOIN MALPOADTL POA
			ON POA.CMPCOD  = CCADTL.CMPCOD
			AND POA.POACOD = CCADTL.REVGPACOD
			AND POA.PARCOD ='STLINFO'
			AND TRUNC(CCADTL.ISSDAT) BETWEEN POA.VLDFRM AND POA.VLDTOO
			WHERE CCADTL.BLGSTA IN ('BB','OH','WD','BD','PB')
			AND CCADTL.MCATYP    = 'A'
			AND CCADTL.MCASTA    = 'A'
			AND CCADTL.CMPCOD    =
		]]>
	</QRY:Source>
	</QRY:Definition>


<QRY:Definition>
		<QRY:Id>129</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findMailDetails" Type="NATIVE">
		<![CDATA[
		SELECT DISTINCT BLGMST.CMPCOD,
  BLGMST.CSGDOCNUM,
  BLGMST.CSGSEQNUM,
  BLGMST.MALIDR,
  POAMST.POACOD,
  POAMST.CNTCOD,
  MRAINT.SEQNUM SEQNUMINT,
  BLGDTL.SERNUM,
  BLGDTL.WGTCHGCTR WGTCHG,
  BLGDTL.CTRCURCOD,
  BLGDTL.RATINCSRVTAXFLG,
  BLGMST.ORGCTYCOD ORG,
  BLGMST.DSTCTYCOD DST,
  BLGDTL.SECFRM,
  BLGDTL.SECTOO,
  BLGDTL.BILTOOPOA,
  NULL PAYFLG,
  BLGDTL.NETAMT,
  BLGDTL.VALCHGCTR,
  blgmst.RCVDAT,
  BLGMST.malseqnum,
  BLGDTL.UPDOTHCHGCTR UPDOTHCHG,
  ctymst.cntcod ORGCNTCOD
FROM MALMRABLGMST BLGMST
INNER JOIN MALMRAGPABLGDTL BLGDTL
ON BLGMST.CMPCOD     = BLGDTL.CMPCOD
AND BLGMST.MALSEQNUM = BLGDTL.MALSEQNUM
INNER JOIN MALPOAMST POAMST
ON BLGMST.CMPCOD  = POAMST.CMPCOD
AND BLGMST.POACOD = POAMST.POACOD
INNER JOIN MALMRAINT MRAINT
ON BLGMST.CMPCOD    =MRAINT.CMPCOD
AND BLGMST.MALSEQNUM=MRAINT.MALSEQNUM
AND MRAINT.SEQNUM   =
  (SELECT MAX(SEQNUM)
  FROM MALMRAINT
  WHERE MALSEQNUM=BLGMST.MALSEQNUM
  AND CMPCOD     =BLGMST.CMPCOD
  )
inner join SHRCTYMST ctymst 
on BLGMST.CMPCOD    =ctymst.CMPCOD
and blgmst.ORGCTYCOD =ctymst.ctycod 
WHERE 
blgmst.CMPCOD = ?
       and MRAINT.TAXUPD = 'N'
       and to_number(to_char(blgmst.rcvdat, 'YYYYMMDD'::text)) > to_number(to_char(CURRENT_DATE-30, 'YYYYMMDD'::text))

		]]>
	</QRY:Source>
	</QRY:Definition>

<QRY:Definition>
		<QRY:Id>130</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findGPABillingEntries" Type="NATIVE">
		<![CDATA[
WITH USER_MALMRABLGMST AS     (SELECT * FROM MALMRABLGMST      WHERE to_number (to_char (rcvdat, 'YYYYMMDD')) BETWEEN ? AND ? )
		SELECT DISTINCT MST.CMPCOD,
  MST.MALSEQNUM MALSEQNUM,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.BLGSTA
    ELSE COALESCE(INRCCADTLBLGSTA, DTL.BLGSTA)
  END BLGSTA,
  MST.CSGSEQNUM,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.INVSERNUM
    ELSE DTL.SERNUM
  END SEQNUM,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN NULL
    ELSE MST.POACOD
  END POACOD,
  MST.MALIDR BLGBAS ,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.GPACOD
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLREVGPACOD
    ELSE DTL.UPDBILTOOPOA
  END COD,
  DTL.BLGMTXCOD RATIDF,
  DTL.RATLINIDR,
  DTL.RATTYP,
  NULL CNTCOD,
  CASE
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.INVNUM
    ELSE NULL
  END INVNUM ,
  MST.CSGDOCNUM CSGDOCNUM,
  DTL.VALCHGCTR,
  MST.ORGEXGOFC ORG,
  MST.DSTEXGOFC DST,
  SUBCLS.SUBCLSGRP,

  CASE
  WHEN DTL.BLGSTA        IN ('PB', 'BD')
  AND INRCCADTLMCAREFNUM IS NULL
  THEN C66DTL.RCVDAT
  WHEN INRCCADTLMCAREFNUM IS NOT NULL
  THEN MST.RCVDAT
  ELSE DTL.FLTDAT END DAT,

  MST.MALCTGCOD CTGCOD,
  MST.MALSUBCLS SUBCLS,

  MST.YER YER,
  CASE WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.TOTWGT
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN (SELECT REVGRSWGT FROM MALMRAMCA WHERE MCAREFNUM = INRCCADTLMCAREFNUM AND MALSEQNUM=MST.MALSEQNUM AND CMPCOD=MST.CMPCOD)
    WHEN MST.GRSWGT =0 THEN DSPWGT
	ELSE MST.ACTULDWGT
  END  ACTULDWGT,
      MST.ACTULDWGTUNT ACTULDWGTUNT,
      MST.ULDNUM ULDNUM,
      MST.POAFLG POAFLG,
  MST.DSN DSN,
  MST.RSN RSN,
  MST.HSN HSN,
  MST.REGIND REGIND,
  MST.TOTPCS PCS,
  CASE WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NULL
    THEN C66DTL.TOTWGT
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN (SELECT REVGRSWGT FROM MALMRAMCA WHERE MCAREFNUM = INRCCADTLMCAREFNUM AND MALSEQNUM=MST.MALSEQNUM AND CMPCOD=MST.CMPCOD)

	 ELSE DTL.UPDGRSWGT
  END WGT,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN CCADTL.REVGRSWGT
    ELSE NULL
  END REVGRSWGT,
  DTL.FLTNUM FLTNUM,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLCCATYP
    ELSE NULL
  END CCATYP,
  COALESCE(INRCCADTLMCAREFNUM ,C66DTL.MCAREFNUM) CCAREFNUM,
  DTL.SRVTAX,
  DTL.TDS,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN DTL.NETAMT+INRCCADTLNETAMT
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    THEN DTL.NETAMT
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NOT NULL
    AND INRCCADTLGPAEXIST  IS NULL
    THEN CCADTL.REVNETAMT
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLNETAMT
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN C66DTL.NETAMTBLGCUR
    ELSE DTL.NETAMT
  END NETAMT,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NULL
    AND DTL.BLGSTA   IN ('PB', 'BD')
    THEN C66DTL.APLRAT
    ELSE DTL.APLRAT
  END APLRAT,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN INRCCADTLREVCURCOD
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLREVCURCOD
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN SMY.BLGCURCOD
    ELSE DTL.CTRCURCOD
  END CTRCURCOD,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN (DTL.UPDWGTCHGCTR + DTL.UPDOTHCHGCTR)
    WHEN DTL.BLGSTA       IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NOT NULL
    AND INRCCADTLGPAEXIST  IS NULL
    THEN CCADTL.REVWGTCHGCTR
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLGRSAMT
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN C66DTL.TOTAMTEXCVATBLGCUR
    ELSE (DTL.UPDWGTCHGCTR + DTL.UPDOTHCHGCTR)
  END GRSAMT,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLREVCURCOD
    ELSE NULL
  END REVCURCOD,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN NULL
    ELSE DTL.RMK
  END RMK,
  CASE
    WHEN DTL.BLGSTA    ='BB'
    AND C66DTL.INVNUM IS NULL
    AND INRCCADTLMCAREFNUM   IS NOT NULL
    THEN DTL.UPDWGTCHGCTR
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    AND INRCCADTLMCAREFNUM IS NOT NULL
    AND INRCCADTLGPAEXIST  IS NULL
    THEN CCADTL.REVWGTCHGCTR
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLMALCHG
    WHEN DTL.BLGSTA IN ('PB', 'BD')
    THEN C66DTL.MALCHGBLGCUR
    ELSE DTL.UPDWGTCHGCTR
  END MAILCHG,
  CASE
    WHEN INRCCADTLMCAREFNUM IS NOT NULL
    THEN INRCCADTLSURCHG
    ELSE DTL.UPDOTHCHGCTR
  END SURCHG,
  MST.DCLVAL,
  MST.RCVDAT DSNDAT,
  DTL.SECFRM ORGCOD,
  DTL.SECTOO DSTCOD,
  MST.MALPERFLG,
  MST.DSPWGTUNT UNTCOD
FROM USER_MALMRABLGMST MST
INNER JOIN MALMRAGPABLGDTL DTL
ON MST.CMPCOD     = DTL.CMPCOD
AND MST.MALSEQNUM = DTL.MALSEQNUM
INNER JOIN MALSUBCLSMST SUBCLS
ON SUBCLS.CMPCOD     = MST.CMPCOD
AND SUBCLS.SUBCLSCOD = MST.MALSUBCLS
INNER JOIN MALEXGOFCMST OOE
ON MST.CMPCOD     = OOE.CMPCOD
AND MST.ORGEXGOFC = OOE.EXGOFCCOD
INNER JOIN MALEXGOFCMST DOE
ON MST.CMPCOD     = DOE.CMPCOD
AND MST.DSTEXGOFC = DOE.EXGOFCCOD
LEFT OUTER JOIN
        malmragpac66dtl c66dtl
                on mst.cmpcod        = c66dtl.cmpcod
                and mst.malseqnum  = c66dtl.malseqnum
AND C66DTL.BLGSTA   <> 'WD'
LEFT OUTER JOIN MALMRAGPAC51SMY SMY
ON SMY.CMPCOD       = C66DTL.CMPCOD
AND SMY.INVNUM      = C66DTL.INVNUM
AND SMY.GPACOD      = C66DTL.GPACOD
AND C66DTL.INVSERNUM=SMY.INVSERNUM
and  c66dtl.invsernum =
                    (select   max (invsernum)
                      from malmragpac51smy
                      where cmpcod = c66dtl.cmpcod
                        and invnum = c66dtl.invnum
                        and gpacod = c66dtl.gpacod
  AND INVSTA   IN ('F','P','N')
  )
LEFT OUTER JOIN
  (SELECT MALMRAMCA.CMPCOD,
    MALMRAMCA.MALSEQNUM,
    REVGPACOD INRCCADTLREVGPACOD,
    MAX(MCAREFNUM) INRCCADTLMCAREFNUM,
    MAX(BLGSTA) INRCCADTLBLGSTA,
    MAX(REVGRSWGT) INRCCADTLREVGRSWGT,
    MAX(MCATYP) INRCCADTLCCATYP,
    SUM(MALMRAMCA.REVNETAMT    - MALMRAMCA.NETAMT) INRCCADTLNETAMT,
    SUM(MALMRAMCA.REVWGTCHGCTR - MALMRAMCA.WGTCHGCTR) INRCCADTLGRSAMT,
    MAX(MALMRAMCA.REVCTRCURCOD) INRCCADTLREVCURCOD,
    SUM(MALMRAMCA.REVWGTCHGCTR - MALMRAMCA.WGTCHGCTR) INRCCADTLMALCHG,
    SUM(MALMRAMCA.REVOTHCHGCTR - MALMRAMCA.OTHCHGCTR) INRCCADTLSURCHG,
    SUM(MALMRAMCA.REVGRSWGT    -MALMRAMCA.GRSWGT) INRCCADTLWGT,
    (SELECT MAX('Y')
    FROM MALMRAGPAC66DTL
    WHERE MALSEQNUM = MALMRAMCA.MALSEQNUM
    AND CMPCOD      = MALMRAMCA.CMPCOD
    AND GPACOD      = MALMRAMCA.REVGPACOD
  --  AND ROWNUM      =1
    )INRCCADTLGPAEXIST
  FROM MALMRAMCA,
    USER_MALMRABLGMST
  WHERE MALMRAMCA.CMPCOD  = USER_MALMRABLGMST.CMPCOD
  AND MALMRAMCA.MALSEQNUM = USER_MALMRABLGMST.MALSEQNUM
  AND MALMRAMCA.CMPCOD    =?

  AND MALMRAMCA.BLGSTA IN ('BB', 'OH', 'WD')
  AND MALMRAMCA.MCATYP  = 'A'
  AND MALMRAMCA.MCASTA  = 'A'
  GROUP BY MALMRAMCA.CMPCOD,
    MALMRAMCA.MALSEQNUM,
    REVGPACOD
  UNION
  SELECT C66DTL.CMPCOD,
    C66DTL.MALSEQNUM,
    C66DTL.GPACOD,
    NULL INRCCADTLMCAREFNUM,
    NULL INRCCADTLBLGSTA,NULL,NULL,NULL,
    NULL,NULL,NULL,NULL,NULL,NULL
  FROM   USER_MALMRABLGMST MST INNER JOIN  MALMRAGPAC66DTL C66DTL
  ON MST.CMPCOD=C66DTL.CMPCOD AND MST.MALSEQNUM=C66DTL.MALSEQNUM
  WHERE MST.CMPCOD=?

  ) INRCCADTL
ON MST.CMPCOD     = INRCCADTL.CMPCOD
AND MST.MALSEQNUM = INRCCADTL.MALSEQNUM
LEFT OUTER JOIN MALMRAMCA CCADTL
ON INRCCADTL.CMPCOD      =CCADTL.CMPCOD
AND INRCCADTL.MALSEQNUM  =CCADTL.MALSEQNUM
AND INRCCADTL.INRCCADTLMCAREFNUM=CCADTL.MCAREFNUM
WHERE EXISTS
  (SELECT 1
  FROM MALPOADTL POA
  WHERE POA.CMPCOD = DTL.CMPCOD
  AND POA.POACOD   = DTL.UPDBILTOOPOA
  AND POA.PARCOD   = 'STLINFO'
  and date_trunc ('day',poa.vldfrm) <= date_trunc ('day',mst.rcvdat)
  and date_trunc ('day',poa.vldtoo) >= date_trunc ('day',mst.rcvdat)
  )
AND MST.CMPCOD     = ?


		]]>

		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
	<QRY:Id>131</QRY:Id>
	<QRY:Source Name="mail.mra.defaults.generateSAPFIFile" Type="PROCEDURE">
		<![CDATA[
			CALL PKG_MRA_ACC_INTERFACE.SPR_GENERATE_SAPFI_AA (
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
					)
		]]>
	</QRY:Source>
	</QRY:Definition>

	<QRY:Definition>
	<QRY:Id>132</QRY:Id>
	<QRY:Source Name="mail.mra.defaults.updaterouteandreprorate" Type="PROCEDURE">
		<![CDATA[
			CALL PKG_MAL_MRA_IMPORTMAIL.SPR_MRA_BULK_ROU_UPDATE (
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
					)
		]]>
	</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
	<QRY:Id>133</QRY:Id>
	<QRY:Source Name="mail.mra.defaults.reimportpabuiltmailbagstomra" Type="PROCEDURE">
		<![CDATA[
			CALL PKG_MAL_MRA_IMPORTMAIL.SPR_MRA_UPDATE_PABUILTULD (?,?,?,?,?,?,?)
		]]>
	</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
	<QRY:Id>134</QRY:Id>
	<QRY:Source Name="mail.mra.defaults.findmailbagsforpabuiltupdate" Type="NATIVE">
		<![CDATA[
			SELECT CMPCOD,MALSEQNUM FROM MALMRABLGMST WHERE CMPCOD = ? AND MALSEQNUM=?
			UNION
			SELECT CMPCOD,MALSEQNUM FROM MALMRABLGMST WHERE CMPCOD=? AND ULDNUM= ? 
			
		]]>
	</QRY:Source>
	</QRY:Definition>	
<QRY:Definition>

				<QRY:Id>131</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.findProrationExceptionsDetailssecond" Type="NATIVE">

				<![CDATA[

					AND NOT EXISTS (
    SELECT
        1
    FROM
        malmrablgdtl dtl
    WHERE
            mst.cmpcod = dtl.cmpcod
        AND mst.malseqnum = dtl.malseqnum
					)
    ) a
where a.rtgsernum = a.minrtgsernum




				]]>
		</QRY:Source>
		</QRY:Definition>
		
		<QRY:Definition>
				<QRY:Id>141</QRY:Id>
				<QRY:Source Name="mail.mra.defaults.billingdetails" Type="NATIVE">
				<![CDATA[
					SELECT MST.PRDNUM, MST.SERNUM, MST.BLGTYP, MST.BLGPRDFRM, MST.BLGPRDTOO, MST.GPAINVGEN, MST.PASFILGEN, 
MST.MSTCUTOFF, MST.ARLCUTOFF, MST.PASINVAVL,MST.BLGPRD,MST.POARCNUPL,PAR.PARCOD,PAR.PARDES,PAR.EXCINCFLG,PAR.PARVAL
FROM MALMRABLGSCHMST MST LEFT OUTER JOIN MALMRABLGPARMST PAR ON
				MST.CMPCOD = PAR.CMPCOD and MST.PRDNUM = PAR.FUNNAM and MST.SERNUM = PAR.SERNUM
AND PAR.FUNPNT ='BLGSCH'
WHERE MST.CMPCOD = ?
				]]>
		</QRY:Source>
		</QRY:Definition>
		<QRY:Definition>
		<QRY:Id>142</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.findbillingscheduleperiods" Type="NATIVE">

<![CDATA[
FROM MALMRABLGSCHMST MST LEFT OUTER JOIN 
MALMRABLGPARMST PAR ON 
MST.CMPCOD           = PAR.CMPCOD
AND MST.PRDNUM             = PAR.FUNNAM
AND MST.SERNUM             = PAR.SERNUM
AND PAR.FUNPNT             ='BLGSCH'
WHERE MST.CMPCOD             = ?
AND MST.BLGTYP             = ?
AND MST.BLGPRD             = ?
AND SUBSTR(MST.PRDNUM,1,4) = ?
AND MST.PRDNUM             = ?
		]]>
	</QRY:Source>
	</QRY:Definition> 
<QRY:Definition>
			<QRY:Id>142</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.importprovisionalRateDetails" Type="PROCEDURE">
			<![CDATA[
					CALL PKG_MAL_MRA_PROVISIONAL_RATING.SPR_MRA_IMPORT_PROVRAT_INT(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?
	
					)
				]]>
			</QRY:Source>
	</QRY:Definition>
<QRY:Definition>
			<QRY:Id>143</QRY:Id>
			<QRY:Source Name="mail.mra.defaults.calculateUpfrontRate" Type="PROCEDURE">
			<![CDATA[
					CALL PKG_MAL_MRA_PROVISIONAL_RATING.SPR_CALCULATE_PROVISIONALRATE(
					?,
					?,
					?,
					?
					)
				]]>
			</QRY:Source>
	</QRY:Definition>	
<QRY:Definition>
		<QRY:Id>144</QRY:Id>
		<QRY:Source Name="mail.mra.defaults.glInterfaceData" Type="NATIVE">
<![CDATA[
  SELECT
	TXN.CMPCOD,
	TXN.ACCTXNIDR,
	TXN.CLRPRD,
	DTL.CSTCTRCOD,
	TXN.CREDAT,
	DTL.GLREFNUM,
	DTL.DRR DEBCUR,
	DTL.CRR CRRCUR,
	TXN.FINYER,
	TXN.FLTCARIDR,
	TXN.FLTNUM,
	TXN.FUNPNT GROUPFIELD,
	TXN.FUNPNT,
	TXN.INVREF,
	TXN.MSTDOCNUM,
	TXN.DOCOWRIDR,
	TXN.SUBSYS,
	TXN.BLGTYP,
	DTL.PRFCTRCOD,
	CASE
		WHEN (DTL.DRR <> 0) THEN 'DEBIT'
		ELSE 'CREDIT'
	END ACCTYP,
	TXN.MEMNUM,
	ARL.TWOAPHCOD AS ARLCOD,
	DTL.CURNAM,
	TXN.RMK,
	TXN.CLRPRD AS INVCLRPRD,
	CASE
		WHEN TXN.FUNPNT = 'MSL' 
						THEN CONCAT(
						(CASE
							WHEN BLGMST.POACOD = 'US001' AND BLGMST.AMOTFLG = 'Y' THEN 'AMOT'
							WHEN BLGMST.POACOD = 'US001' AND COALESCE(BLGMST.AMOTFLG, 'N') = 'N' THEN 'CAIR'
							ELSE 'ICAIR' END), ' ', TO_CHAR(TXN.CREDAT, 'MMDDYYYY'))
		WHEN TXN.FUNPNT = 'IVP' 
						THEN CONCAT('INVOIC', ' ',
						(CASE
							WHEN BLGMST.POACOD = 'US001' AND BLGMST.AMOTFLG = 'Y' THEN 'AMOT'
							WHEN BLGMST.POACOD = 'US001' AND COALESCE(BLGMST.AMOTFLG, 'N') = 'N' THEN 'CAIR'
							ELSE 'ICAIR' END), ' ', TO_CHAR(TXN.INVDAT, 'MMDDYYYY'))
		WHEN TXN.FUNPNT = 'IOA' 
						THEN CONCAT('OVRACPT', ' ',
						(CASE
							WHEN BLGMST.POACOD = 'US001' AND BLGMST.AMOTFLG = 'Y' THEN 'AMOT'
							WHEN BLGMST.POACOD = 'US001' AND COALESCE(BLGMST.AMOTFLG, 'N') = 'N' THEN 'CAIR'
							ELSE 'ICAIR' END), ' ', TO_CHAR(TXN.CREDAT, 'MMDDYYYY'))
		WHEN TXN.FUNPNT = 'IVS' 
						THEN CONCAT('SHTACPT', ' ',
						(CASE
							WHEN BLGMST.POACOD = 'US001' AND BLGMST.AMOTFLG = 'Y' THEN 'AMOT'
							WHEN BLGMST.POACOD = 'US001' AND COALESCE(BLGMST.AMOTFLG, 'N') = 'N' THEN 'CAIR'
							ELSE 'ICAIR' END), ' ', TO_CHAR(TXN.CREDAT, 'MMDDYYYY'))
		WHEN TXN.FUNPNT = 'IPI' 
						THEN CONCAT('INVOIC', ' ',
						(CASE
							WHEN BLGMST.POACOD = 'US001' AND BLGMST.AMOTFLG = 'Y' THEN 'AMOT'
							WHEN BLGMST.POACOD = 'US001' AND COALESCE(BLGMST.AMOTFLG, 'N') = 'N' THEN 'CAIR'
							ELSE 'ICAIR' END), ' ', TO_CHAR(TXN.CREDAT, 'MMDDYYYY'))
		WHEN TXN.FUNPNT = 'MLI' 
						THEN CONCAT('INCENTIVES', ' ',
						(CASE
							WHEN BLGMST.POACOD = 'US001' AND BLGMST.AMOTFLG = 'Y' THEN 'AMOT'
							WHEN BLGMST.POACOD = 'US001' AND COALESCE(BLGMST.AMOTFLG, 'N') = 'N' THEN 'CAIR'
							ELSE 'ICAIR' END), ' ', TO_CHAR(TXN.CREDAT, 'MMDDYYYY'))
		WHEN TXN.FUNPNT = 'M' 
						THEN CONCAT('MAN_ML', ' ',LEFT(TXN.RMK,14), ' ', TO_CHAR(TXN.CREDAT, 'MMDDYYYY'))
	END JRNLINDESC,

	CASE
		WHEN TXN.FUNPNT = 'MSL' THEN 'ML_SALES'
		WHEN TXN.FUNPNT = 'IVP' THEN 'INVOIC'
		WHEN TXN.FUNPNT = 'IOA' THEN 'OVRACPT'
		WHEN TXN.FUNPNT = 'IVS' THEN 'SHTACPT'
		WHEN TXN.FUNPNT = 'IPI' THEN 'INVOIC'
	    WHEN TXN.FUNPNT='MLI' THEN 'INCENTIVES'
		WHEN TXN.FUNPNT = 'M' THEN 'MANUML'
	END FUNDESC
FROM
	CRAACCTXN TXN
INNER JOIN CRAACCTXNDTL DTL ON
	TXN.CMPCOD = DTL.CMPCOD
	AND TXN.ACCTXNIDR = DTL.ACCTXNIDR
	AND TXN.FUNPNT = DTL.FUNPNT
	AND TXN.SUBSYS= DTL.SUBSYS
INNER JOIN MALMRABLGMST BLGMST
	ON
	BLGMST.CMPCOD = TXN.CMPCOD
	AND BLGMST.MALSEQNUM = TXN.MALSEQNUM
LEFT JOIN CRAIATCALMST CALMST ON
	TXN.CMPCOD = CALMST.CMPCOD
	AND TXN.CLRPRD = CALMST.CLRPRD
LEFT JOIN CRAARLVALDTL VALDTL ON
	VALDTL.CMPCOD = TXN.CMPCOD
	AND VALDTL.ARLIDR = TXN.ARLIDR
	AND CALMST.FRMDAT >= VALDTL.VLDFRMDAT
	AND CALMST.TOODAT <= VALDTL.VLDTOODAT
LEFT JOIN CRAARLMST ARL ON
	ARL.ARLIDR = TXN.ARLIDR
	AND ARL.CMPCOD = TXN.CMPCOD
WHERE
	TXN.CMPCOD = ?
	AND TXN.SUBSYS = 'M'
	AND TXN.FUNPNT IN ('M','MSL', 'IVP', 'IOA', 'IVS','IPI','MLI')
		]]>
	</QRY:Source>
	</QRY:Definition> 	
</QRY:Definitions>