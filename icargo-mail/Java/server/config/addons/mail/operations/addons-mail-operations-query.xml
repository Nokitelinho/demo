<?xml version="1.0"?>
<QRY:Definitions xmlns:QRY="http://www.ibsplc.com/xibase/persistence/queries" module="addonsmail.operations">
 <QRY:Definition>
		<QRY:Id>1</QRY:Id>
		<QRY:Source Name="addons.mail.operations.findmailbookingawbs" Type="NATIVE">
			<![CDATA[
		select BKGMST.CMPCOD,BKGMST.SHPPFX,
		BKGMST.DOCOWRIDR,BKGMST.DUPNUM,
BKGMST.MSTDOCNUM,
BKGMST.SEQNUM,
BKGMST.ORGCOD,
BKGMST.DSTCOD,
BKGFLTDTL.FLTCARCOD,
BKGFLTDTL.FLTCARIDR,
BKGFLTDTL.FLTSEQNUM,
BKGFLTDTL.FLTNUM,
BKGFLTDTL.FLTDAT,
BKGFLTDTL.FLTORG,
BKGFLTDTL.FLTDST,
BKGMST.AGTCOD,
BKGMST.SCCCOD,
BKGMST.SHPDAT,
BKGMST.TOTNUMPCS,
BKGMST.TOTWGT,
BKGMST.TOTVOL,
BKGMST.BKGSTA,
SHPMST.SHPSTA,
BKGMST.STNCOD,
BKGMST.BKGDAT,
BKGMST.SHPRMK,
SHPMST.STDPCS,
coalesce(BKGMST.ISSSPLBKG,'N') SPLIND
from CAPBKGMST BKGMST 
 INNER JOIN OPRSHPMST SHPMST ON
 SHPMST.CMPCOD=BKGMST.CMPCOD AND
 SHPMST.UBRNUM=BKGMST.UBRNUM AND
 SHPMST.SHPPFX=BKGMST.SHPPFX AND
 SHPMST.MSTDOCNUM=BKGMST.MSTDOCNUM AND 
 PKG_FRMWRK.FUN_CHECK_STRING_COMMON(SHPMST.SCCCOD,BKGMST.SCCCOD,',') > 0
 LEFT OUTER JOIN CAPBKGFLTDTL BKGFLTDTL ON
 BKGFLTDTL.CMPCOD=SHPMST.CMPCOD AND
 BKGFLTDTL.UBRNUM=SHPMST.UBRNUM 
 
 where BKGMST.CMPCOD = ?
 AND (BKGMST.BKGSTA ='C' or BKGMST.BKGSTA ='Q')
				]]>
</QRY:Source>
</QRY:Definition>
<QRY:Definition>
		<QRY:Id>2</QRY:Id>
		<QRY:Source Name="addons.mail.operations.fetchBookedFlightDetailsForMailbag" Type="NATIVE">
			<![CDATA[
		SELECT  FLTDTL.CMPCOD ,
FLTDTL.MALSEQNUM,
FLTDTL.SERNUM ,
FLTDTL.FLTCARIDR ,
FLTDTL.FLTNUM ,
FLTDTL.FLTSEQNUM ,
FLTDTL.SEGSERNUM ,
FLTDTL.BKGSTA 
from MALBKGFLTDTL FLTDTL
where FLTDTL.MALSEQNUM = ?
				]]>
		</QRY:Source>
	</QRY:Definition>
	<QRY:Definition>
		<QRY:Id>3</QRY:Id>
		<QRY:Source Name="addons.mail.operations.fetchBookedFlightDetails" Type="NATIVE">
			<![CDATA[
		select BKGMST.SHPPFX,
		BKGMST.MSTDOCNUM,
		BKGFLTDTL.FLTORG,
		BKGFLTDTL.FLTDST,
		BKGFLTDTL.FLTCARCOD,
		BKGFLTDTL.FLTNUM,
		BKGFLTDTL.FLTDAT,
		BKGFLTDTL.NUMPCS,
		BKGFLTDTL.WGT,
		BKGFLTDTL.FLTCARIDR,
		BKGFLTDTL.FLTSEQNUM,
		BKGFLTDTL.FLTSEGNUM,
		BKGFLTDTL.SEGSERNUM
		from CAPBKGMST BKGMST INNER JOIN CAPBKGFLTDTL BKGFLTDTL ON
		 BKGMST.CMPCOD=BKGFLTDTL.CMPCOD AND
		 BKGMST.UBRNUM=BKGFLTDTL.UBRNUM 
		 
		 where bkgmst.bkgsta <>'X' and BKGMST.CMPCOD=?
		  AND BKGMST.SHPPFX= ?
		 AND BKGMST.MSTDOCNUM= ?
		 ORDER BY BKGFLTDTL.FLTSEGNUM
				]]>
		</QRY:Source>
	</QRY:Definition>
	
<QRY:Definition>
	<QRY:Id>4</QRY:Id>
	<QRY:Source Name="addons.mail.operations.findAttachedMailBagsCount" Type="NATIVE">
			<![CDATA[
			SELECT COUNT(MALMST.MALSEQNUM) MALCOUNT
			FROM MALMST MALMST INNER JOIN MALBKGFLTDTL FLTDTL
			ON MALMST.MALSEQNUM=FLTDTL.MALSEQNUM AND
			MALMST.CMPCOD=FLTDTL.CMPCOD
			WHERE MALMST.CMPCOD=? AND
			MALMST.SHPPFX= ? AND
			MALMST.MSTDOCNUM=? AND
			FLTDTL.FLTNUM=? AND
			FLTDTL.FLTSEQNUM=? AND
			FLTDTL.FLTCARIDR = ? AND
			FLTDTL.SEGSERNUM = ?
			]]>
</QRY:Source>
</QRY:Definition>	

<QRY:Definition>
	<QRY:Id>5</QRY:Id>
	<QRY:Source Name="addons.mail.operations.findloadplanbookings" Type="NATIVE">
			<![CDATA[
  SELECT SHPMST.SHPPFX
  ||' '
  ||SHPMST.MSTDOCNUM AWBNUM,
  SHPMST.STDPCS,
  SHPMST.STDWGT,
  SHPMST.GRSVOL,
  SHPMST.ORGCOD,
  SHPMST.DSTCOD,
  PLNSHP.SEGORG,
  PLNSHP.SEGDST,
  SHPMST.SCCCOD,
  PLNSHP.PLNPCS,
  PLNSHP.PLNWGT,
  PLNSHP.PLNVOL,  
  ARLMST.TWOAPHCOD||' '||PLNSHP.FLTNUM PLNFLT,  
  LEG.STD PLNFLTDAT,
  SHPMST.SHPDES ,
  SHPMST.SHPSTA,
  LEG.FLTSEQNUM,
  LEG.FLTCARIDR,
  LEG.CMPCOD,
  PLNSHP.DOCOWNIDR,
  PLNSHP.DUPNUM,
  PLNSHP.SEQNUM
FROM OPRLODPLNSHP PLNSHP
INNER JOIN OPRSHPMST SHPMST
ON PLNSHP.CMPCOD     = SHPMST.CMPCOD
AND PLNSHP.MSTDOCNUM = SHPMST.MSTDOCNUM
AND PLNSHP.DOCOWNIDR = SHPMST.DOCOWRIDR
AND PLNSHP.DUPNUM    = SHPMST.DUPNUM
AND PLNSHP.SEQNUM    = SHPMST.SEQNUM
INNER JOIN FLTOPRLEG LEG
ON PLNSHP.CMPCOD     = LEG.CMPCOD
AND PLNSHP.FLTNUM    = LEG.FLTNUM
AND PLNSHP.FLTSEQNUM = LEG.FLTSEQNUM
AND PLNSHP.FLTCARIDR = LEG.FLTCARIDR
AND PLNSHP.SEGORG    = LEG.LEGORG
INNER JOIN SHRARLMST ARLMST
ON PLNSHP.CMPCOD     = ARLMST.CMPCOD
AND PLNSHP.FLTCARIDR = ARLMST.ARLIDR
INNER JOIN SHRSYSPAR SYSPAR
ON PLNSHP.CMPCOD     = SYSPAR.CMPCOD
AND SYSPAR.PARCOD ='mailtracking.defaults.awbsccformail'
AND Pkg_Frmwrk.Fun_String_Check(SHPMST.SCCCOD,SYSPAR.PARVAL,',')>0
AND TO_NUMBER(TO_CHAR(TRUNC(LEG.STD), 'YYYYMMDD')) BETWEEN TO_NUMBER(TO_CHAR(TO_DATE(?), 'YYYYMMDD')) AND TO_NUMBER(TO_CHAR(TO_DATE(?), 'YYYYMMDD'))
and LEG.LEGORG =?
			]]>
</QRY:Source>
</QRY:Definition>	
<QRY:Definition>
	<QRY:Id>6</QRY:Id>
	<QRY:Source Name="addons.mail.operations.findFlightDetailsforAWB" Type="NATIVE">
			<![CDATA[
SELECT PLNSHP.CMPCOD,
SHPMST.SHPPFX,
  SHPMST.MSTDOCNUM,
  PLNSHP.SEGORG FLTORG,
  PLNSHP.SEGDST FLTDST,
  ARLMST.TWOAPHCOD FLTCARCOD,
  PLNSHP.FLTNUM,
  LEG.STD FLTDAT,
  PLNSHP.PLNPCS NUMPCS,
  PLNSHP.PLNWGT WGT,
  PLNSHP.FLTCARIDR,
  PLNSHP.FLTSEQNUM,
 -- PLNSHP.FLTSEGNUM,
  PLNSHP.SEGSERNUM
FROM OPRLODPLNSHP PLNSHP
INNER JOIN OPRSHPMST SHPMST
ON PLNSHP.CMPCOD     = SHPMST.CMPCOD
AND PLNSHP.MSTDOCNUM = SHPMST.MSTDOCNUM
AND PLNSHP.DOCOWNIDR = SHPMST.DOCOWRIDR
AND PLNSHP.DUPNUM    = SHPMST.DUPNUM
AND PLNSHP.SEQNUM    = SHPMST.SEQNUM
INNER JOIN SHRARLMST ARLMST
ON PLNSHP.CMPCOD     = ARLMST.CMPCOD
AND PLNSHP.FLTCARIDR = ARLMST.ARLIDR
INNER JOIN FLTOPRLEG LEG
ON PLNSHP.CMPCOD     = LEG.CMPCOD
AND PLNSHP.FLTNUM    = LEG.FLTNUM
AND PLNSHP.FLTSEQNUM = LEG.FLTSEQNUM
AND PLNSHP.FLTCARIDR = LEG.FLTCARIDR
AND PLNSHP.SEGORG    = LEG.LEGORG
WHERE PLNSHP.CMPCOD  =?
AND SHPMST.SHPPFX=?
AND PLNSHP.MSTDOCNUM = ?
			]]>
</QRY:Source>
</QRY:Definition>

<QRY:Definition>
	<QRY:Id>7</QRY:Id>
	<QRY:Source Name="addons.mail.operations.findmanifestbookings" Type="NATIVE">
			<![CDATA[
  SELECT SHPMST.SHPPFX
  ||' '
  ||SHPMST.mstdocnum AWBNUM,
  SHPMST.stdpcs,
  SHPMST.stdwgt,
  SHPMST.grsvol,
  SHPMST.orgcod,
  SHPMST.dstcod,
  SEG.pol,
  SEG.pou,
  SHPMST.scccod,
  SEGSHP.MFTPCS,
  SEGSHP.MFTWGT,
  SEGSHP.MFTVOL, 
  SEGSHP.docowridr,
  SEGSHP.DUPNUM,
  SEGSHP.SEQNUM ,  
  ARLMST.TWOAPHCOD||' '||SEGSHP.fltnum plnflt,  
  OPRLEG.FLTCARIDR,
  OPRLEG.CMPCOD,
  OPRLEG.FLTSEQNUM,
  OPRLEG.STA MFTFLTDAT,
  SHPMST.SHPDES
FROM OPRSEGSHP SEGSHP
INNER JOIN OPRSHPMST SHPMST
ON SEGSHP.cmpcod     = SHPMST.cmpcod
AND SEGSHP.docowridr = SHPMST.docowridr
AND SEGSHP.mstdocnum = SHPMST.mstdocnum
AND SEGSHP.DUPNUM    = SHPMST.dupnum
AND SEGSHP.seqnum    = SHPMST.seqnum
INNER JOIN OPRFLTSEG SEG
ON SEGSHP.cmpcod     = SEG.cmpcod
AND SEGSHP.fltcaridr = SEG.fltcaridr
AND SEGSHP.fltnum    = SEG.fltnum
AND SEGSHP.fltseqnum = SEG.fltseqnum
AND SEGSHP.segsernum = SEG.segsernum
INNER JOIN FLTOPRLEG OPRLEG
ON SEGSHP.cmpcod     = OPRLEG.cmpcod
AND SEGSHP.fltcaridr = OPRLEG.fltcaridr
AND SEGSHP.fltnum    = OPRLEG.fltnum
AND SEGSHP.fltseqnum = OPRLEG.fltseqnum
AND SEG.POU=OPRLEG.LEGDST
INNER JOIN SHRARLMST ARLMST
ON SEGSHP.CMPCOD     = ARLMST.CMPCOD
AND SEGSHP.FLTCARIDR = ARLMST.ARLIDR
INNER JOIN SHRSYSPAR SYSPAR
ON SEGSHP.CMPCOD     = SYSPAR.CMPCOD
AND SYSPAR.PARCOD ='mailtracking.defaults.awbsccformail'
AND Pkg_Frmwrk.Fun_String_Check(SHPMST.SCCCOD,SYSPAR.PARVAL,',')>0
AND TO_NUMBER(TO_CHAR(TRUNC(OPRLEG.STA), 'YYYYMMDD')) BETWEEN TO_NUMBER(TO_CHAR(TO_DATE(?), 'YYYYMMDD')) AND TO_NUMBER(TO_CHAR(TO_DATE(?), 'YYYYMMDD'))
AND SEG.POU = ?

			]]>
</QRY:Source>
</QRY:Definition>
<QRY:Definition>
	<QRY:Id>8</QRY:Id>
	<QRY:Source Name="addons.mail.operations.findSplitCount" Type="NATIVE">
			<![CDATA[
			SELECT COUNT(plnshp.segorg
  || plnshp.segdst) splcnt
FROM oprshpmst shpmst
INNER JOIN oprlodplnshp plnshp
ON plnshp.cmpcod     = shpmst.cmpcod
AND plnshp.mstdocnum = shpmst.mstdocnum
AND plnshp.docownidr = shpmst.docowridr
AND plnshp.dupnum    = shpmst.dupnum
AND plnshp.seqnum    = shpmst.seqnum
WHERE shpmst.cmpcod  = ?
AND shpmst.docowridr = ?
AND shpmst.mstdocnum = ?
AND shpmst.seqnum    = ?
AND shpmst.dupnum    = ?
GROUP BY shpmst.cmpcod,
  shpmst.docowridr,
  shpmst.mstdocnum,
  shpmst.seqnum,
  shpmst.dupnum,
  plnshp.segorg,
  plnshp.segdst
HAVING COUNT(plnshp.segorg
  || plnshp.segdst) > 1

			]]>
</QRY:Source>
</QRY:Definition>		
</QRY:Definitions>